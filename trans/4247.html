<html>
<head>
<title>How to transfer files among prod, local and S3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨ç”Ÿäº§ã€æœ¬åœ°å’ŒS3ä¹‹é—´ä¼ è¾“æ–‡ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/how-to-transfer-files-among-prod-local-and-s3-ce073a7cbe6b#2022-09-20">https://towardsdatascience.com/how-to-transfer-files-among-prod-local-and-s3-ce073a7cbe6b#2022-09-20</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="ca85" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">å¤‡ä»½Postgresã€å¤åˆ¶dockeræ–‡ä»¶å’Œåœ¨ä¸åŒAWSé…ç½®æ–‡ä»¶ä¹‹é—´åˆ‡æ¢çš„ä»£ç ç‰‡æ®µ</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/e6fd245d90910b75d94588d30e491dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O_eH7GLk0dW6crcG"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kw" href="https://unsplash.com/@othentikisra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">ä»¥è‰²åˆ—æ€»ç»Ÿåºœ</a>åœ¨<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><p id="4cba" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ•°æ®ç§‘å­¦å®¶å¾ˆå°‘ä¼šæ”¶åˆ°å¦‚ä¸‹è¯·æ±‚:</p><ol class=""><li id="fd63" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated">æ‚¨èƒ½ä»ç”Ÿäº§æœºå™¨ä¸Šå¤‡ä»½stageå’Œæœ¬åœ°Postgresæ•°æ®åº“å—ï¼Ÿ</li><li id="20b9" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">ä½ èƒ½ä»ç”Ÿäº§æœºå™¨dockeræœåŠ¡å™¨ä¸Šå¤åˆ¶Xæ–‡ä»¶å¹¶ä¿å­˜åˆ°æœ¬åœ°æœºå™¨ä¸Šå—ï¼Ÿ</li><li id="ce4e" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">ä¸ºä½ çš„å®¢æˆ·ä¸Šä¼ Xæ–‡ä»¶åˆ°AWS s3æ€ä¹ˆæ ·ï¼Ÿ(æç¤º:æ‚¨å¯èƒ½æœ‰å¤šä¸ªAWSæ¦‚è¦æ–‡ä»¶)</li></ol><p id="7387" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¦‚æœä½ ç»å†è¿‡ç±»ä¼¼çš„æƒ…å†µï¼Œä½†ä¸çŸ¥é“å¦‚ä½•å¤„ç†ï¼Œæˆ‘å¸Œæœ›æˆ‘ä¸‹é¢çš„ä»£ç ç‰‡æ®µå¯ä»¥å¸®åŠ©ä½ æ¢å¤å†·é™å’Œå†…å¿ƒçš„å¹³é™ã€‚</p></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="02d8" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">å¦‚ä½•:ä»ç”Ÿäº§è®¡ç®—æœºå¤‡ä»½stageå’Œæœ¬åœ°Postgresæ•°æ®åº“</h1><p id="5717" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">åœ¨æˆ‘ä»¬å…¬å¸ï¼Œæˆ‘ä»¬åªèƒ½sshåˆ°prodæœºï¼Œè€Œä¸”Postgresæ•°æ®åº“éå¸¸å¤§ã€‚å› æ­¤ï¼Œä»¥ä¸‹æ˜¯é€‚åˆæˆ‘ä»¬å›¢é˜Ÿçš„è§£å†³æ–¹æ¡ˆ:</p><ul class=""><li id="8d00" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated"><strong class="kz is">ç¬¬0æ­¥</strong>:åœ¨æœ¬åœ°æœºå™¨ä¸Šå®‰è£…<code class="fe nm nn no np b">zstd</code>ã€‚<code class="fe nm nn no np b">zstd</code>æ˜¯ä¸€ç§å‹ç¼©ç®—æ³•ï¼Œå¯ä»¥å¸®åŠ©å‡å°Postgres <code class="fe nm nn no np b">pg_dump</code>æ–‡ä»¶çš„å¤§å°ã€‚</li></ul><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="c2d8" class="nu mp ir np b gz nv nw l nx ny"># in your terminal<br/>$ brew install zstd</span></pre><ul class=""><li id="4697" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated"><strong class="kz is">æ­¥éª¤1 </strong> : sshåˆ°æ‚¨çš„ç”Ÿäº§æœºå™¨(å¦‚æœæ‚¨ä¸ç¡®å®šå¦‚ä½•sshåˆ°æ‚¨çš„ç”Ÿäº§æœºå™¨ï¼Œè¯·å‘æ‚¨çš„DevOpsåŒäº‹å¯»æ±‚å¸®åŠ©ï¼)</li></ul><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="8ed8" class="nu mp ir np b gz nv nw l nx ny">$ ssh [alias for prod] <br/>$ pg_dump -T [table1] -c | zstd -T32 -19 -c &gt; /tmp/prod.psql.zstd</span></pre><p id="0d9b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä¸Šé¢çš„å‘½ä»¤=â€œå¯¹é™¤è¡¨1ä¹‹å¤–çš„æ‰€æœ‰è¡¨è¿è¡Œpg_dumpâ€ã€‚è¯¥å‘½ä»¤å‹ç¼©<code class="fe nm nn no np b">pg_dump</code>æ–‡ä»¶å¹¶å°†å…¶å­˜å‚¨åœ¨ç”Ÿäº§æœºå™¨çš„ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ã€‚</p><ul class=""><li id="9834" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated"><strong class="kz is">æ­¥éª¤2 </strong>:å°†zstdè¾“å‡ºä¸‹è½½åˆ°æœ¬åœ°æœºå™¨</li></ul><p id="cc64" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¹¶<code class="fe nm nn no np b">cd</code>åˆ°ä½ æƒ³è¦ä¿å­˜æ–‡ä»¶çš„ç›®å½•ã€‚ä¾‹å¦‚<code class="fe nm nn no np b">Downloads</code>:</p><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="3c96" class="nu mp ir np b gz nv nw l nx ny">$ cd Downloads/<br/>$ scp discovery-prod:/tmp/prod.psql.zstd .</span></pre><p id="fbfa" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å‘½ä»¤ä»¥ä¸€ç§è¶…çº§å¹²å‡€çš„æ–¹å¼å°†æ–‡ä»¶ä»prodå¤åˆ¶åˆ°ä½ çš„æœ¬åœ°ï¼å°±åƒã€Šå“ˆåˆ©Â·æ³¢ç‰¹ã€‹ä¸­çš„<em class="nz">å¹½çµ</em>ğŸ’</p><ul class=""><li id="6625" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated">ç¬¬3æ­¥:ç”¨<code class="fe nm nn no np b">zstd</code>æ–‡ä»¶<br/>å¤‡ä»½æ‚¨çš„æœ¬åœ°æˆ–ç™»å°æ•°æ®åº“ç¡®ä¿åœ¨æ‚¨çš„ç™»å°ç¯å¢ƒä¸­åˆ é™¤æ•°æ®åº“ä¹‹å‰å…ˆä¸æ‚¨çš„DevOpså›¢é˜Ÿè®¨è®ºã€‚</li></ul><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="264d" class="nu mp ir np b gz nv nw l nx ny"># I feel pretty free to do so on my local machine</span><span id="95e3" class="nu mp ir np b gz oa nw l nx ny">$ dropdb discovery_db<br/>$ createdb discovery_db<br/>$ cat prod.psql.zstd | zstd -dc | psql discovery_db</span></pre></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="3738" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">å¦‚ä½•:ä»ç”Ÿäº§æœºå™¨dockeræœåŠ¡å™¨å¤åˆ¶Xæ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°æœºå™¨</h1><p id="8457" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">å—¯ï¼Œç±»ä¼¼äºä¸Šé¢çš„è¿‡ç¨‹ï¼Œè¿™é‡Œå”¯ä¸€çš„æ–°ä¸œè¥¿æ˜¯ä»ä¸€ä¸ªç‰¹å®šçš„dockerå®¹å™¨ä¸­æŠ“å–ç‰¹å®šçš„æ–‡ä»¶ã€‚</p><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="3083" class="nu mp ir np b gz nv nw l nx ny"># step 0: ssh to your production machine. <br/>$ ssh prod</span><span id="4a9c" class="nu mp ir np b gz oa nw l nx ny"># step 1: show your docker container <br/>$ docker ps</span><span id="ae4d" class="nu mp ir np b gz oa nw l nx ny"># step 2: copy a file under specific container ID<br/># Here I'm trying to copy a meltano.db file</span><span id="e454" class="nu mp ir np b gz oa nw l nx ny"># step 3: copy file and store it in temp folder<br/>$ docker cp [container_id]:/projects/.meltano/meltano.db /tmp/meltano.db</span></pre><p id="88c8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶ä½¿ç”¨<code class="fe nm nn no np b">scp</code>å°†<code class="fe nm nn no np b">meltano.db</code>æ–‡ä»¶ä»production tempæ–‡ä»¶å¤¹ä¸‹è½½åˆ°æ‚¨çš„æœ¬åœ°æœºå™¨ã€‚ä»¥ä¸‹æ˜¯æˆªå›¾:</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ob"><img src="../Images/acbb119aad5f747d99c17a49fbbdff63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E4jGIIPFQUwQTqvO8nyAPw.png"/></div></div></figure><p id="02ee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">é¢å¤–æç¤º:</p><ul class=""><li id="87bb" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated">ä½ å¯ä»¥äº¤æ›¿ä½¿ç”¨<code class="fe nm nn no np b">docker container ls</code>å’Œ<code class="fe nm nn no np b">docker ps</code></li><li id="fc3c" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated">Dockerå®¹å™¨æ–‡ä»¶å¤¹å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›åˆ é™¤æ—§çš„æœªä½¿ç”¨çš„å®¹å™¨æ¥é‡Šæ”¾ç©ºé—´ã€‚æ‚¨å¯ä»¥è¿™æ ·åš:</li></ul><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="8fc7" class="nu mp ir np b gz nv nw l nx ny"># Run both to stop and remove the folder</span><span id="64d7" class="nu mp ir np b gz oa nw l nx ny">$ docker stop [container_id]</span><span id="1761" class="nu mp ir np b gz oa nw l nx ny">$ docker rm [container_id]</span></pre><p id="3768" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘æƒ³å¯¼å‡º<code class="fe nm nn no np b">meltano.db</code>çš„åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æ³¨æ„åˆ°è¿™ä¸ªæ–‡ä»¶çš„å¤§å°ä»¥æ„æƒ³ä¸åˆ°çš„é€Ÿåº¦å¢é•¿ã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³å¯¼å‡ºè¿™ä¸ªæ–‡ä»¶ä»¥ä¾›è¿›ä¸€æ­¥åˆ†æã€‚ä¸‹é¢æ˜¯æ˜¾ç¤ºæ–‡ä»¶å¤§å°çš„å¦ä¸€ä¸ªæŠ€å·§:</p><ul class=""><li id="1120" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls nl lz ma mb bi translated"><code class="fe nm nn no np b">du -h --max-depth=1</code>:æ˜¾ç¤ºè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶</li><li id="0a85" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nl lz ma mb bi translated"><code class="fe nm nn no np b">ls -alh</code>:è¿™å°†ä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤º<code class="fe nm nn no np b">.</code>ä¸‹çš„æ–‡ä»¶åŠå…¶å¤§å°ã€‚</li></ul><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oc"><img src="../Images/82ffcf683ac55ff6a1365369616bf171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnJuAvoOKPpol-F_MiUmDA.png"/></div></div></figure></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="49b8" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">å¦‚ä½•:è®¾ç½®å¤šä¸ªAWSæ¦‚è¦æ–‡ä»¶å¹¶å°†æ–‡ä»¶ä¸Šä¼ åˆ°s3</h1><p id="33ce" class="pw-post-body-paragraph kx ky ir kz b la ng js lc ld nh jv lf lg ni li lj lk nj lm ln lo nk lq lr ls ik bi translated">ä¾‹å¦‚ï¼Œæˆ‘æƒ³é…ç½®ä¸¤ä¸ªé…ç½®æ–‡ä»¶:ä¸€ä¸ªç”¨äºæˆ‘çš„å¤–éƒ¨å…¬å¸ï¼Œå¦ä¸€ä¸ªç”¨äºè®¿é—®å®¢æˆ·çš„å…¬å¸ã€‚æ‚¨éœ€è¦é¢„å…ˆè·å¾—ä¸¤ä¸ªæ¦‚è¦æ–‡ä»¶çš„AWSè®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥ã€‚</p><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="6f2b" class="nu mp ir np b gz nv nw l nx ny"># step0: check your default profile list<br/>$ aws configure list</span><span id="1c67" class="nu mp ir np b gz oa nw l nx ny"># Configure my profile 1: wen_outside<br/>$ aws configure --profile wen_outside<br/># follow the steps to filling the blanks<br/>AWS Access Key ID [None]: [fill your info]<br/>AWS Secret Access Key [None]: [fill your info]<br/>Default region name [None]: [fill your info] # example: us-east-1 <br/>Default output format [None]: json</span><span id="cae0" class="nu mp ir np b gz oa nw l nx ny"># Configure my profile 2: wen_client<br/>$ aws configure --profile wen_client<br/># follow the steps to filling the blanks<br/>AWS Access Key ID [None]: [fill your info]<br/>AWS Secret Access Key [None]: [fill your info]<br/>Default region name [None]: [fill your info] <br/>Default output format [None]: json</span><span id="9edd" class="nu mp ir np b gz oa nw l nx ny"># Now check to see your profile list<br/>$ aws configure list-profiles</span></pre><p id="ca20" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä¸‹ä¸€æ­¥æ˜¯å¦‚ä½•åœ¨é…ç½®æ–‡ä»¶ä¹‹é—´åˆ‡æ¢:</p><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="f615" class="nu mp ir np b gz nv nw l nx ny"># Switch to my outside profile<br/>$ export AWS_DEFAULT_PROFILE=wen_outside</span></pre><p id="82d2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æœ€åï¼Œå‡è®¾æˆ‘éœ€è¦å°†<code class="fe nm nn no np b">meltano.db</code>ä¸Šä¼ åˆ°æˆ‘ä»¬å®¢æˆ·çš„s3:</p><pre class="kh ki kj kk gu nq np nr ns aw nt bi"><span id="bd8d" class="nu mp ir np b gz nv nw l nx ny"># switch to my profile wen_client<br/>$ export AWS_PROFILE=wen_client</span><span id="0be5" class="nu mp ir np b gz oa nw l nx ny"># from local to S3: for single file<br/>$ aws s3 cp meltano.db [client's s3 directory]</span><span id="bd90" class="nu mp ir np b gz oa nw l nx ny"># from S3 to current directory<br/>$ aws s3 cp [s3 directory] .</span><span id="9ff3" class="nu mp ir np b gz oa nw l nx ny"># from local to S3: sync the whole folder "forClient"<br/>$ aws s3 sync forClient [client's s3 directory]</span></pre></div><div class="ab cl mh mi hv mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ik il im in io"><h1 id="d90b" class="mo mp ir bd mq mr ms mt mu mv mw mx my jx mz jy na ka nb kb nc kd nd ke ne nf bi translated">æ‘˜è¦</h1><ul class=""><li id="9ded" class="lt lu ir kz b la ng ld nh lg od lk oe lo of ls nl lz ma mb bi translated">å’Œå…¶ä»–ä¸€äº›æ•°æ®ç§‘å­¦å®¶ä¸€æ ·ï¼Œæˆ‘ä¹Ÿæœ‰ç±»ä¼¼çš„æ‹…å¿ƒï¼Œä¸ç”Ÿäº§æœºå™¨(é€šå¸¸æ˜¯Linuså’ŒUbuntuç³»ç»Ÿ)äº¤äº’å¯èƒ½ä¼šä»¤äººç”Ÿç•ã€‚è¿™äº›ä»»åŠ¡æˆ‘åšå¾—ä¸å¤Ÿé¢‘ç¹ï¼Œä»¥è‡³äºæˆ‘å»ºç«‹äº†è‚Œè‚‰è®°å¿†ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå¦‚æœæ‚¨å¯¹æ­¤ç±»ä»£ç ç‰‡æ®µä¿æŒè‰¯å¥½çš„æ–‡æ¡£è®°å½•ï¼Œè¿™ç§æ‹…å¿ƒæ˜¯å¯ä»¥å…‹æœçš„ã€‚</li></ul></div></div>    
</body>
</html>