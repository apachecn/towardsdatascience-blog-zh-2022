<html>
<head>
<title>Partial dependence plots with Scikit-learn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Scikit-learnç»˜åˆ¶éƒ¨åˆ†ç›¸å…³æ€§å›¾</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/partial-dependence-plots-with-scikit-learn-966ace4864fc#2022-07-04">https://towardsdatascience.com/partial-dependence-plots-with-scikit-learn-966ace4864fc#2022-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7112" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">æ•°æ®ç§‘å­¦åŸºç¡€</h2><div class=""/><div class=""><h2 id="f83c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">èµ°å‘å¯è§£é‡Šçš„äººå·¥æ™ºèƒ½</h2></div><p id="f76e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">éƒ¨åˆ†ç›¸å…³å›¾(PDP)æ˜¯æ·±å…¥äº†è§£ç‰¹å¾å’Œé¢„æµ‹ä¹‹é—´å…³ç³»çš„æœ‰ç”¨å·¥å…·ã€‚å®ƒæœ‰åŠ©äºæˆ‘ä»¬ç†è§£ç‰¹å®šç‰¹å¾çš„ä¸åŒå€¼å¦‚ä½•å½±å“æ¨¡å‹çš„é¢„æµ‹ã€‚åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ PDPçš„åŸºæœ¬çŸ¥è¯†ï¼Œå¹¶ç†Ÿæ‚‰ä¸€äº›ä½¿ç”¨Scikit-learnç»˜åˆ¶PDPçš„æœ‰ç”¨æ–¹æ³•ã€‚</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/8538c410497107cc18deede5a80c0430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZgCjNovbtBGT6II6"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">ç‰¹é‡ŒÂ·ç»´é‡Œæ–¯è¿ªæ–¯çš„ç…§ç‰‡</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="9d3a" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">ğŸ“¦æ•°æ®</h1><p id="3ac3" class="pw-post-body-paragraph kr ks it kt b ku nd kd kw kx ne kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae md" href="https://github.com/mwaskom/seaborn-data/blob/master/titanic.csv" rel="noopener ugc nofollow" target="_blank">æ³°å¦å°¼å…‹å·æ•°æ®é›†</a> ( <em class="ni">è¯¥æ•°æ®å¯é€šè¿‡Seabornè·å¾—ï¼Œå¹¶æŒæœ‰BSD-3è®¸å¯è¯</em>)ã€‚è®©æˆ‘ä»¬å¯¼å…¥åº“å¹¶åŠ è½½æ•°æ®é›†ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è®­ç»ƒä¸€ä¸ªéšæœºæ£®æ—æ¨¡å‹ï¼Œå¹¶è¯„ä¼°å…¶æ€§èƒ½ã€‚</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="7091" class="no mm it nk b gy np nq l nr ns">import numpy as np<br/>import pandas as pd</span><span id="2f03" class="no mm it nk b gy nt nq l nr ns"># sklearn version: v1.0.1<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import (RandomForestClassifier, <br/>                              AdaBoostClassifier)<br/>from sklearn.neighbors import KNeighborsClassifier<br/>from sklearn.metrics import roc_auc_score<br/>from sklearn.inspection import (partial_dependence, <br/>                                PartialDependenceDisplay)</span><span id="9c5e" class="no mm it nk b gy nt nq l nr ns">import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>sns.set(style='darkgrid', context='talk', palette='Set2')</span><span id="7642" class="no mm it nk b gy nt nq l nr ns">columns = ['survived', 'pclass', 'age', 'sibsp', 'parch', 'fare', <br/>           'adult_male']<br/>df = sns.load_dataset('titanic')[columns].dropna()<br/>X = df.drop(columns='survived')<br/>y = df['survived']<br/>X_train, X_test, y_train, y_test =  train_test_split(<br/>    X, y, random_state=42, test_size=.25<br/>)</span><span id="8713" class="no mm it nk b gy nt nq l nr ns">rf = RandomForestClassifier(random_state=42)<br/>rf.fit(X_train, y_train)</span><span id="3a59" class="no mm it nk b gy nt nq l nr ns">def evaluate(model, X_train, y_train, X_test, y_test):<br/>    name = str(model).split('(')[0]<br/>    print(f"========== {name} ==========")<br/>    y_train_pred = model.predict_proba(X_train)[:,1]<br/>    roc_auc_train = roc_auc_score(y_train, y_train_pred)<br/>    print(f"Train ROC AUC: {roc_auc_train:.4f}")<br/>    <br/>    y_test_pred = model.predict_proba(X_test)[:,1]<br/>    roc_auc_test = roc_auc_score(y_test, y_test_pred)<br/>    print(f"Test ROC AUC: {roc_auc_test:.4f}")<br/>    <br/>evaluate(rf, X_train, y_train, X_test, y_test)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/5ffe161258dd63ec6e103ac14523a007.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*6AUhiHpINwDePCJIijFC_g.png"/></div></figure><p id="243a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å­¦ä¹ PDPçš„åŸºç¡€çŸ¥è¯†ã€‚</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="d4c4" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">ğŸ“Šéƒ¨åˆ†ç›¸å…³å›¾ä»‹ç»</h1><p id="b798" class="pw-post-body-paragraph kr ks it kt b ku nd kd kw kx ne kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">è®©æˆ‘ä»¬ä»¥PDPä¸ºä¾‹å¼€å§‹è®¨è®ºã€‚æˆ‘ä»¬å°†ä½¿ç”¨<code class="fe nv nw nx nk b"><a class="ae md" href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.PartialDependenceDisplay.html" rel="noopener ugc nofollow" target="_blank">PartialDependenceDisplay</a></code>ä¸º<code class="fe nv nw nx nk b">pclass</code>ç»˜åˆ¶ä¸€ä¸ª:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="58b1" class="no mm it nk b gy np nq l nr ns">var = 'pclass'<br/>PartialDependenceDisplay.from_estimator(rf, X_train, [var]);</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/bab15e752055ff12a6e8c4027c12e1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*Olor3-ncQ4pBiTs6c60J_A.png"/></div></figure><blockquote class="nz oa ob"><p id="ceed" class="kr ks ni kt b ku kv kd kw kx ky kg kz oc lb lc ld od lf lg lh oe lj lk ll lm im bi translated">éšç€ç‰¹å¾å€¼çš„å˜åŒ–ï¼ŒPDPæ˜¾ç¤ºäº†å¯¹é¢„æµ‹çš„å¹³å‡å½±å“ã€‚</p></blockquote><p id="6ceb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">åœ¨ä¸Šå›¾ä¸­ï¼Œçºµè½´æ˜¾ç¤ºé¢„æµ‹æ¦‚ç‡ï¼Œæ¨ªè½´æ˜¾ç¤º<code class="fe nv nw nx nk b">pclass</code>å€¼ã€‚ç»¿çº¿è¡¨ç¤ºå¹³å‡é¢„æµ‹æ¦‚ç‡éšç€<code class="fe nv nw nx nk b">pclass</code>å€¼çš„å˜åŒ–è€Œå˜åŒ–ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œéšç€ä¹˜å®¢ç­‰çº§ä»1å¢åŠ åˆ°3ï¼Œå¹³å‡ç”Ÿå­˜æ¦‚ç‡é™ä½ã€‚</p><p id="3a2a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ä¸ºäº†æ›´å¥½åœ°ç†è§£PDPï¼Œè®©æˆ‘ä»¬ç®€å•åœ°çœ‹ä¸€ä¸‹å¦‚ä½•æ‰‹åŠ¨æ„å»ºå…ˆå‰çš„æƒ…èŠ‚ã€‚æˆ‘ä»¬é¦–å…ˆä¼šå‘ç°<code class="fe nv nw nx nk b">pclass</code>çš„ç‹¬ç‰¹ä»·å€¼ã€‚Thenï¸å¯¹äºæ¯ä¸ªå”¯ä¸€å€¼ï¼Œæˆ‘ä»¬å°†ç”¨å®ƒæ›¿æ¢è®­ç»ƒæ•°æ®ä¸­çš„<code class="fe nv nw nx nk b">pclass</code>åˆ—ä¸­çš„å€¼ï¼Œå¹¶è®°å½•é¢„æµ‹å¦‚ä½•å˜åŒ–ã€‚</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="22e6" class="no mm it nk b gy np nq l nr ns">values = X_train[var].sort_values().unique()<br/>print(f"Unique values: {values}")<br/>individual = np.empty((len(X_train), len(values)))<br/>for i, value in enumerate(values):<br/>    X_copy = X_train.copy()<br/>    X_copy[var] = value<br/>    individual[:, i] = rf.predict_proba(X_copy)[:, 1]<br/>individual</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi of"><img src="../Images/cc8bddf8f4a685afdae68e402107a19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*BYf0f8DZpYet_okoJnV1fg.png"/></div></div></figure><p id="f51c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬æ›´æ”¹<code class="fe nv nw nx nk b">pclass</code>çš„å€¼ï¼Œè®­ç»ƒæ•°æ®é›†ä¸­æ¯æ¡è®°å½•çš„ä¸ªä½“é¢„æµ‹(<em class="ni">ä¹Ÿç§°ä¸ºä¸ªä½“æ¡ä»¶æœŸæœ›ï¼ŒICE </em>)å°†å¦‚ä½•å˜åŒ–ã€‚é€šè¿‡å¹³å‡è¿™äº›é¢„æµ‹å€¼(<em class="ni">éƒ¨åˆ†ç›¸å…³ï¼ŒPD </em>)ï¼Œæˆ‘ä»¬å¾—åˆ°PDPçš„è¾“å…¥å€¼ã€‚</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="7239" class="no mm it nk b gy np nq l nr ns">individual.mean(axis=0)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi og"><img src="../Images/4735496c8d54d4cbc769b717b4ed764c.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*HOJVD5U-5ZPVQeQXbQFjyA.png"/></div></figure><p id="56ad" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">é€šè¿‡ç»˜åˆ¶è¿™äº›å€¼å’Œ<code class="fe nv nw nx nk b">pclass</code>çš„å”¯ä¸€å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç°PDPã€‚ä¸ä½¿ç”¨<code class="fe nv nw nx nk b">PartialDependenceDisplay</code>ç›¸æ¯”ï¼Œæˆ‘ä»¬è‡ªå·±ä»åŸå§‹å€¼ä¸­ç»˜å›¾ç»™äº†æˆ‘ä»¬æ›´å¤šçš„çµæ´»æ€§å’Œå¯¹å¦‚ä½•å¯è§†åŒ–PDPçš„æ§åˆ¶ã€‚</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="6aba" class="no mm it nk b gy np nq l nr ns">sns.lineplot(x=values, y=individual.mean(axis=0), style=0, <br/>             markers=True, legend=False)<br/>plt.ylim(0.2,0.6)<br/>plt.ylabel("Partial dependence")<br/>plt.xlabel(var);</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8ea98dfcf3509fa0e265873cac100b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*5sZO4yktOZDsQOWHJTfUHA.png"/></div></figure><p id="2e4d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å¦‚ä¸Šæ‰€è¿°çš„æ‰‹åŠ¨è®¡ç®—å¯¹äºå­¦ä¹ å’Œç†è§£æ¦‚å¿µéå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨å®é™…ç”¨ä¾‹ä¸­ç»§ç»­ä½¿ç”¨è¿™ç§æ–¹æ³•æ˜¯ä¸ç°å®çš„ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Scikit-learnæ›´é«˜æ•ˆçš„<code class="fe nv nw nx nk b">partial_dependence</code>å‡½æ•°æ¥æå–åŸå§‹å€¼ã€‚</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="0620" class="no mm it nk b gy np nq l nr ns">raw_values = partial_dependence(rf, X_train, var, kind='both')<br/>raw_values</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/84a6eb6c1249976d6abfceae97d9c1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*DqntFGkkvpSQZk4SMyxSCA.png"/></div></figure><p id="869a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†<code class="fe nv nw nx nk b">kind='both'</code>æ¥æŸ¥çœ‹å•ä¸ªé¢„æµ‹ä»¥åŠå¹³å‡é¢„æµ‹ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨å¹³å‡é¢„æµ‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code class="fe nv nw nx nk b">kind='average'</code>:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="72a0" class="no mm it nk b gy np nq l nr ns">partial_dependence(rf, X_train, var, kind='average')</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/8170c3d6efd72eed3c2c98ad74f33fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*DTcyIfi5G1KoAvWKzj0B6A.png"/></div></figure><p id="cde4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code class="fe nv nw nx nk b">partial_dependence(â€¦, kind='both')</code>å’Œ<code class="fe nv nw nx nk b">partial_dependence(â€¦, kind='average')</code>çš„å¹³å‡é¢„æµ‹å¯èƒ½ä¸æ€»æ˜¯ä¸ä¸€äº›æœºå™¨å­¦ä¹ ç®—æ³•å®Œå…¨åŒ¹é…ï¼Œå…¶ä¸­æ›´æœ‰æ•ˆçš„<code class="fe nv nw nx nk b">recursion</code>æ–¹æ³•å¯ç”¨äºåè€…ã€‚</p><p id="8c8b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬æ‰‹åŠ¨è®¡ç®—çš„å€¼æ˜¯å¦ä¸Scikit-learnçš„ç‰ˆæœ¬ç›¸åŒ¹é…:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="f2d4" class="no mm it nk b gy np nq l nr ns">print(np.array_equal(raw_values['individual'][0], individual))<br/>print(np.isclose(raw_values['average'][0], <br/>                 np.mean(individual, axis=0)))</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/d2c0018a7a25692a3a3a2e3bb7e5f796.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*bCSBqU5VYHg42BWtuOW-xg.png"/></div></figure><p id="aca8" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å¾ˆå¥½ï¼Œä»–ä»¬å¾ˆé…ï¼</p><p id="d8a0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nv nw nx nk b">PartialDependenceDisplay</code>å…è®¸æˆ‘ä»¬ç»˜åˆ¶å•ä¸ªé¢„æµ‹çš„å­é›†ä»¥åŠå¹³å‡å€¼ï¼Œä»¥æ›´å¥½åœ°ç†è§£æ•°æ®:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="e9ce" class="no mm it nk b gy np nq l nr ns">n = 50<br/>PartialDependenceDisplay.from_estimator(<br/>    rf, X_train, ['pclass'], kind="both", n_jobs=3, subsample=n<br/>)<br/>plt.legend(bbox_to_anchor=(1,1));</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/312c26e0e731c09436d270581b1e27d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*eNICz38OZb3r108PZbGkJg.png"/></div></figure><p id="a9f9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">è¿™æä¾›äº†æ›´å¤šçš„ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬å¯ä»¥ä»åŸå§‹å€¼ä¸­è‡ªå·±å¤åˆ¶ä¸€ä¸ªç±»ä¼¼çš„å›¾è¡¨:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="6d3a" class="no mm it nk b gy np nq l nr ns">sns.lineplot(x=values, y=individual.mean(axis=0), style=0, <br/>             markers=True, legend=False)<br/>sns.lineplot(data=pd.DataFrame(individual, columns=values)\<br/>                    .sample(n).reset_index().melt('index'), <br/>             x='variable', y='value', style='index', dashes=False, <br/>             legend=False, alpha=0.1, size=1, color='#63C1A4')<br/>plt.ylabel("Partial dependence")<br/>plt.xlabel(var);</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi om"><img src="../Images/b003514cdd07f1e8a24c39a21843a50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*8Z8HFQfA0YgnTCP6wKzgng.png"/></div></figure><p id="c812" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å¯¹äºåƒ<code class="fe nv nw nx nk b">pclass</code>è¿™æ ·çš„ç¦»æ•£å˜é‡ï¼Œæˆ‘ä»¬ä¸å¿…å±€é™äºçº¿å½¢å›¾ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨æ¡å½¢å›¾ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰å……åˆ†çš„è‡ªç”±ä»åŸå§‹å€¼æ„å»ºä»»ä½•å›¾è¡¨:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="b274" class="no mm it nk b gy np nq l nr ns">raw_df = pd.DataFrame(raw_values['individual'][0], <br/>                      columns=raw_values['values'])<br/>sns.barplot(data=raw_df.melt(var_name=var), x=var, y='value')<br/>plt.ylabel("Partial dependence");</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi on"><img src="../Images/45c5ddf9d1a475c74cdfda99a71e835a.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*cpRt1E0TCpZNxqhN4Hkz4w.png"/></div></figure><p id="8fbd" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">æˆ‘ä»¬å¾ˆå¯èƒ½ä¼šè€ƒè™‘PDPçš„å¤šä¸ªå˜é‡ã€‚äº†è§£äº†åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç»˜åˆ¶å¤šä¸ªå˜é‡çš„PDPçš„å‡ ç§æ–¹æ³•ã€‚</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="7822" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">ğŸ“ˆå¤šä¸ªå˜é‡çš„PDP</h1><p id="6064" class="pw-post-body-paragraph kr ks it kt b ku nd kd kw kx ne kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">ç”±äºæˆ‘ä»¬çš„ç©å…·æ•°æ®é›†æœ‰å°‘é‡çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬ä¸ºæ¯ä¸ªåŠŸèƒ½ç»˜åˆ¶PDPã€‚æˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨<code class="fe nv nw nx nk b">PartialDependenceDisplay</code>:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="f301" class="no mm it nk b gy np nq l nr ns">n_cols = 2<br/>n_rows = int(len(X_train.columns)/n_cols)</span><span id="ec79" class="no mm it nk b gy nt nq l nr ns">fig, ax = plt.subplots(n_rows, n_cols, figsize=(10, 12))<br/>PartialDependenceDisplay.from_estimator(rf, X_train, X_train.columns, ax=ax, n_cols=n_cols)<br/>fig.suptitle('Partial Dependence Plots')<br/>fig.tight_layout();</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8f9640d8d58be4e20bcccc50ff8afa7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*yN6sGIXaH5ZptLsRd1vYsw.png"/></div></figure><p id="84a5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ä»è¿™äº›å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç‰¹å¾å’Œé¢„æµ‹ä¹‹é—´çš„å…³ç³»ç±»å‹ã€‚ä¸€äº›å…³ç³»çœ‹èµ·æ¥æ˜¯çº¿æ€§çš„ï¼Œè€Œå¦ä¸€äº›åˆ™æ›´å¤æ‚ã€‚</p><p id="8604" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ ¹æ®ç”¨<code class="fe nv nw nx nk b">partial_dependence</code>æå–çš„åŸå§‹å€¼ç»˜åˆ¶PDP:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="8f2f" class="no mm it nk b gy np nq l nr ns">fig, ax = plt.subplots(n_rows, n_cols, figsize=(10,12), sharey=True)<br/>for i, x in enumerate(X_train.columns):<br/>    raw_values = partial_dependence(rf, X_train, i, kind='average')<br/>    loc = i//n_cols, i%n_cols<br/>    sns.lineplot(x=raw_values['values'][0], <br/>                 y=raw_values['average'][0], ax=ax[loc], style=0, <br/>                 markers=True, legend=False)<br/>    ax[loc].set_xlabel(x)<br/>    if i%n_cols==0:<br/>        ax[loc].set_ylabel('Partial dependence')<br/>fig.suptitle('Partial Dependence Plots')<br/>fig.tight_layout()</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi op"><img src="../Images/da613f39a98c2ae7e0f05479564c8752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*DWwXSYowGkr6onGBG2HF1A.png"/></div></figure><p id="5c91" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">æˆ–è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»˜åˆ¶å•ä¸ªé¢„æµ‹çš„å­é›†ï¼Œä¸ºæˆ‘ä»¬æä¾›å¹³å‡å€¼èƒŒåçš„æ›´å¤šèƒŒæ™¯ä¿¡æ¯:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="e035" class="no mm it nk b gy np nq l nr ns">plt.figure(figsize=(10,12))<br/>for i, x in enumerate(X_train.columns):<br/>    raw_values = partial_dependence(rf, X_train, i, kind='both')<br/>    ax = plt.subplot(n_rows, n_cols, i+1)<br/>    sns.lineplot(x=raw_values['values'][0], y=raw_values['average'][0], <br/>                 style=0, markers=True, legend=False, ax=ax)<br/>    sns.lineplot(data=pd.DataFrame(raw_values['individual'][0], <br/>                                   columns=raw_values['values'][0])\<br/>                        .sample(n).reset_index().melt('index'), <br/>                 x='variable', y='value', style='index', dashes=False, <br/>                 legend=False, alpha=0.1, size=1, color='#63C1A4')<br/>    ax.set_xlabel(x)<br/>    ax.set_ylabel('Partial dependence')<br/>plt.suptitle('Partial Dependence Plots')<br/>plt.tight_layout()</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5b2599eeb55514b42ee94e5158ec656a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*MIYJ6dcbp2EQYFQHfyLqxg.png"/></div></figure><p id="8cfb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">è¿™äº›å›¾å¸®åŠ©æˆ‘ä»¬ç†è§£ç‰¹å¾ä¹‹é—´çš„å…³ç³»ä»¥åŠå®ƒä»¬å¯¹ç›®æ ‡é¢„æµ‹çš„å½±å“ï¼Œå¹¶æ£€æµ‹æ¨¡å‹å­¦ä¹ çš„æ¨¡å¼æ˜¯å¦åˆç†å’Œå¯è§£é‡Šã€‚PDPè¿˜å¯ä»¥ç”¨æ¥ç›´è§‚åœ°è¯„ä¼°å’Œæ¯”è¾ƒæ¨¡å‹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä¸ºå¤šä¸ªæ¨¡å‹ç»˜åˆ¶PDPã€‚</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="60ec" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">ğŸ“‰å¤šä¸ªå‹å·çš„PDP</h1><p id="29a5" class="pw-post-body-paragraph kr ks it kt b ku nd kd kw kx ne kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">è®©æˆ‘ä»¬å†æ„å»ºä¸¤ä¸ªæ¨¡å‹ï¼Œå¹¶æå–æ‰€æœ‰ä¸‰ä¸ªæ¨¡å‹çš„åŸå§‹å€¼:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="2b72" class="no mm it nk b gy np nq l nr ns">pclass_df = pd.DataFrame(columns=values)<br/>pclass_df.loc['rf'] = partial_dependence(<br/>    rf, X_train, var, kind='average'<br/>)['average'][0]</span><span id="0f04" class="no mm it nk b gy nt nq l nr ns">ada = AdaBoostClassifier(random_state=42)<br/>ada.fit(X_train, y_train)<br/>evaluate(ada, X_train, y_train, X_test, y_test)</span><span id="60d3" class="no mm it nk b gy nt nq l nr ns">pclass_df.loc['ada'] = partial_dependence(<br/>    ada, X_train, var, kind='average'<br/>)['average'][0]</span><span id="57e6" class="no mm it nk b gy nt nq l nr ns">knn = KNeighborsClassifier()<br/>knn.fit(X_train, y_train)<br/>evaluate(knn, X_train, y_train, X_test, y_test)<br/>pclass_df.loc['knn'] = partial_dependence(<br/>    knn, X_train, var, kind='average'<br/>)['average'][0]<br/>pclass_df</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi or"><img src="../Images/c7d9cd4123df66a56937e7a6a9573849.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*V5gRamCivGXGfvWlksY7HQ.png"/></div></figure><p id="7cd1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ¯ä¸ªæ¨¡å‹çš„éƒ¨åˆ†ç›¸å…³æ€§:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="9af0" class="no mm it nk b gy np nq l nr ns">pclass_df = pclass_df.reset_index().melt('index')<br/>sns.lineplot(data=pclass_df, x='variable', y='value', <br/>             hue='index');<br/>sns.scatterplot(data=pclass_df, x='variable', y='value', <br/>                hue='index', legend=False)<br/>plt.legend(bbox_to_anchor=(1, 1))<br/>plt.ylabel("Partial dependence")<br/>plt.xlabel(var);</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi os"><img src="../Images/e730a610da73270da9b64a2f97ae012c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*vcN8HUKlNUWMJ9EBY17XEg.png"/></div></figure><p id="b00b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å¯¹äºAdaBoostå’ŒK-æœ€è¿‘é‚»åˆ†ç±»å™¨ï¼Œé¢„æµ‹æ¦‚ç‡å‡ ä¹ä¸ä¹˜å®¢ç±»åˆ«æ— å…³ã€‚</p><p id="e4c1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">ç°åœ¨è®©æˆ‘ä»¬å¯¹æ‰€æœ‰å˜é‡è¿›è¡Œç±»ä¼¼çš„æ¯”è¾ƒ:</p><pre class="lo lp lq lr gt nj nk nl nm aw nn bi"><span id="aa6f" class="no mm it nk b gy np nq l nr ns">summary = {}<br/>fig, ax = plt.subplots(n_rows, n_cols, figsize=(10,12), sharey=True)</span><span id="7a41" class="no mm it nk b gy nt nq l nr ns">for i, x in enumerate(X_train.columns):<br/>    summary[x] = pd.DataFrame(columns=values)<br/>    raw_values = partial_dependence(rf, X_train, x, kind='average')<br/>    summary[x] = pd.DataFrame(columns=raw_values['values'][0])<br/>    summary[x].loc['rf'] = raw_values['average'][0]<br/>    summary[x].loc['ada'] = partial_dependence(<br/>        ada, X_train, x, kind='average'<br/>    )['average'][0]<br/>    summary[x].loc['knn'] = partial_dependence(<br/>        knn, X_train, x, kind='average'<br/>    )['average'][0]<br/>    <br/>    data = summary[x].reset_index().melt('index')<br/>    loc = i//n_cols, i%n_cols<br/>    if i==1:<br/>        sns.lineplot(data=data, x='variable', y='value', <br/>                     hue='index',ax=ax[loc]);<br/>        ax[loc].legend(bbox_to_anchor=(1, 1));<br/>    else: <br/>        sns.lineplot(data=data, x='variable', y='value', <br/>                     hue='index', ax=ax[loc], legend=False);<br/>    sns.scatterplot(data=data, x='variable', y='value', <br/>                    hue='index', ax=ax[loc], legend=False)<br/>    ax[loc].set_xlabel(x)<br/>    if i%n_cols==0:<br/>        ax[loc].set_ylabel('Partial dependence')</span><span id="df2a" class="no mm it nk b gy nt nq l nr ns">fig.suptitle('Partial Dependence Plots')<br/>fig.tight_layout()</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/a34c466614e2418904068347a746b590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*1iIInaKhnhxYX_1ghg_kHw.png"/></div></figure><p id="64c3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">é€šè¿‡ä¸åŒçš„æ¨¡å‹æŸ¥çœ‹PDPæœ‰åŠ©äºé€‰æ‹©ä¸€ä¸ªæ›´åˆç†ã€æ›´æ˜“äºè§£é‡Šçš„æ¨¡å‹ã€‚</p><p id="2546" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">éƒ¨åˆ†ç›¸å…³å›¾æä¾›äº†é¢„æµ‹å¦‚ä½•å—ç‰¹å¾å˜åŒ–å½±å“çš„è§è§£ã€‚PDPçš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å®ƒå‡è®¾ç‰¹æ€§æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†åˆ†ç±»ç”¨ä¾‹ï¼Œä½†æ˜¯PDPä¹Ÿå¯ä»¥ç”¨äºå›å½’ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨æœ€ç®€å•çš„PDPå½¢å¼:å•å‘PDPã€‚å¯¹äºæ¸´æœ›äº†è§£PDPæ›´å¤šä¿¡æ¯çš„å­¦ä¹ è€…æ¥è¯´ï¼Œèƒ½å¤Ÿæ´å¯Ÿç‰¹æ€§ä¹‹é—´äº¤äº’çš„åŒå‘å’Œ/æˆ–ä¸‰å‘PDPæ˜¯å€¼å¾—ç ”ç©¶çš„æœ‰è¶£ä¸»é¢˜ã€‚</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ou"><img src="../Images/2957b470d3cb8ee044c86d389c4e1ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6RNcTLDvQTQcJ3gj"/></div></div><p class="lz ma gj gh gi mb mc bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae md" href="https://unsplash.com/@callumshaw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å¡å‹’å§†Â·è‚–</a>åœ¨<a class="ae md" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><p id="83b0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="ni">æ‚¨æƒ³è®¿é—®æ›´å¤šè¿™æ ·çš„å†…å®¹å—ï¼Ÿåª’ä½“ä¼šå‘˜å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“ä¸Šçš„ä»»ä½•æ–‡ç« ã€‚å¦‚æœä½ ä½¿ç”¨</em> <a class="ae md" href="https://zluvsand.medium.com/membership" rel="noopener"> <em class="ni">æˆ‘çš„æ¨èé“¾æ¥</em></a><em class="ni">æˆä¸ºä¼šå‘˜ï¼Œä½ çš„ä¸€éƒ¨åˆ†ä¼šè´¹ä¼šç›´æ¥å»æ”¯æŒæˆ‘ã€‚</em></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="fd43" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¿™é‡Œæœ‰æˆ‘çš„ä¸€äº›å…¶ä»–å¸–å­çš„é“¾æ¥:<br/> â—¼ï¸ï¸ <a class="ae md" rel="noopener" target="_blank" href="/explaining-scikit-learn-models-with-shap-61daff21b12a">è§£é‡Šscikit-learn models with shap</a><br/>â—¼ï¸ï¸<a class="ae md" rel="noopener" target="_blank" href="/meet-histgradientboostingclassifier-54a9df60d066?source=your_stories_page-------------------------------------">ä¼šè§histgradientsboostingclassifier</a><br/>â—¼ï¸ï¸<a class="ae md" rel="noopener" target="_blank" href="/from-ml-model-to-ml-pipeline-9f95c32c6512?source=your_stories_page-------------------------------------">ä»MLæ¨¡å‹åˆ°MLç®¡é“</a> <br/> â—¼ï¸ï¸ <a class="ae md" rel="noopener" target="_blank" href="/4-simple-tips-for-plotting-multiple-graphs-in-python-38df2112965c">ç”¨Pythonç»˜åˆ¶å¤šä¸ªå›¾å½¢çš„4ä¸ªç®€å•æŠ€å·§</a> <br/> â—¼ï¸ <a class="ae md" rel="noopener" target="_blank" href="/prettifying-pandas-dataframes-75c1a1a6877d">ç¾åŒ–ç†ŠçŒ«æ•°æ®å¸§</a> <br/> â—¼ <a class="ae md" rel="noopener" target="_blank" href="/simple-data-visualisations-in-python-that-you-will-find-useful-5e42c92df51e">ç®€å•çš„æ•°æ®å¯è§†åŒ–</a></p><p id="ef2f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">å†è§ğŸƒ ğŸ’¨</p></div></div>    
</body>
</html>