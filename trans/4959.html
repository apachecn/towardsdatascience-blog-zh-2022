<html>
<head>
<title>How to Automate Your Mongo Database Backups on Kubernetes and S3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Kuberneteså’ŒS3ä¸Šè‡ªåŠ¨åŒ–æ‚¨çš„Mongoæ•°æ®åº“å¤‡ä»½</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/how-to-automate-your-mongo-database-backups-on-kubernetes-795bb9a6c9eb#2022-11-04">https://towardsdatascience.com/how-to-automate-your-mongo-database-backups-on-kubernetes-795bb9a6c9eb#2022-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2cf0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">è®¡åˆ’å¹¶è‡ªåŠ¨æ‰§è¡Œä»Kubernetesé›†ç¾¤åˆ°AWS S3çš„æ•°æ®åº“å¤‡ä»½</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0cdd3105ea1340db7ee5acf0f170064f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OsyJ9ZxHPTf7RZQD"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ç”±<a class="ae kv" href="https://unsplash.com/@artwall_hd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">è‰ºæœ¯å£çº¸æ‹æ‘„çš„ç…§ç‰‡</a>åœ¨<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Š</p></figure><p id="52ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæ‚¨è¿è¡Œçš„æ˜¯MongoDBä¹‹ç±»çš„è‡ªæ‰˜ç®¡æ•°æ®åº“ï¼Œé‚£ä¹ˆæ‚¨å¾ˆå¯èƒ½äº«å—ä¸åˆ°æ‰˜ç®¡æœåŠ¡æä¾›çš„è‡ªåŠ¨å¤‡ä»½çš„å¥½å¤„ã€‚</p><p id="6bf9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æœ¬æ–‡æ˜¯å…³äºå¦‚ä½•ä½¿ç”¨<a class="ae kv" href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/" rel="noopener ugc nofollow" target="_blank"> Kubernetes CronJobs </a>åœ¨Kubernetesé›†ç¾¤ä¸Šä¸ºMongoDBå®‰æ’è‡ªåŠ¨å¤‡ä»½ä½œä¸šï¼Œå¹¶å°†è¿™äº›å¤‡ä»½å­˜å‚¨åœ¨<a class="ae kv" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS S3æ¡¶</a>ä¸­ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/2928b06d690a0ca1a9e2c1e3ccd1070c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brxE8DH9v3Ek0xBK6dkViA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">è®¡åˆ’å®šæœŸæ‰§è¡Œå¤‡ä»½ä½œä¸šï¼Œä»æ•°æ®åº“ä¸­æå–æ•°æ®ï¼Œæ‰¿æ‹…IAMè§’è‰²ä»¥è·å–å‡­æ®ï¼Œç„¶åä¸Šä¼ åˆ°S3â€”æŒ‰ä½œè€…æ’åºçš„å›¾åƒ</p></figure><p id="c498" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬å°†å…³æ³¨ä¸€ä¸ªç‹¬ç«‹çš„MongoDBè®¾ç½®ï¼ŒåŒæ ·çš„åŸåˆ™ä¹Ÿé€‚ç”¨äºå‰¯æœ¬é›†å’Œå…¶ä»–æ•°æ®åº“ã€‚</p><p id="7b5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç”±äºè®¸å¤šç»„ç»‡ä½¿ç”¨Terraformæ¥ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œæˆ‘ä»¬å°†ç›´æ¥ç”¨Terraformæ ¼å¼ç¼–å†™CronJobã€‚</p><h2 id="bbf7" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">æŠ€æœ¯æ ˆ</h2><ul class=""><li id="4f56" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated">MongoDB</li><li id="6f1d" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">åº“ä¼¯å†…ç‰¹æ–¯</li><li id="7ea7" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">AWS S3</li><li id="3282" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">å°†ï¼ˆè¡Œæ˜Ÿï¼‰åœ°çƒåŒ–ï¼ˆä»¥é€‚åˆäººç±»å±…ä½ï¼‰</li><li id="4483" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">ç å¤´å·¥äºº</li></ul><h2 id="1a4a" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">å†…å®¹</h2><ul class=""><li id="e03b" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated">åˆ›å»ºåœ°å½¢æ¨¡å—(å¯é€‰)</li><li id="3c8e" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">ä½¿ç”¨æ‰€éœ€çš„å·¥å…·åˆ›å»ºDockeræ˜ åƒ</li><li id="6100" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">å®šä¹‰å˜é‡å’Œæ•°æ®</li><li id="b6ad" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">åˆ›å»ºä¸€ä¸ªS3å­˜å‚¨æ¡¶æ¥å­˜å‚¨å¤‡ä»½</li><li id="f52b" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">åˆ›å»ºIAMè§’è‰²å’ŒKubernetesæœåŠ¡å¸æˆ·</li><li id="3e87" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">å°†MongoDBçš„å¯†ç å­˜å‚¨ä¸ºKubernetesçš„ç§˜å¯†</li><li id="3e80" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">åˆ›å»ºåº“ä¼¯å†…ç‰¹å…‹æœ—ä¹”å¸ƒ</li><li id="f5af" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">éƒ¨ç½²åŸºç¡€è®¾æ–½</li><li id="82d8" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">è¯´æ˜</li></ul><p id="a20d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><blockquote class="nj nk nl"><p id="918a" class="kw kx nm ky b kz la jr lb lc ld ju le nn lg lh li no lk ll lm np lo lp lq lr ij bi translated"><strong class="ky ir">éœ€æ±‚:</strong> <br/>æœ¬é¡¹ç›®ä½¿ç”¨Terraformä¸<a class="ae kv" href="https://registry.terraform.io/providers/hashicorp/aws/4.38.0" rel="noopener ugc nofollow" target="_blank"> AWSæä¾›å•†</a>å’Œ<a class="ae kv" href="https://registry.terraform.io/providers/hashicorp/kubernetes/2.15.0" rel="noopener ugc nofollow" target="_blank"> Kubernetesæä¾›å•†</a>ã€‚<br/>è¯·éšæ„æŸ¥çœ‹å®˜æ–¹æ•™ç¨‹<a class="ae kv" href="https://developer.hashicorp.com/terraform/tutorials/kubernetes/eks" rel="noopener ugc nofollow" target="_blank">é…ç½®EKSé›†ç¾¤</a>ä»¥å¯åŠ¨å¹¶è¿è¡ŒKubernetesé›†ç¾¤ã€‚</p></blockquote><h1 id="3b7c" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">åˆ›å»ºåœ°å½¢æ¨¡å—(å¯é€‰)</h1><p id="60d9" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">ä¸ºäº†åœ¨åŸºç¡€è®¾æ–½å³ä»£ç å­˜å‚¨åº“ä¸­ä¿æŒç»“æ„åŒ–å’Œæ•´æ´ï¼Œæˆ‘å–œæ¬¢å°†é€»è¾‘ä»»åŠ¡åˆ’åˆ†ä¸ºå­æ¨¡å—ã€‚</p><p id="dfbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¯·æ³¨æ„ï¼Œè¿™æ˜¯å¯é€‰çš„ï¼Œæ‚¨å¯ä»¥å°†ä¸‹é¢åˆ›å»ºçš„æ¨¡æ¿åŒ…å«åœ¨åŸºç¡€è®¾æ–½æºä»£ç ä¸­çš„ä»»ä½•ä½ç½®ã€‚</p><p id="5bd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è®©æˆ‘ä»¬åœ¨<strong class="ky ir">æ¨¡å—</strong>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç›®å½•<strong class="ky ir">æ•°æ®åº“å¤‡ä»½</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/bc52d292e3997789d9ac91efdd62bfdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*EZZ0ZtoxgLm0W7YgcNgdYw.png"/></div></figure><h1 id="f8bc" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">ä½¿ç”¨æ‰€éœ€çš„å·¥å…·åˆ›å»ºDockeræ˜ åƒ</h1><p id="ab82" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">ä¸ºäº†æ‰§è¡Œå¤‡ä»½ï¼Œæˆ‘ä»¬éœ€è¦ä»æ•°æ®åº“ä¸­è½¬å‚¨æ•°æ®ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°S3ã€‚</p><p id="f27a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨æ–¹ä¾¿çš„<a class="ae kv" href="https://www.mongodb.com/docs/database-tools/mongodump/" rel="noopener ugc nofollow" target="_blank"><em class="nm">mongodump</em></a><em class="nm"/>æ¥è½¬å‚¨æ•°æ®ï¼Œå¹¶ä½¿ç”¨<a class="ae kv" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> AWS CLI </em> </a>å°†æ•°æ®è½¬å‚¨ä¸Šä¼ åˆ°S3ã€‚</p><p id="0a7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨ä¸Šé¢åˆ›å»ºçš„Terraformæ¨¡å—ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç›®å½•<strong class="ky ir"> mongodb </strong>ï¼Œå¹¶åœ¨è¿™ä¸ªæ–°ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<strong class="ky ir"> Dockerfile </strong>ï¼Œå…¶å†…å®¹å¦‚ä¸‹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="9079" class="lt lu iq og b gy ok ol l om on"># Dockerfile</span><span id="e585" class="lt lu iq og b gy oo ol l om on"># Base on Amazon Linux 2 (will be running on AWS EKS)<br/>FROM amazonlinux:2</span><span id="28b7" class="lt lu iq og b gy oo ol l om on">RUN yum install -y unzip</span><span id="f481" class="lt lu iq og b gy oo ol l om on"># Install AWS CLI<br/>RUN curl -sOL <a class="ae kv" href="https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" rel="noopener ugc nofollow" target="_blank">https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip</a> \<br/> &amp;&amp; unzip awscli-exe-linux-x86_64.zip \<br/> &amp;&amp; ./aws/install</span><span id="862b" class="lt lu iq og b gy oo ol l om on"># Install MongoDB CLI tools<br/>RUN curl -sOL <a class="ae kv" href="https://fastdl.mongodb.org/tools/db/mongodb-database-tools-amazon2-x86_64-100.6.0.rpm" rel="noopener ugc nofollow" target="_blank">https://fastdl.mongodb.org/tools/db/mongodb-database-tools-amazon2-x86_64-100.6.0.rpm</a> \<br/> &amp;&amp; yum install -y mongodb-database-tools-amazon2-x86_64-100.6.0.rpm</span></pre><h2 id="d728" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">æ„å»ºè¯¥æ˜ åƒå¹¶å°†å…¶æ¨é€åˆ°æ‚¨çš„æ˜ åƒå­˜å‚¨åº“</h2><p id="d95a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">è®©æˆ‘ä»¬æ„å»ºè¿™ä¸ªæ˜ åƒï¼Œå¹¶ç¡®ä¿ä»¥æ­£ç¡®çš„å¹³å°ä¸ºç›®æ ‡â€”â€”å¦‚æœæ‚¨åœ¨è¿è¡Œé›†ç¾¤çš„æœºå™¨ä¹‹å¤–çš„å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œå¼€å‘(æ¯”å¦‚å¸¦æœ‰M1èŠ¯ç‰‡çš„Macbook ),è¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="56bd" class="lt lu iq og b gy ok ol l om on">export REPOSITORY_URL=&lt;your repository URL, e.g. on AWS ECR&gt;<br/>export TAG=&lt;COMMIT_HASH&gt; # Should be commit hash, but can be an arbitrary string</span><span id="8bc3" class="lt lu iq og b gy oo ol l om on">docker build --tag="$REPOSITORY_URL:$TAG" --platform=linux/amd64 .</span></pre><p id="815e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¦æ¨é€æ˜ åƒï¼Œè¯·ç¡®ä¿æ‚¨å·²ç™»å½•åˆ°æ‚¨çš„å­˜å‚¨åº“(è¿è¡Œ<em class="nm"> dockerç™»å½•</em>ï¼Œç„¶åè¿è¡Œ:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="95c4" class="lt lu iq og b gy ok ol l om on">docker push "$REPOSITORY_URL:$TAG"</span></pre><h1 id="53f5" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">å®šä¹‰å˜é‡å¹¶è·å–æ•°æ®</h1><p id="06a1" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›Terraformé…ç½®å˜é‡ï¼Œå¹¶è·å–å°†åœ¨è¯¥é¡¹ç›®çš„å…¶ä½™éƒ¨åˆ†ä½¿ç”¨çš„æ•°æ®ã€‚è¯·éšæ„è°ƒæ•´è¿™äº›ä»¥é€‚åº”æ‚¨å½“å‰çš„è®¾ç½®ã€‚</p><p id="b500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æ–‡ä»¶å<strong class="ky ir"> variables.tf </strong>ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="8505" class="lt lu iq og b gy ok ol l om on"># variables.tf</span><span id="d735" class="lt lu iq og b gy oo ol l om on">variable "kubernetes_namespace" {<br/>  type = string<br/>}</span><span id="7689" class="lt lu iq og b gy oo ol l om on">variable "kubernetes_cluster_name" {<br/>  description = "Kubernetes cluster where the backup job and permissions service account should be deployed"<br/>  type        = string<br/>}</span><span id="b3c7" class="lt lu iq og b gy oo ol l om on">variable "container_image_repository" {<br/>  description = "URL of the Docker image used in the CronJob container"<br/>  type        = string<br/>}</span><span id="d21b" class="lt lu iq og b gy oo ol l om on">variable "container_image_tag" {<br/>  description = "Tag of the Docker image used in the CronJob container"<br/>  type        = string<br/>}</span><span id="94c3" class="lt lu iq og b gy oo ol l om on">variable "database_host" {<br/>  description = "MongoDB host URL"<br/>  type        = string<br/>}</span><span id="e5e9" class="lt lu iq og b gy oo ol l om on">variable "database_user" {<br/>  description = "MongoDB user"<br/>  type        = string<br/>}</span><span id="c80c" class="lt lu iq og b gy oo ol l om on">variable "database_password" {<br/>  description = "MongoDB password"<br/>  type        = string<br/>  sensitive   = true<br/>}</span></pre><p id="e641" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨åä¸º<strong class="ky ir"> data.tf </strong>çš„æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="c14f" class="lt lu iq og b gy ok ol l om on"># data.tf</span><span id="bd49" class="lt lu iq og b gy oo ol l om on">data "aws_caller_identity" "current" {}</span><span id="1a4c" class="lt lu iq og b gy oo ol l om on">data "aws_eks_cluster" "kubernetes_cluster" {<br/>  name = var.kubernetes_cluster_name<br/>}</span></pre><h1 id="b6e7" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">åˆ›å»ºä¸€ä¸ªS3å­˜å‚¨æ¡¶æ¥å­˜å‚¨å¤‡ä»½</h1><p id="d027" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯é çš„ä½ç½®æ¥å­˜å‚¨æˆ‘ä»¬çš„å¤‡ä»½ï¼ŒAWS S3å…¬å¸æä¾›äº†<a class="ae kv" href="https://aws.amazon.com/s3/faqs/#:~:text=Q%3A%20How%20reliable%20is%20Amazon%20S3%3F" rel="noopener ugc nofollow" target="_blank">è‰¯å¥½çš„ä¿è¯</a>ï¼Œè€Œä¸”ä»·æ ¼å®æƒ ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚</p><p id="23a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åˆ›å»ºä¸€ä¸ªåœ°å½¢æ–‡ä»¶<strong class="ky ir"> s3-bucket.tf </strong>ï¼Œå†…å®¹å¦‚ä¸‹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="b037" class="lt lu iq og b gy ok ol l om on"># s3-bucket.tf</span><span id="9678" class="lt lu iq og b gy oo ol l om on">resource "aws_s3_bucket" "database_backup_storage" {<br/>  lifecycle {<br/>    # Prevent destroying the backups storage in case of accidental tear down<br/>    prevent_destroy = true<br/>  }</span><span id="ae5d" class="lt lu iq og b gy oo ol l om on">  bucket = "database-backup-storage"<br/>}</span></pre><p id="5b56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸç­–ç•¥æ¥è‡ªåŠ¨åˆ é™¤è¶…è¿‡7å¤©çš„å¤‡ä»½ã€‚åœ¨åŒä¸€æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="4da1" class="lt lu iq og b gy ok ol l om on"># s3-bucket.tf</span><span id="e2ce" class="lt lu iq og b gy oo ol l om on">...</span><span id="b34a" class="lt lu iq og b gy oo ol l om on">resource "aws_s3_bucket_lifecycle_configuration" "database_backup_storage_lifecycle" {<br/>  bucket = aws_s3_bucket.database_backup_storage.bucket<br/>  rule {<br/>    id     = "delete-old-backups-7d"<br/>    status = "Enabled"<br/>    <br/>    filter {}</span><span id="d796" class="lt lu iq og b gy oo ol l om on">    expiration {<br/>      days = 7<br/>    }<br/>  }<br/>}</span></pre><h1 id="b5d5" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">åˆ›å»ºIAMè§’è‰²å’ŒKubernetesæœåŠ¡å¸æˆ·</h1><p id="2280" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">æˆ‘ä»¬çš„å¤‡ä»½ä½œä¸šéœ€è¦å°†å¤‡ä»½ä¸Šä¼ åˆ°S3çš„æƒé™ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º:</p><ul class=""><li id="650e" class="mm mn iq ky b kz la lc ld lf op lj oq ln or lr mt mu mv mw bi translated">ä¸€ä¸ª<a class="ae kv" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html" rel="noopener ugc nofollow" target="_blank"> IAMè§’è‰²</a>ï¼Œå…¶ç­–ç•¥å…è®¸<strong class="ky ir"> S3:PutObject </strong>åœ¨å¤‡ä»½S3æ¡¶ä¸­æ“ä½œ</li><li id="f42b" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">ä¸€ä¸ª<a class="ae kv" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" rel="noopener ugc nofollow" target="_blank"> KubernetesæœåŠ¡å¸æˆ·</a>æä¾›ä¸€ä¸ªwebèº«ä»½ä»¤ç‰Œï¼Œå…è®¸å¤‡ä»½ä½œä¸šæ‰¿æ‹…IAMè§’è‰²ä¸Šä¼ åˆ°S3</li></ul><p id="bffe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¿™é‡Œæœ‰å…³äºAWS EKS ä¸ŠæœåŠ¡å¸æˆ·çš„<a class="ae kv" href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" rel="noopener ugc nofollow" target="_blank"> IAMè§’è‰²çš„æ–‡æ¡£ã€‚</a></p><p id="62c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨åä¸º<strong class="ky ir"> access-control.tf </strong>çš„æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="4bc2" class="lt lu iq og b gy ok ol l om on"># access-control.tf</span><span id="1bfd" class="lt lu iq og b gy oo ol l om on">locals {<br/>  service_account_name = "database-backup"</span><span id="c066" class="lt lu iq og b gy oo ol l om on">  oidc_provider = replace(<br/>    data.aws_eks_cluster.kubernetes_cluster.identity[0].oidc[0].issuer,<br/>    "/^<a class="ae kv" href="https:///" rel="noopener ugc nofollow" target="_blank">https:///</a>",<br/>    ""<br/>  )<br/>}</span><span id="6091" class="lt lu iq og b gy oo ol l om on">resource "aws_iam_role" "role" {<br/>  name = "database-backup-role"</span><span id="a622" class="lt lu iq og b gy oo ol l om on">  assume_role_policy = jsonencode({<br/>    Version = "2012-10-17",<br/>    Statement = [<br/>      {<br/>        Effect = "Allow",<br/>        Principal = {<br/>          Federated = "arn:aws:iam::${data.aws_caller_identity.current.account_id}:oidc-provider/${local.oidc_provider}"<br/>        },<br/>        Action = "sts:AssumeRoleWithWebIdentity",<br/>        Condition = {<br/>          StringEquals = {<br/>            "${local.oidc_provider}:aud" = "sts.amazonaws.com",<br/>            "${local.oidc_provider}:sub" = "system:serviceaccount:${var.kubernetes_namespace}:${local.service_account_name}"<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  })</span><span id="061a" class="lt lu iq og b gy oo ol l om on">  inline_policy {<br/>    name = "AllowS3PutObject"<br/>    policy = jsonencode({<br/>      Version = "2012-10-17"<br/>      Statement = [<br/>        {<br/>          Action = [<br/>            "S3:PutObject",<br/>          ]<br/>          Effect   = "Allow"<br/>          Resource = "${aws_s3_bucket.database_backup_storage.arn}/*"<br/>        }<br/>      ]<br/>    })<br/>  }<br/>}</span><span id="08dd" class="lt lu iq og b gy oo ol l om on">resource "kubernetes_service_account" "iam" {<br/>  metadata {<br/>    name      = local.service_account_name<br/>    namespace = var.kubernetes_namespace</span><span id="277d" class="lt lu iq og b gy oo ol l om on">  annotations = {<br/>      "eks.amazonaws.com/role-arn" = aws_iam_role.role.arn<br/>      "eks.amazonaws.com/sts-regional-endpoints" = true<br/>    }<br/>  }<br/>}</span></pre><h1 id="4b46" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">åˆ›å»ºåº“ä¼¯å†…ç‰¹å…‹æœ—ä¹”å¸ƒ</h1><p id="2021" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Terraformä»¥HCLæ ¼å¼å®šä¹‰æˆ‘ä»¬çš„CronJob(å‚è§<a class="ae kv" href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/cron_job" rel="noopener ugc nofollow" target="_blank"> kubernetes_cron_job </a>)ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Kubernetesæ¸…å•æ ¼å¼(yaml/json)ä¸­åº”ç”¨ç›¸åŒçš„é…ç½®ã€‚</p><p id="dac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨åä¸º<strong class="ky ir"> backup-cronjob.tf </strong>çš„æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="8743" class="lt lu iq og b gy ok ol l om on"># backup-cronjob.tf</span><span id="aed3" class="lt lu iq og b gy oo ol l om on">resource "kubernetes_cron_job" "database_backup_cronjob" {<br/>  metadata {<br/>    name      = "database-backup-mongodb-daily"<br/>    namespace = var.kubernetes_namespace<br/>  }</span><span id="72ca" class="lt lu iq og b gy oo ol l om on">  spec {<br/>    schedule                      = "0 5 * * *" // At 05:00<br/>    concurrency_policy            = "Replace"<br/>    suspend                       = false<br/>    successful_jobs_history_limit = 3<br/>    failed_jobs_history_limit     = 3</span><span id="324c" class="lt lu iq og b gy oo ol l om on">    job_template {<br/>      metadata {}<br/>      spec {<br/>        template {<br/>          metadata {}<br/>          spec {<br/>            restart_policy = "Never"</span><span id="fb5b" class="lt lu iq og b gy oo ol l om on">            service_account_name = kubernetes_service_account.iam.metadata[0].name</span><span id="4a9d" class="lt lu iq og b gy oo ol l om on">            container {<br/>              name    = "database-backup"<br/>              image   = "${var.container_image_repository}:${var.container_image_tag}"<br/>              command = ["/bin/sh", "-c"]<br/>              args = [<br/>                "mongodump --host=\"$MONGODB_HOST\" --username=\"$MONGODB_USER\" --password=\"$MONGODB_PASSWORD\" --gzip --archive | aws s3 cp - s3://$S3_BUCKET/$S3_BUCKET_PREFIX/$(date +\"%Y%m%d-%H%M%S-%Z\").archive.gz"<br/>              ]</span><span id="0d3b" class="lt lu iq og b gy oo ol l om on">              env {<br/>                name  = "MONGODB_HOST"<br/>                value = var.database_host<br/>              }<br/>              env {<br/>                name  = "MONGODB_USER"<br/>                value = var.database_user<br/>              }<br/>              env {<br/>                name  = "MONGODB_PASSWORD"<br/>                value = var.database_password<br/>              }</span><span id="846d" class="lt lu iq og b gy oo ol l om on">              # Note that you can also set the DB password as a Kubernetes Secret then get it as<br/>              # env {<br/>              #   name = "MONGODB_PASSWORD"<br/>              #   value_from {<br/>              #     secret_key_ref {<br/>              #       name = "mongodb"<br/>              #       key  = "mongodb-password"<br/>              #     }<br/>              #   }<br/>              # }</span><span id="0f4d" class="lt lu iq og b gy oo ol l om on">              env {<br/>                name  = "S3_BUCKET"<br/>                value = aws_s3_bucket.database_backup_storage.bucket<br/>              }<br/>              env {<br/>                name  = "S3_BUCKET_PREFIX"<br/>                value = "mongodb"<br/>              }</span><span id="f26b" class="lt lu iq og b gy oo ol l om on">resources {<br/>                limits = {<br/>                  cpu    = "1000m"<br/>                  memory = "1000Mi"<br/>                }<br/>                requests = {<br/>                  cpu    = "100m"<br/>                  memory = "256Mi"<br/>                }<br/>              }<br/>            }<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h1 id="94d9" class="nq lu iq bd lv nr ns nt ly nu nv nw mb jw nx jx me jz ny ka mh kc nz kd mk oa bi translated">éƒ¨ç½²åŸºç¡€è®¾æ–½</h1><p id="e2cf" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">æ—¢ç„¶æˆ‘ä»¬çš„å¤‡ä»½æ¨¡å—å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶ä¸åŸºç¡€æ¶æ„çš„å…¶ä½™éƒ¨åˆ†ä¸€èµ·éƒ¨ç½²äº†ã€‚</p><p id="3583" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯ä»¥åœ¨Terraformä»£ç ä¸­æ”¾ç½®ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œä¾‹å¦‚åœ¨<strong class="ky ir"> main.tf </strong>ä¸­:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="b703" class="lt lu iq og b gy ok ol l om on">module "mongodb_backup" {<br/>  source = "${path.root}/modules/database-backup"</span><span id="5fbf" class="lt lu iq og b gy oo ol l om on">  kubernetes_namespace       = "&lt;your namespace&gt;"<br/>  kubernetes_cluster_name    = "&lt;your cluster name&gt;"<br/>  container_image_repository = "&lt;Value of REPOSITORY_URL&gt;"<br/>  container_image_tag        = "&lt;Value of TAG&gt;"<br/>  database_host              = &lt;MongoDB host&gt;<br/>  database_user              = &lt;MongoDB user&gt;<br/>  database_password          = &lt;MongoDB password&gt;</span><span id="ebac" class="lt lu iq og b gy oo ol l om on">  tags = {<br/>    Name = "database-backup-mongodb"<br/>  }<br/>}</span></pre><p id="1f68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸€æ—¦åº”ç”¨äº†terraformåŸºç¡€è®¾æ–½(<em class="nm"> terraform apply) </em>ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªCronJobå¯åŠ¨å¹¶è¿è¡Œ:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/b2e37e4d2ae9c95c9c71b3a169bc9194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRKtN5nGSdIxM9xivwevjA.png"/></div></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="354a" class="nq lu iq bd lv nr ot nt ly nu ou nw mb jw ov jx me jz ow ka mh kc ox kd mk oa bi translated">è¯´æ˜</h1><h2 id="2784" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„</h2><p id="74c2" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">A <a class="ae kv" href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/" rel="noopener ugc nofollow" target="_blank"> Kubernetes CronJob </a>è°ƒåº¦<em class="nm">ä½œä¸š</em>ä½œä¸ºèƒ½å¤Ÿæ‰§è¡Œç»™å®šä»»åŠ¡çš„podè¿è¡Œã€‚åœ¨è¿™ç§æ•°æ®åº“å¤‡ä»½å®æ–½çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè®¡åˆ’çš„ä½œä¸šå°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:</p><ol class=""><li id="8852" class="mm mn iq ky b kz la lc ld lf op lj oq ln or lr oy mu mv mw bi translated">è¿æ¥åˆ°ä½äº$MONGODB_HOSTçš„ç‹¬ç«‹ä¸»æœº</li><li id="51a5" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr oy mu mv mw bi translated">ä½¿ç”¨<a class="ae kv" href="https://www.mongodb.com/docs/database-tools/mongodump/" rel="noopener ugc nofollow" target="_blank"><em class="nm">mongodump</em></a><em class="nm"/>å°†æ•°æ®è½¬å‚¨ä¸ºå‹ç¼©(gzip)æ–‡ä»¶ï¼Œå¹¶å°†ç»“æœæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚è¿™é‡Œæœ‰ä¸‰ä»¶äº‹:(1)æˆ‘ä»¬å‹ç¼©ä»¥å‡å°‘ä¸Šä¼ è´Ÿè½½çš„å¤§å°ï¼Œ(2)æˆ‘ä»¬å­˜æ¡£ä»¥å°†æ•°æ®è½¬å‚¨åˆ°å•ä¸ªæ–‡ä»¶ä¸­(è¿™æ˜¯å¯é€‰çš„ï¼Œä½†å¯ä»¥é˜²æ­¢è½¬å‚¨åˆ°ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿæ—¶å‡ºç°é—®é¢˜â€”â€”å‚è§<a class="ae kv" href="https://www.mongodb.com/docs/database-tools/mongodump/#behavior" rel="noopener ugc nofollow" target="_blank">è­¦å‘Šè¿™é‡Œçš„</a>)ï¼Œ(3)æˆ‘ä»¬å°†è½¬å‚¨æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä»¥ä¾¿èƒ½å¤Ÿé€šè¿‡ç®¡é“å°†å…¶ä¼ è¾“åˆ°AWS CLIã€‚</li><li id="625c" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr oy mu mv mw bi translated">å°†å‹ç¼©çš„å½’æ¡£æ–‡ä»¶é€šè¿‡ç®¡é“ä¼ è¾“åˆ°AWS CLI</li><li id="ee40" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr oy mu mv mw bi translated">é€šè¿‡ä»¥ä¸‹æ–¹å¼ä»æ ‡å‡†è¾“å…¥(ç®¡é“)å¤åˆ¶åˆ°S3æ—¶æ®µ:</li></ol><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="fcb7" class="lt lu iq og b gy ok ol l om on">aws s3 cp - s3://$S3_BUCKET</span></pre><h2 id="a9f3" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">å¦‚ä½•æ¢å¤æ•°æ®</h2><ol class=""><li id="52b8" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr oy mu mv mw bi translated">å°†æœ€æ–°çš„æ•°æ®ä»S3ä¸‹è½½åˆ°æ‚¨çš„æœ¬åœ°æˆ–ç›®æ ‡Mongoä¸»æœº(å³æ‚¨å¸Œæœ›æ¢å¤æ•°æ®çš„ä½ç½®):</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/2971e43f931c15434afa4a0a7fd988fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPWc-Wm2fc0J4esxcoz9-Q.png"/></div></div></figure><p id="fb53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.ä½¿ç”¨<a class="ae kv" href="https://www.mongodb.com/docs/database-tools/mongorestore/" rel="noopener ugc nofollow" target="_blank"> <em class="nm"> mongorestore </em> </a>å®ç”¨ç¨‹åº:</p><pre class="kg kh ki kj gt of og oh oi aw oj bi"><span id="acd3" class="lt lu iq og b gy ok ol l om on">mongorestore --gzip --archive=/path/to/backup [--host $HOST --username $USERNAME --password $PASSWORD]</span></pre><h2 id="463f" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">é‡è¦çš„</h2><ul class=""><li id="d889" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated">è¯¥æ—¶é—´è¡¨åº”è¯¥æ ¹æ®æ‚¨çš„éœ€è¦è¿›è¡Œæ›´æ”¹â€”â€”ä¸Šé¢çš„è®¾ç½®æ˜¯ç›¸å¯¹äºæ‚¨çš„Kubernetesé›†ç¾¤æ—¶åŒºçš„5:00ã€‚</li><li id="0edf" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">MongoDBå¤‡ä»½è¢«é…ç½®ä¸ºä½¿ç”¨å•ä¸ªå®ä¾‹ã€‚ç›¸åº”åœ°æ›´æ”¹å‰¯æœ¬é›†çš„é…ç½®(å‚è§<a class="ae kv" href="https://www.mongodb.com/docs/database-tools/mongodump/#std-option-mongodump.--oplog" rel="noopener ugc nofollow" target="_blank"> <em class="nm">æ“ä½œæ—¥å¿—</em> </a>çš„ç”¨æ³•)ã€‚</li><li id="9486" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">MongoDBæœåŠ¡å™¨çš„ç‰ˆæœ¬å¿…é¡»ä¸å¤‡ä»½è½¬å‚¨æ‰€æºè‡ªçš„æ•°æ®åº“çš„ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚</li></ul></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="b386" class="nq lu iq bd lv nr ot nt ly nu ou nw mb jw ov jx me jz ow ka mh kc ox kd mk oa bi translated">æœ€ç»ˆæ³¨é‡Š</h1><p id="48f4" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf ob lh li lj oc ll lm ln od lp lq lr ij bi translated">å½“è¿è¡Œè‡ªæ‰˜ç®¡æ•°æ®åº“æ—¶ï¼Œéœ€è¦é‡‡å–é¢å¤–çš„æ­¥éª¤æ¥è®¾ç½®é˜²æ­¢æ•°æ®ä¸¢å¤±çš„æªæ–½â€”ä»¥é˜²ç¾éš¾ã€æ„å¤–åˆ é™¤ã€ç¡¬ä»¶æ•…éšœç­‰ã€‚</p><p id="e065" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»¤äººæ¬£æ…°çš„æ˜¯ï¼Œæœ€å¸¸è§çš„æ•°æ®åº“æä¾›äº†ç”Ÿæˆå’Œæ¢å¤å¤‡ä»½çš„å·¥å…·ï¼ŒåƒAWS S3è¿™æ ·çš„äº‘å­˜å‚¨è§£å†³æ–¹æ¡ˆæ˜¯å¯é çš„ï¼Œç»æµçš„ï¼Œå¹¶ä¸”ä½¿ç”¨æ–¹ä¾¿ã€‚</p><p id="ea4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åˆ©ç”¨åƒKubernetes CronJob è¿™æ ·çš„ä½œä¸šè°ƒåº¦ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨è§£å†³æ–¹æ¡ˆï¼Œåœ¨ä¸“æ³¨äºæ„å»ºä»¤äººæƒŠå¹çš„åº”ç”¨ç¨‹åºçš„åŒæ—¶ï¼Œè´Ÿè´£å¤‡ä»½æ•°æ®ğŸ‰ï¼</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="98e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ•™ç¨‹æœ‰ç”¨ï¼Œå¹¶ä¸”ä½ æƒ³æ”¯æŒé«˜è´¨é‡æ–‡ç« çš„åˆ¶ä½œï¼Œè€ƒè™‘<a class="ae kv" href="https://www.buymeacoffee.com/redouaneachouri" rel="noopener ugc nofollow" target="_blank">ç»™æˆ‘ä¹°æ¯å’–å•¡</a>ï¼</p><p id="a5b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½ å¯ä»¥ç‚¹å‡»â€œå…³æ³¨â€æŒ‰é’®æ¥è·å–æˆ‘çš„æœ€æ–°æ–‡ç« å’Œå¸–å­ï¼</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/c6cac29c20a9cdd325be670a3ceb550f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*unAZ0wJciBonN2DADyGhtw.gif"/></div></div></figure></div></div>    
</body>
</html>