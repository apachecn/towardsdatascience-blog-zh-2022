# å¦‚ä½•åœ¨ 5 åˆ†é’Ÿå†…å°†æ±‰å¯†å°”é¡¿ç”¨äºç†ŠçŒ«

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-use-hamilton-with-pandas-in-5-minutes-89f63e5af8f5>

![](img/0e50d53894669ed7e47459301131a095.png)

è¿™ä¸ªå¸–å­çš„æ„Ÿæ‚Ÿ(éçœŸå®ä»£ç )ã€‚å›¾ç‰‡ä½œè€…ã€‚

æ±‰å¯†å°”é¡¿æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å£°æ˜æ€§çš„ Python æ•°æ®æµå¾®æ¡†æ¶ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•å¿«é€Ÿè§£é‡Šå®ƒæ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•åœ¨ç†ŠçŒ«èº«ä¸Šä½¿ç”¨å®ƒï¼›é˜…è¯»è¿™ç¯‡æ–‡ç« ä¸ä¼šèŠ±è´¹ä½ è¶…è¿‡äº”åˆ†é’Ÿçš„æ—¶é—´ã€‚å…³äºèƒŒæ™¯æ•…äº‹å’Œæ›´é•¿çš„ä»‹ç»ï¼Œæˆ‘ä»¬é‚€è¯·ä½ é˜…è¯»è¿™ç¯‡ [TDS å¸–å­](/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d)ã€‚

# ä»€ä¹ˆæ˜¯æ±‰å¯†å°”é¡¿ï¼Ÿ

Hamilton æ˜¯ä¸€ç§è‡ªä»¥ä¸ºæ˜¯çš„ç¼–å†™ python æ•°æ®è½¬æ¢å‡½æ•°çš„æ–¹å¼ã€‚å®ƒè¿«ä½¿ä¸¤ä»¶äº‹:

1.  æ‚¨ç¼–å†™å£°æ˜æ€§çš„ python å‡½æ•°æ¥å°è£…æ‚¨çš„æ•°æ®è½¬æ¢é€»è¾‘ã€‚
2.  ä»è¿è¡Œæ—¶é€»è¾‘ä¸­åˆ†ç¦»å‡ºè½¬æ¢é€»è¾‘ã€‚

## è¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

å¯¹äºä¸Šé¢çš„ç¬¬(1)ç‚¹ï¼Œä¸è¦ç¼–å†™æ“ä½œæ•°æ®å¸§çš„ Pandas ä»£ç ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
df['age_mean'] = df['age'].mean()
df['age_zero_mean'] = df['age'] - df['age_mean']
df['age_std_dev'] = df['age'].std()
df['age_zero_mean_unit_variance'] = df['age_zero_mean'] / df['age_std_dev']
```

ä½ åº”è¯¥è¿™æ ·å†™:

```
# a_function_module.py
def age_mean(age: pd.Series) -> float:
    *"""Average of age"""* return age.mean()

def age_zero_mean(age: pd.Series**,** age_mean: float) -> pd.Series:
    *"""Zero mean of age"""* return age - age_mean

def age_std_dev(age: pd.Series) -> pd.Series:
    *"""Standard deviation of age."""* return age.std()

def age_zero_mean_unit_variance(age_zero_mean: pd.Series**,** age_std_dev: pd.Series) -> pd.Series:
    *"""Zero mean unit variance value of age"""* return age_zero_mean / age_std_dev
```

æ²¡æœ‰è¦æ“ä½œçš„ä¸­å¿ƒ dataframe å¯¹è±¡ã€‚ç›¸åï¼Œä½ åœ¨â€œä¸“æ â€ä¸­æ€è€ƒï¼Œå¹¶ä¸”åªæ€è€ƒä½ éœ€è¦è¡¨è¾¾ä»€ä¹ˆæ¥åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ä¸“æ ã€‚

æ›´å…·ä½“åœ°è¯´ï¼Œå‡½æ•°ä½¿ç”¨*å‡½æ•°å*å£°æ˜å®ƒä»¬è¾“å‡ºçš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨*å‡½æ•°å‚æ•°*å£°æ˜å®ƒä»¬éœ€è¦çš„è¾“å…¥å†…å®¹ã€‚è®¡ç®—çš„é€»è¾‘å®Œå…¨åŒ…å«åœ¨å‡½æ•°ä¸­ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å°è£…ã€‚å‡½æ•°åå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒæ˜ å°„åˆ°æ‚¨å¯ä»¥*è¯·æ±‚*è¾“å‡ºçš„å†…å®¹ã€‚

*è®°ä½å‡½æ•°å¦‚ä½•æ˜ å°„åˆ° Pandas æ•°æ®å¸§çš„ä¸€ä¸ªå¿«é€Ÿæ–¹æ³•æ˜¯ï¼Œå‡½æ•°åæ˜ å°„åˆ°åˆ—ï¼Œå‡½æ•°å‚æ•°æ˜ å°„åˆ°å…¶ä»–åˆ—æˆ–å…¶ä»–è¾“å…¥ã€‚*

å¯¹äºç¬¬(2)ç‚¹ï¼Œæ‚¨çš„å˜æ¢å‡½æ•°ä½äº python æ¨¡å—ä¸­ï¼Œè¯¥æ¨¡å—ç‹¬ç«‹äºç”¨äºè·å–æ•°æ®å¸§çš„è„šæœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å®é™…è®¡ç®—ä¸Šè¿°å†…å®¹ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ–‡ä»¶:

```
import pandas as pd
from hamilton import driverimport a_function_module # where your transforms live

dr = driver.Driver({'age': pd.Series([...])}**,** a_function_module)# Here we're only requesting two outputs, but you could additionally 
# request `age_mean`, `age_zero_mean`, `age_std_dev` ...
df = dr.execute(['age', 'age_zero_mean_unit_variance'])
```

è¿™è¿«ä½¿ä½ éµå¾ªä¸€ä¸ªè¢«ç§°ä¸ºè§£è€¦çš„è½¯ä»¶å·¥ç¨‹åŸåˆ™ã€‚è§£è€¦å¯¹äºæ•°æ®å·¥ä½œæ¥è¯´æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºè¿™æ„å‘³ç€ä½ çš„è½¬æ¢å‡½æ•°ä¸å…³å¿ƒä½ å¦‚ä½•åŠ è½½æˆ–è·å–æ•°æ®ï¼Œå®ƒä»¬åªå…³å¿ƒè®¡ç®—ã€‚è¿™æ„å‘³ç€åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­é‡ç”¨æ‚¨çš„ Hamilton æ•°æ®è½¬æ¢å‡½æ•°éå¸¸ã€éå¸¸ã€å®¹æ˜“â€”â€”è€Œä¸”ä¸ä¼šå½±å“ä»»ä½•äººã€‚

## ä½¿ç”¨æ±‰å¯†å°”é¡¿çš„å¥½å¤„

æ— éœ€æ·±ç©¶ç»†èŠ‚ï¼Œåªè¦ä»”ç»†æƒ³æƒ³å°±ä¼šæ˜ç™½ï¼Œä»¥ä¸‹æ˜¯æ±‰å¯†å°”é¡¿åšäº‹æ–¹å¼å¸¦æ¥çš„ä¸€äº›å¥½å¤„:

1.  æ‰€æœ‰ Hamilton æ•°æ®è½¬æ¢å‡½æ•°éƒ½æ˜¯ 100%å•å…ƒå¯æµ‹è¯•çš„ã€‚å‡½æ•°çš„å£°æ˜æ€§æ„å‘³ç€ä¼ é€’æµ‹è¯•æ•°æ®éå¸¸å®¹æ˜“ï¼
2.  æ‰€æœ‰æ±‰å¯†å°”é¡¿æ•°æ®è½¬æ¢å‡½æ•°éƒ½æ˜¯ 100%æ–‡æ¡£å‹å¥½çš„ã€‚æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰ä¸€ä¸ªæœ‰ç›®çš„çš„ä½ç½®æ¥æ”¾ç½®æ–‡æ¡£ã€‚æƒ³è±¡ä¸€ä¸ªæ‹¥æœ‰è‰¯å¥½æ–‡æ¡£çš„æ•°æ®å·¥ç¨‹/ç§‘å­¦ä»£ç åº“ğŸ˜²ï¼Ÿï¼
3.  å¯é‡ç”¨çš„è½¬æ¢ä»£ç ã€‚å› ä¸ºä»ä¸€å¼€å§‹å°±å­˜åœ¨å¼ºåˆ¶è§£è€¦ï¼Œè¿™æ„å‘³ç€ä½œä¸ºç”¨æˆ·ï¼Œæ‚¨ç”¨è‡ªå·±çš„è½¬æ¢å‡½æ•°æ¥ç®¡ç† python æ¨¡å—ã€‚å› ä¸ºå®ƒä»¬é©»ç•™åœ¨æ¨¡å—ä¸­ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­é‡ç”¨è¿™äº›ä»£ç ï¼Œæ— è®ºæ˜¯ç”¨äºä¸åŒçš„â€œé©±åŠ¨ç¨‹åºâ€è„šæœ¬ï¼Œè¿˜æ˜¯ç®€å•åœ°ç”¨ä½œåº“ã€‚
4.  ä»£ç åŸºç¡€ä¸€è‡´æ€§ã€‚æ ¹æ®ä»¥ä¸Šå‡ ç‚¹ï¼Œç”¨ Hamilton ç¼–å†™çš„ç‰¹å¾å·¥ç¨‹ä»£ç åº“çœ‹èµ·æ¥éå¸¸æ ‡å‡†åŒ–ï¼Œå› æ­¤æ˜“äºç»´æŠ¤å’Œä¿å…»ã€‚

# æˆ‘å¦‚ä½•ä½¿ç”¨æ±‰å¯†å°”é¡¿ï¼Ÿ

## ç¬¬ä¸€æ­¥ã€‚å®‰è£…æ±‰å¯†å°”é¡¿

è¦å¼€å§‹å®‰è£… Hamilton:

`pip install sf-hamilton`

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ç¬”è®°æœ¬ç¯å¢ƒï¼Œè¯·çœ‹è¿™ç¯‡å…³äº[å¦‚ä½•åœ¨ç¬”è®°æœ¬](/how-to-iterate-with-hamilton-in-a-notebook-8ec0f85851ed)ä¸Šä½¿ç”¨ Hamilton çš„æ–‡ç« ã€‚

## ç¬¬äºŒæ­¥ã€‚ç¼–å†™æ‚¨çš„ python è½¬æ¢

åˆ›å»ºä¸€ä¸ª python æ–‡ä»¶ï¼Œä¾‹å¦‚ my_module.pyï¼Œå¹¶ç”¨æ‚¨çš„è½¬æ¢å‡½æ•°å¡«å……å®ƒã€‚è®°ä½*å‡½æ•°å*æ˜ å°„åˆ°æ‚¨*å¯ä»¥*ä½œä¸ºè¾“å‡ºè¯·æ±‚çš„åˆ—ï¼Œå¹¶ä¸”*å‡½æ•°å‚æ•°*æ˜ å°„åˆ°å…¶ä»–åˆ—ï¼Œæˆ–è€…æ‚¨åœ¨è¿è¡Œæ—¶æä¾›çš„è¾“å…¥ã€‚

```
import pandas as pd

def age_mean(age: pd.Series) -> float:
    *"""Average of age"""* return age.mean()

def age_zero_mean(age: pd.Series**,** age_mean: float) -> pd.Series:
    *"""Zero mean of age"""* return age - age_mean

def age_std_dev(age: pd.Series) -> pd.Series:
    *"""Standard deviation of age."""* return age.std()

def age_zero_mean_unit_variance(age_zero_mean: pd.Series**,** age_std_dev: pd.Series) -> pd.Series:
    *"""Zero mean unit variance value of age"""* return age_zero_mean / age_std_dev
```

## ç¬¬ä¸‰æ­¥ã€‚ç¼–å†™ä¸€ä¸ªâ€œé©±åŠ¨ç¨‹åºâ€è„šæœ¬ï¼Œå°†æ‰€æœ‰ä¸œè¥¿æ•´åˆåœ¨ä¸€èµ·

åˆ›å»ºä¸€ä¸ª python æ–‡ä»¶ï¼Œä¾‹å¦‚ my_driver.pyã€‚

```
import pandas as pd
from hamilton import driver
import my_module

dr = driver.Driver({'age': pd.Series([...])}**,** my_module)
# execute() returns a dataframe by default
df = dr.execute(['age_zero_mean_unit_variance'])

# do something with the dataframe
```

## ç¬¬å››æ­¥ã€‚è¿è¡Œâ€œé©±åŠ¨ç¨‹åºâ€è„šæœ¬

`python my_driver.py`æ˜¯è¿è¡Œä¸€åˆ‡æ‰€éœ€çš„ä¸€åˆ‡ï¼

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªç¼–æ’/è°ƒåº¦ç³»ç»Ÿï¼Œæ¯”å¦‚ airflowã€metaflowã€kubeflow pipelinesã€prefect ç­‰ã€‚æ‚¨å¯ä»¥å°†é©±åŠ¨ç¨‹åºè„šæœ¬çš„å†…å®¹æ”¾å…¥è¦æ‰§è¡Œçš„ ETL çš„â€œæ­¥éª¤â€ä¸­ã€‚

# ä½ å¯ä»¥ç”¨æ±‰å¯†å°”é¡¿åšçš„å…¶ä»–äº‹æƒ…

å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„å¸–å­ï¼Œæˆ‘ä»¬ä¸æ‰“ç®—åœ¨è¿™é‡Œæ·±å…¥ç»†èŠ‚ã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ¿€èµ·æ‚¨çš„å…´è¶£ï¼Œåœ¨ä½¿ç”¨ Pandas æ—¶ï¼Œæ±‰å¯†å°”é¡¿ä¸ºæ‚¨æä¾›äº†ä»¥ä¸‹å¼€ç®±å³ç”¨çš„åŠŸèƒ½:

1.  æ‰©å±•åˆ°â€œå¤§æ•°æ®â€è§„æ¨¡ï¼Œå› ä¸º Hamilton å‡ ä¹å…è´¹æ”¯æŒ Daskã€Pandas on Spark å’Œ Rayã€‚å‚è§æ±‰å¯†å°”é¡¿[ç¤ºä¾‹æ–‡ä»¶å¤¹](https://github.com/stitchfix/hamilton/tree/main/examples)ä¸­çš„ä»£ç & [è¿™é‡Œæœ‰ä¸€äº›æ–‡æ¡£](https://hamilton-docs.gitbook.io/docs/extensions)ã€‚
2.  æ•°æ®è¡€ç»Ÿã€‚ä½ å¯ä»¥æŠŠè®¡ç®—çš„æ­¥éª¤å½¢è±¡åŒ–ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“åœ°ç”¨å“ˆå¯†å°”é¡¿é—®ä½ çš„å›¾çš„é—®é¢˜ã€‚å°è¯•ä½¿ç”¨`dr.visualize_execution(...).`
3.  ä¿®é¥°åŠŸèƒ½çš„èƒ½åŠ›ï¼Œä¾‹å¦‚æœ‰æ¡ä»¶åœ°åŒ…æ‹¬åŸºäºé…ç½®çš„åŠŸèƒ½ã€‚ä¸è¦ç”¨`if else`è¯­å¥(ä¾‹å¦‚`if region == 'US'`)æ¥ç‚¹ç¼€ä½ çš„ä»£ç ï¼Œç›¸åï¼Œä½ å¯ä»¥é€šè¿‡ç”¨`@config.when`æ¥è£…é¥°ä¸€ä¸ªå‡½æ•°æ¥æ•æ‰è¿™ç§é€»è¾‘ã€‚è¿™åªæ˜¯ç”¨ Hamilton æä¾›åŠŸèƒ½å’Œé¢å¤–èƒ½åŠ›çš„å‡ ä¸ªè£…é¥°è€…ä¹‹ä¸€ã€‚æ›´å¤šä¿¡æ¯è¯·è§æˆ‘ä»¬çš„[æ–‡æ¡£](https://hamilton-docs.gitbook.io/docs/reference/api-reference/available-decorators)ã€‚
4.  æ±‰å¯†å°”é¡¿çš„ç”¨é€”ä¸ä»…é™äºç†ŠçŒ«ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»º numpy çŸ©é˜µã€scikit-learn æ¨¡å‹ã€ä»»ä½• python å¯¹è±¡ç­‰ã€‚ï¼æŸ¥çœ‹[æˆ‘ä»¬çš„ç¤ºä¾‹æ–‡ä»¶å¤¹](https://github.com/stitchfix/hamilton/tree/main/examples)äº†è§£æƒ³æ³•ã€‚

# æœ€å

æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚æˆ‘ä»¬å¾ˆä¹æ„å¸®åŠ©æ‚¨æˆåŠŸä½¿ç”¨æ±‰å¯†å°”é¡¿ã€‚æ¬¢è¿åœ¨æˆ‘ä»¬çš„ [github çŸ¥è¯†åº“](https://github.com/stitchfix/hamilton)ä¸­ç•™ä¸‹é—®é¢˜/è¯„è®º(æˆ‘ä»¬ä¹Ÿå¾ˆå–œæ¬¢â­ï¸ï¼)ï¼Œæˆ–è€…åŠ å…¥æˆ‘ä»¬çš„ [slack æœåŠ¡å™¨](https://join.slack.com/t/hamilton-opensource/shared_invite/zt-1bjs72asx-wcUTgH7q7QX1igiQ5bbdcg)å¯»æ±‚å¸®åŠ©ï¼Œæˆ–è€…æä¾›å»ºè®®/æ”¹è¿›ã€‚

## æ‚¨å¯èƒ½æ„Ÿå…´è¶£çš„å…¶ä»–æ±‰å¯†å°”é¡¿å¸–å­:

*   [å¦‚ä½•åœ¨ç¬”è®°æœ¬ç¯å¢ƒä¸­ä½¿ç”¨ Hamilton](/how-to-iterate-with-hamilton-in-a-notebook-8ec0f85851ed)
*   [ä¸€èˆ¬èƒŒæ™¯æ•…äº‹&æ±‰å¯†å°”é¡¿ç®€ä»‹](/functions-dags-introducing-hamilton-a-microframework-for-dataframe-generation-more-8e34b84efc1d)