# æ—¶é—´åºåˆ—é¢„æµ‹çš„ Theta æ¨¡å‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/theta-model-for-time-series-forecasting-642ad1d00358>

## å…³äºå¦‚ä½•åœ¨ Python ä¸­åº”ç”¨ Theta æ¨¡å‹è¿›è¡Œæ—¶é—´åºåˆ—é¢„æµ‹çš„å®è·µæ•™ç¨‹

![](img/1581dffc095478ee2ba40c4dd712ebe2.png)

æ±‰æ–¯Â·é›·å°¼å°”æ–¯åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) æ‹æ‘„çš„ç…§ç‰‡

å½“è°ˆåˆ°æ—¶é—´åºåˆ—é¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†æ³¨æ„åŠ›è½¬å‘ SARIMAX ç³»åˆ—æˆ–æŒ‡æ•°å¹³æ»‘ä¸­çš„æ¨¡å‹ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§é¢„æµ‹æŠ€æœ¯å¾ˆå°‘è¢«æåŠ:Theta æ¨¡å‹ã€‚

å°½ç®¡ç®€å•ï¼ŒTheta æ¨¡å‹å¯ä»¥äº§ç”Ÿç²¾ç¡®çš„é¢„æµ‹ã€‚å®ƒåœ¨æœ€å¤§çš„å­¦æœ¯æ—¶é—´åºåˆ—é¢„æµ‹ç«èµ› M-3 ç«èµ›ä¸­è¡¨ç°å¦‚æ­¤å‡ºè‰²ï¼Œä»¥è‡³äºåœ¨éšåçš„å‡ å¹´ä¸­æˆä¸ºä¸€ä¸ªåŸºå‡†ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»ç†è®ºçš„è§’åº¦æ¢ç´¢æ¨¡å‹çš„å†…éƒ¨å·¥ä½œåŸç†ã€‚ç„¶åï¼Œæˆ‘ä»¬å°† Theta æ¨¡å‹åº”ç”¨äºé¢„æµ‹å®è·µï¼Œå¹¶å°†å…¶æ€§èƒ½ä¸ SARIMA æ¨¡å‹å’ŒæŒ‡æ•°å¹³æ»‘æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚å½“ç„¶ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½æ˜¯ Python çš„ã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼

> **ç”¨ Python ä¸­æˆ‘çš„** [**å…è´¹æ—¶é—´åºåˆ—å°æŠ„**](https://www.datasciencewithmarco.com/pl/2147608294) **å­¦ä¹ æœ€æ–°çš„æ—¶é—´åºåˆ—åˆ†ææŠ€æœ¯ï¼è·å¾—ç»Ÿè®¡å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å®ç°ï¼Œå…¨éƒ¨åœ¨ Python å’Œ TensorFlow ä¸­ï¼**

# Theta æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„

Theta æ¨¡å‹åŸºæœ¬ä¸Šä¾èµ–äºåˆ†è§£ã€‚æˆ‘ä»¬çŸ¥é“æ—¶é—´åºåˆ—å¯ä»¥åˆ†è§£æˆä¸‰ä¸ªéƒ¨åˆ†:è¶‹åŠ¿éƒ¨åˆ†ã€å­£èŠ‚éƒ¨åˆ†å’Œæ®‹å·®éƒ¨åˆ†ã€‚

å› æ­¤ï¼Œåˆç†çš„æ–¹æ³•æ˜¯å°†ä¸€ä¸ªåºåˆ—åˆ†è§£æˆå®ƒçš„æ¯ä¸ªç»„æˆéƒ¨åˆ†ï¼Œé¢„æµ‹æ¯ä¸ªç»„æˆéƒ¨åˆ†çš„æœªæ¥ï¼Œç„¶åç»„åˆæ¯ä¸ªç»„æˆéƒ¨åˆ†çš„é¢„æµ‹æ¥åˆ›å»ºæ‚¨çš„æœ€ç»ˆé¢„æµ‹ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œè¿™åœ¨å®è·µä¸­è¡Œä¸é€šï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå¾ˆéš¾åˆ†ç¦»æ®‹å·®å¹¶é¢„æµ‹å®ƒä»¬ã€‚

æ‰€ä»¥ Theta æ¨¡å‹æ˜¯è¿™ä¸ªæƒ³æ³•çš„ä¸€ä¸ªå‘å±•ï¼Œä½†æ˜¯å®ƒä¾èµ–äºå°†åºåˆ—åˆ†è§£æˆä¸€ä¸ªé•¿æœŸéƒ¨åˆ†å’Œä¸€ä¸ªçŸ­æœŸéƒ¨åˆ†ã€‚

åœ¨å½¢å¼ä¸Šï¼ŒTheta æ¨¡å‹åŸºäºä¿®æ”¹æ—¶é—´åºåˆ—çš„å±€éƒ¨æ›²ç‡çš„æ¦‚å¿µã€‚è¿™ä¸ªä¿®æ”¹ç”±ä¸€ä¸ªåä¸º *theta* çš„å‚æ•°ç®¡ç†(å› æ­¤å¾—å theta æ¨¡å‹)ã€‚è¿™ç§ä¿®æ”¹åº”ç”¨äºç³»åˆ—çš„ç¬¬äºŒä¸ªå·®å¼‚ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯å·®å¼‚ä¸¤æ¬¡ã€‚

å½“*Î¸*åœ¨ 0 å’Œ 1 ä¹‹é—´æ—¶ï¼Œç³»åˆ—â€œæ”¾æ°”â€ã€‚è¿™æ„å‘³ç€çŸ­æœŸæ³¢åŠ¨è¾ƒå°ï¼Œæˆ‘ä»¬å¼ºè°ƒé•¿æœŸå½±å“ã€‚å½“*Î¸*è¾¾åˆ° 0 æ—¶ï¼Œæ•°åˆ—è½¬æ¢ä¸ºçº¿æ€§å›å½’çº¿ã€‚è¿™ç§è¡Œä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/d410f9c59a3e20d3d418d6d9a5231de4.png)

å½“Î¸åœ¨ 0 å’Œ 1 ä¹‹é—´æ—¶çº§æ•°çš„æ”¶ç¼©ã€‚æ³¨æ„ï¼Œå½“å®ƒç­‰äº 0 æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€æ¡çº¿æ€§å›å½’çº¿ã€‚å›¾ç‰‡ç”± V. Assimakopoulosï¼ŒK. Nikolopoulos ä»[theta æ¨¡å‹:é¢„æµ‹çš„åˆ†è§£æ–¹æ³•](https://www.researchgate.net/publication/223049702_The_theta_model_A_decomposition_approach_to_forecasting)

æˆ–è€…ï¼Œå½“*Î¸*å¤§äº 1 æ—¶ï¼Œåˆ™çŸ­æœŸæ³¢åŠ¨è¢«æ”¾å¤§ï¼Œå› æ­¤æˆ‘ä»¬å¼ºè°ƒçŸ­æœŸæ•ˆåº”ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿè¯´è¿™ä¸ªç³»åˆ—æ˜¯â€œè†¨èƒ€â€çš„ã€‚è¿™ç§è¡Œä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/d483eaed5ca1fead7443a09540f2008b.png)

å½“Î¸å¤§äº 1 æ—¶çº§æ•°çš„è†¨èƒ€ã€‚æ³¨æ„çŸ­æœŸæ³¢åŠ¨æ˜¯å¦‚ä½•è¢«æ”¾å¤§çš„ã€‚æ¥è‡ª[çš„ V. Assimakopoulosï¼ŒK. Nikolopoulos çš„å›¾ç‰‡ theta æ¨¡å‹:é¢„æµ‹çš„åˆ†è§£æ–¹æ³•](https://www.researchgate.net/publication/223049702_The_theta_model_A_decomposition_approach_to_forecasting)

å¯¹äºæ¯ä¸€ä¸ªÎ¸å€¼ï¼Œæˆ‘ä»¬è¯´æˆ‘ä»¬åˆ›å»ºäº†ä¸€æ¡â€œÎ¸çº¿â€ã€‚ç†è®ºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆå°½å¯èƒ½å¤šçš„Î¸çº¿ï¼Œé¢„æµ‹æ¯ä¸€æ¡çº¿çš„æœªæ¥ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆèµ·æ¥è¿›è¡Œæœ€ç»ˆé¢„æµ‹ã€‚

åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬ç»å¸¸åªä½¿ç”¨ä¸¤æ¡Î¸çº¿:ä¸€æ¡æ˜¯*Î¸*ä¸º 0ï¼Œä¸€æ¡æ˜¯*Î¸*ä¸º 2ã€‚ç¬¬ä¸€æ¡ theta çº¿( *theta* = 0)ç»™å‡ºäº†æ•°åˆ—çš„è¶‹åŠ¿ä¿¡æ¯ï¼Œè€Œç¬¬äºŒæ¡ theta çº¿( *theta* = 2)æ”¾å¤§äº†çŸ­æœŸæ³¢åŠ¨ã€‚ç„¶åï¼Œæˆ‘ä»¬é¢„æµ‹æ¯ä¸€è¡Œï¼Œå¹¶ç»“åˆé¢„æµ‹ã€‚

## å­£èŠ‚æ€§å‘¢ï¼Ÿ

Theta æ¨¡å‹çš„ç¨‹åºé€‚ç”¨äºéå­£èŠ‚æ€§æ•°æ®ã€‚ä½†æ˜¯ï¼Œå®ƒä»ç„¶å¯ä»¥ç”¨äºå­£èŠ‚æ€§æ•°æ®ï¼Œå› ä¸ºå­£èŠ‚æ€§å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«åˆ é™¤ï¼Œå¹¶åœ¨ç»“æŸæ—¶å†æ¬¡æ·»åŠ ã€‚

å› æ­¤ï¼ŒTheta æ¨¡å‹çš„å®ç°éµå¾ªä»¥ä¸‹æ­¥éª¤:

1.  **å»é™¤å­£èŠ‚æ€§**:è¿›è¡Œå­£èŠ‚æ€§æµ‹è¯•ã€‚å¦‚æœæ£€æµ‹åˆ°å­£èŠ‚æ€§ï¼Œåˆ™é€šè¿‡åˆ†è§£å»é™¤ã€‚
2.  **åˆ†è§£æˆä¸¤æ¡Î¸çº¿**:æˆ‘ä»¬ç”Ÿæˆä¸¤æ¡Î¸çº¿ï¼›ä¸€ä¸ªæ˜¯*Î¸*= 0ï¼Œè¡¨ç¤ºä¸º Z(0)ï¼Œä¸€ä¸ªæ˜¯*Î¸*= 2ï¼Œè¡¨ç¤ºä¸º Z(2)ã€‚
3.  å¤–æ¨:æˆ‘ä»¬å°†ä¸¤æ¡Î¸çº¿å¤–æ¨è‡³æœªæ¥ã€‚Z(0)æ˜¯ä½¿ç”¨çº¿æ€§å›å½’å¤–æ¨çš„ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯çº¿æ€§å›å½’çº¿ã€‚ä½¿ç”¨ç®€å•çš„æŒ‡æ•°å¹³æ»‘å¤–æ¨ Z(2)ã€‚
4.  **ç»„åˆ**:æˆ‘ä»¬ç»„åˆä¸¤æ¡Î¸çº¿çš„å¤–æ¨ï¼Œä»¥è·å¾—ä¸€æ¡é¢„æµ‹çº¿ã€‚
5.  **æŠŠå­£èŠ‚æ€§åŠ å›æ¥**:å¦‚æœå­£èŠ‚æ€§åœ¨ç¬¬ä¸€æ­¥ä¸­è¢«ç§»é™¤ï¼Œæˆ‘ä»¬åœ¨æœ€åæŠŠå®ƒåŠ å›æ¥ã€‚

ç°åœ¨æˆ‘ä»¬äº†è§£äº† Theta æ¨¡å‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬åœ¨é¢„æµ‹ç»ƒä¹ ä¸­åº”ç”¨å®ƒï¼

# ä½¿ç”¨ Theta æ¨¡å‹è¿›è¡Œé¢„æµ‹

åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†é¢„æµ‹ä» 1958 å¹´ 3 æœˆåˆ° 2001 å¹´ 12 æœˆåœ¨è«çº³ç½—äºšå¤©æ–‡å°è®°å½•çš„äºŒæ°§åŒ–ç¢³æµ“åº¦ã€‚æ•°æ®æ¯å‘¨éƒ½è¢«è®°å½•ä¸‹æ¥ã€‚

åœ¨ä»»ä½•æ—¶å€™ï¼Œéƒ½å¯ä»¥åœ¨ [GitHub](https://github.com/marcopeix/time-series-analysis/blob/master/theta_model.ipynb) ä¸Šéšæ„æŸ¥é˜…æºä»£ç ã€‚

ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å¯¼å…¥å¿…è¦çš„åº“å¹¶åŠ è½½æ•°æ®ã€‚

```
import numpy as np
import pandas as pd
import statsmodels.api as sm
import matplotlib.pyplot as plt# Load the data
df = sm.datasets.co2.load_pandas().data
df.head()
```

ç„¶åæˆ‘ä»¬å¯ä»¥å¯è§†åŒ–æˆ‘ä»¬çš„æ•°æ®é›†ã€‚ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

```
fig, ax = plt.subplots()ax.plot(df['co2'])
ax.set_xlabel('Time')
ax.set_ylabel('CO2 concentration (ppmw)')fig.autofmt_xdate()
plt.tight_layout()
```

![](img/0b53c7540cbd481e5b33c64b6b4018a4.png)

ä» 1958 å¹´ 3 æœˆåˆ° 2001 å¹´ 12 æœˆçš„æ¯å‘¨ CO2 æµ“åº¦ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨æ•°æ®é›†çš„å¼€å¤´æœ‰ä¸€äº›ç¼ºå¤±çš„å€¼ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

æŸ¥çœ‹ä¸Šå›¾ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ä¸‰ä¸ªé‡è¦å…ƒç´ :

1.  æˆ‘ä»¬çš„ç³»åˆ—æœ‰ä¸€ä¸ªç§¯æçš„è¶‹åŠ¿ï¼Œå› ä¸ºäºŒæ°§åŒ–ç¢³æµ“åº¦éšç€æ—¶é—´çš„æ¨ç§»è€Œå¢åŠ ã€‚
2.  æˆ‘ä»¬çš„ç³»åˆ—å…·æœ‰å¹´åº¦å­£èŠ‚æ€§ï¼Œå› ä¸ºå†¬å­£çš„äºŒæ°§åŒ–ç¢³å«é‡é«˜äºå¤å­£ã€‚
3.  æˆ‘ä»¬åœ¨æ•°æ®é›†çš„å¼€å¤´æœ‰ä¸€äº›ç¼ºå¤±çš„å€¼ã€‚

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å»æ‰ç¼ºå¤±çš„å€¼ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ä¸¤ä¸ªå·²çŸ¥ç‚¹æ¥æ’å€¼ç¼ºå¤±å€¼ã€‚

```
df = df.interpolate()
```

è¿™å°±è§£å†³äº†ä»»ä½•ç¼ºå¤±çš„å€¼ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½ç»§ç»­è¿›è¡Œé¢„æµ‹äº†ã€‚

## é¢„æµ‹

å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸ºæµ‹è¯•é›†ä¿ç•™æœ€è¿‘ä¸¤å¹´çš„è§‚å¯Ÿç»“æœã€‚ç”±äºæˆ‘ä»¬æœ‰å‘¨æ•°æ®ï¼Œå¹¶ä¸”ä¸€å¹´æœ‰ 52 å‘¨ï¼Œè¿™æ„å‘³ç€æœ€å 104 ä¸ªç‚¹æ˜¯ç”¨äºæµ‹è¯•é›†çš„ï¼Œå…¶ä½™çš„æ˜¯ç”¨äºè®­ç»ƒçš„ã€‚

```
train = df[:-104]
test = df[-104:]
```

ç„¶åï¼Œæˆ‘ä»¬å¿…é¡»è®¾å®šä¸€ä¸ªé¢„æµ‹èŒƒå›´ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º 52 å‘¨ï¼Œæˆ–ä¸€å¹´ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æƒ³è¦å»ºç«‹ä¸€ä¸ªæ¨¡å‹æ¥é¢„æµ‹æœªæ¥ 52 å‘¨çš„äºŒæ°§åŒ–ç¢³æµ“åº¦ã€‚

ç”±äºæˆ‘ä»¬çš„æµ‹è¯•é›†æœ‰ 104 å‘¨çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œæ»šåŠ¨é¢„æµ‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œé¢„æµ‹æœªæ¥ 52 å‘¨ï¼Œç„¶ååœ¨æ›´æ–°çš„è®­ç»ƒé›†ä¸Šé‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œè¯¥è®­ç»ƒé›†åŒ…æ‹¬å¦å¤– 52 å‘¨çš„æ•°æ®ï¼Œä»¥é¢„æµ‹æœªæ¥ 52 å‘¨ã€‚

ç”¨æ–‡å­—æè¿°æ»šåŠ¨é¢„æµ‹æ˜¯ç›¸å½“æ··ä¹±çš„ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªå›¾è¡¨æ¥å½¢è±¡åŒ–æ•´ä¸ªè¿‡ç¨‹ã€‚

![](img/7b6ec32511ee515465bb74b5871a23e1.png)

å¯è§†åŒ–æ»šåŠ¨é¢„æµ‹ã€‚åœ¨ç¬¬ä¸€éä¸­ï¼Œæˆ‘ä»¬é¢„æµ‹äº†æµ‹è¯•é›†çš„å‰ 52 å‘¨ã€‚åœ¨ç¬¬äºŒéä¸­ï¼Œæˆ‘ä»¬é¢„æµ‹äº†æµ‹è¯•é›†çš„æœ€å 52 å‘¨ï¼Œä½†æ˜¯ä½¿ç”¨äº†æ›´æ–°çš„è®­ç»ƒé›†ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é¢„æµ‹äº† 104 å‘¨çš„æ•´ä¸ªæµ‹è¯•é›†ï¼Œä½†æ˜¯ä¸€æ¬¡é¢„æµ‹äº† 52 å‘¨ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åšå‡ºæ–°çš„é¢„æµ‹ä¹‹å‰æ¨¡æ‹Ÿæ”¶é›†æ–°æ•°æ®å¹¶æ·»åŠ åˆ°è®­ç»ƒé›†çš„è¿‡ç¨‹ã€‚

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€‰æ‹©ä¸€ä¸ªåŸºçº¿æ¨¡å‹ã€‚åœ¨è¿™é‡Œï¼Œç”±äºæˆ‘ä»¬æœ‰å­£èŠ‚æ€§æ•°æ®ï¼Œä¸€ä¸ªåˆç†çš„åŸºçº¿å°†æ˜¯ç®€å•åœ°é¢„æµ‹å·²çŸ¥çš„æœ€åä¸€ä¸ªå­£èŠ‚ã€‚å› ä¸ºæˆ‘ä»¬æœ‰æ¯å¹´çš„å­£èŠ‚æ€§ï¼Œå¹¶ä¸”æ¯å¹´æœ‰ 52 æ¬¡è§‚å¯Ÿï¼Œè¿™ç›¸å½“äºåœ¨æœªæ¥é‡å¤æœ€åçš„ 52 ä¸ªæ•°æ®ç‚¹ã€‚

æœ‰äº†æ‰€æœ‰è¿™äº›è®¾ç½®ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ„å»ºæˆ‘ä»¬çš„å‡½æ•°æ¥è¿›è¡Œæ»šåŠ¨é¢„æµ‹ã€‚

```
from statsmodels.tsa.forecasting.theta import ThetaModeldef rolling_forecast(df: pd.DataFrame, train_len: int, horizon: int, window: int, method: str) -> list:

    total_len = train_len + horizon
    end_idx = train_lenif method == 'last_season':
        pred_last_season = []

        for i in range(train_len, total_len, window):
            last_season = df[:i].iloc[-window:].values
            pred_last_season.extend(last_season)

        return pred_last_season

    elif method == 'theta':
        pred_theta = []

        for i in range(train_len, total_len, window):
            tm = ThetaModel(endog=df[:i], period=52)
            res = tm.fit()
            predictions = res.forecast(window)
            pred_theta.extend(predictions)

        print(res.summary()) #Optionalreturn pred_theta
```

ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„å‡½æ•°éœ€è¦ä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®é›†ã€è®­ç»ƒé›†çš„åˆå§‹é•¿åº¦ã€æµ‹è¯•é›†çš„é•¿åº¦ä»¥åŠä¸€ä¸ªçª—å£æˆ–ä¸€ä¸ªèŒƒå›´ã€‚

è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„é•¿åº¦å¾ˆå®¹æ˜“ä»æˆ‘ä»¬ä¹‹å‰è¿›è¡Œçš„åˆ’åˆ†ä¸­æ¢å¤ï¼Œæˆ‘ä»¬çš„çª—å£å°†æ˜¯ 52 å‘¨ï¼Œå¦‚å‰æ‰€è¿°ã€‚

```
TRAIN_LEN = len(train)
HORIZON = len(test)
WINDOW = 52
```

æˆ‘ä»¬ç°åœ¨å‡†å¤‡é¢„æµ‹æˆ‘ä»¬çš„æ—¶é—´åºåˆ—ï¼Œä½¿ç”¨åŸºçº¿æ¨¡å‹å’Œ Theta æ¨¡å‹ã€‚

```
test = test.copy()test.loc[:, 'pred_last_season'] = pred_last_season
test.loc[:, 'pred_theta'] = pred_thetatest.head()
```

## æ·»åŠ ä¸‰é‡æŒ‡æ•°å¹³æ»‘

ä¸ºäº†ä¾¿äºæ¯”è¾ƒï¼Œè®©æˆ‘ä»¬åœ¨è¿™ç§æƒ…å†µä¸‹ä¹Ÿåº”ç”¨ä¸‰é‡æŒ‡æ•°å¹³æ»‘æ³•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°† Theta æ¨¡å‹çš„æ€§èƒ½ä¸åŸºçº¿å’Œå¦ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ›´æ–°æˆ‘ä»¬çš„ *rolling_forecast* å‡½æ•°æ¥å®ç°ä¸‰é‡æŒ‡æ•°å¹³æ»‘ã€‚

```
from statsmodels.tsa.holtwinters import ExponentialSmoothingdef rolling_forecast(df: pd.DataFrame, train_len: int, horizon: int, window: int, method: str) -> list:

    total_len = train_len + horizon
    end_idx = train_lenif method == 'last_season':
        pred_last_season = []

        for i in range(train_len, total_len, window):
            last_season = df[:i].iloc[-window:].values
            pred_last_season.extend(last_season)

        return pred_last_season

    elif method == 'theta':
        pred_theta = []

        for i in range(train_len, total_len, window):
            tm = ThetaModel(endog=df[:i], period=52)
            res = tm.fit()
            predictions = res.forecast(window)
            pred_theta.extend(predictions)return pred_theta

    elif method == 'tes':
        pred_tes = []

        for i in range(train_len, total_len, window):
            tes = ExponentialSmoothing(
                df[:i],
                trend='add',
                seasonal='add',
                seasonal_periods=52,
                initialization_method='estimated'
            ).fit()

            predictions = tes.forecast(window)
            pred_tes.extend(predictions)return pred_tes
```

ç„¶åï¼Œæˆ‘ä»¬ç®€å•åœ°è¿è¡Œå®ƒæ¥æ·»åŠ æ¥è‡ªä¸‰é‡æŒ‡æ•°å¹³æ»‘çš„é¢„æµ‹ã€‚

```
pred_tes = rolling_forecast(df, TRAIN_LEN, HORIZON, WINDOW, 'tes')test.loc[:, 'pred_tes'] = pred_testest.head()
```

## ä¼°ä»·

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†æ¥è‡ªåŸºçº¿ã€Theta æ¨¡å‹å’Œä¸‰é‡æŒ‡æ•°å¹³æ»‘çš„é¢„æµ‹ï¼Œè®©æˆ‘ä»¬è¯„ä¼°æ¯ä¸€ä¸ªå¹¶ç¡®å®šå† å†›æ¨¡å‹ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼Œæˆ– MAPEï¼Œæ¥è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹ã€‚

åœ¨å®é™…æµ‹é‡æ€§èƒ½ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå°†æ¨¡å‹çš„é¢„æµ‹ä¸å®é™…å€¼è¿›è¡Œå¯¹æ¯”ã€‚ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

```
fig, ax = plt.subplots()ax.plot(df['co2'])
ax.plot(test['co2'], 'b-', label='actual')
ax.plot(test['pred_last_season'], 'r:', label='baseline')
ax.plot(test['pred_theta'], 'g-.', label='Theta')
ax.plot(test['pred_tes'], 'k--', label='TES')ax.set_xlabel('Time')
ax.set_ylabel('CO2 concentration (ppmv)')
ax.axvspan('2000-01-08', '2001-12-29', color='#808080', alpha=0.2)ax.legend(loc='best')ax.set_xlim('1998-03-07', '2001-12-29')fig.autofmt_xdate()
plt.tight_layout()
```

![](img/e9da15dd695af51cc20df4df86243a5a.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»åŸºçº¿å¾—åˆ°çš„é¢„æµ‹å€¼ä¸å®é™…å€¼ç›¸å·®æœ€è¿œã€‚å¦åˆ™ï¼Œä¸‰é‡æŒ‡æ•°å¹³æ»‘ä¼¼ä¹æ›´æ¥è¿‘å®é™…å€¼ã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

çœ‹ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸºçº¿çš„é¢„æµ‹å€¼ä¸å®é™…å€¼ç›¸å·®æœ€è¿œã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°æ¥è‡ªä¸‰é‡æŒ‡æ•°å¹³æ»‘çš„çº¿(é»‘è‰²è™šçº¿)ä¼¼ä¹æœ€æ¥è¿‘å®é™…å€¼ã€‚

è®©æˆ‘ä»¬é€šè¿‡å®é™…è®¡ç®— MAPE æ¥éªŒè¯ä¸€ä¸‹ã€‚

```
def mape(y_true, y_pred):
    return round(np.mean(np.abs((y_true - y_pred) / y_true)) * 100, 2)mape_baseline = mape(test['co2'], test['pred_last_season'])
mape_theta = mape(test['co2'], test['pred_theta'])
mape_tes = mape(test['co2'], test['pred_tes'])
```

æ³¨æ„ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒMAPE è¿˜æ²¡æœ‰åœ¨ scikit-learn çš„ç¨³å®šç‰ˆæœ¬ä¸­å®ç°ï¼Œä½†æ˜¯å®ƒå¾ˆå¿«å°±è¦å®ç°äº†ï¼

æœ€åï¼Œè®©æˆ‘ä»¬ç”¨æŸ±çŠ¶å›¾ç›´è§‚åœ°å±•ç¤ºæ¯ä¸ªæ¨¡å‹çš„ MAPEã€‚

```
fig, ax = plt.subplots()x = ['Baseline', 'Theta', 'TES']
y = [mape_baseline, mape_theta, mape_tes]ax.bar(x, y, width=0.4)
ax.set_xlabel('Exponential smoothing models')
ax.set_ylabel('MAPE (%)')
ax.set_ylim(0, 1)for index, value in enumerate(y):
    plt.text(x=index, y=value + 0.05, s=str(value), ha='center')

plt.tight_layout()
```

![](img/31800e5b05b20eeda342da80cfa21cfe.png)

åœ¨è¿™é‡Œï¼Œä¸‰é‡æŒ‡æ•°å¹³æ»‘æ˜¾ç„¶æ˜¯èµ¢å®¶ï¼Œå› ä¸ºå®ƒå®ç°äº†æœ€ä½çš„ MAPEã€‚å›¾ç‰‡ç”±ä½œè€…æä¾›ã€‚

çœ‹ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å† å†›æ¨¡å‹æ˜¯ä¸‰é‡æŒ‡æ•°å¹³æ»‘ï¼Œå› ä¸ºå®ƒå®ç°äº† 0.12%çš„ MAPEã€‚

è‡³äº Theta æ¨¡å‹ï¼Œå®ƒä¼˜äºåŸºçº¿ï¼Œä½†ä¸å¦‚ä¸‰é‡æŒ‡æ•°å¹³æ»‘ã€‚

# ç»“è®º

è™½ç„¶ Theta æ¨¡å‹åœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ä¸æ˜¯å† å†›æ¨¡å‹ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¢„æµ‹æ–¹æ³•ï¼Œå¯ä»¥æ”¾åœ¨æ‚¨çš„å·¥å…·ç®±ä¸­ã€‚

å®ƒçš„åˆ†è§£æ–¹æ³•ä½¿å®ƒæˆä¸ºé¢„æµ‹æ—¶é—´åºåˆ—çš„ä¸€ç§çµæ´»è€Œå¿«é€Ÿçš„æ–¹æ³•ã€‚è‡³å°‘ï¼Œå®ƒå¯ä»¥ä½œä¸ºæ¯”è¾ƒå…¶ä»–æ›´å¤æ‚æ¨¡å‹çš„åšå®åŸºå‡†ã€‚

æœ¬æ–‡åˆ°æ­¤ä¸ºæ­¢ï¼ç¥è´ºä½ åšæŒåˆ°æœ€åï¼Œæˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒå¹¶ä¸”å­¦åˆ°äº†æ–°çš„ä¸œè¥¿ï¼

ä¸€å®šè¦ä¸‹è½½æˆ‘ç”¨ Python å†™çš„[å…è´¹æ—¶é—´åºåˆ—é¢„æµ‹å°æŠ„](https://www.datasciencewithmarco.com/pl/2147608294)ï¼Œæ¶µç›–ç»Ÿè®¡å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼

å¹²æ¯ğŸº

# èµ„æº

Grzegorz Dudek â€” [ä½¿ç”¨ Theta æ–¹æ³•çš„çŸ­æœŸè´Ÿè·é¢„æµ‹](https://www.e3s-conferences.org/articles/e3sconf/pdf/2019/10/e3sconf_pe2019_01004.pdf)

ç½—å¸ƒÂ·jÂ·æµ·å¾·æ›¼ï¼Œå¶é¬¼Â·æ¯”æ‹‰â€” [æ­å¼€è¥¿å¡”æ–¹æ³•çš„é¢çº±](https://robjhyndman.com/papers/Theta.pdf)

åŠ¨è¯ ï¼ˆverb çš„ç¼©å†™ï¼‰Assimakopoulosï¼Œk . Nikolopoulosâ€”[theta æ¨¡å‹:é¢„æµ‹çš„åˆ†è§£æ–¹æ³•](https://www.researchgate.net/publication/223049702_The_theta_model_A_decomposition_approach_to_forecasting)

K.Nikolopoulosï¼ŒV. Assimakopoulosï¼ŒN. Bougioukosï¼Œa . Litsaâ€”[Theta æ¨¡å‹:ä¾›åº”é“¾è§„åˆ’çš„é‡è¦é¢„æµ‹å·¥å…·](https://www.researchgate.net/publication/288135300_The_Theta_Model_An_Essential_Forecasting_Tool_for_Supply_Chain_Planning)