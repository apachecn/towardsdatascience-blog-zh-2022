# æ‹¥æŠ±ç”¨äºæœºå™¨å­¦ä¹ çš„ Kubernetes:è®¾ç½®[1/3]

> åŸæ–‡ï¼š<https://towardsdatascience.com/embracing-kubernetes-for-machine-learning-setup-1-3-51c02686edfb>

## é€šè¿‡ Minikube ä¸ºæœ¬åœ°å¼€å‘è®¾ç½® Kubernetes

å®³æ€•å®ƒï¼Œé€ƒé¿å®ƒï¼Œåº“ä¼¯å†…ç‰¹è¿˜æ˜¯æ¥äº†ã€‚ç†Ÿæ‚‰æœ€æµè¡Œçš„å®¹å™¨ç¼–æ’å·¥å…·åœ¨ä»»ä½•ç°ä»£æœºå™¨å­¦ä¹ ç¯å¢ƒ(æˆ–ä»»ä½•è½¯ä»¶å¼€å‘ç¯å¢ƒ)ä¸­éƒ½æ˜¯ä¸å¯é¿å…çš„ã€‚

![](img/3f2fd651c3839e7b9654a40d2bb1d806.png)

å›¾ç‰‡æ¥æº: [Pixabay](https://pixabay.com/photos/container-ship-container-transport-6631117/)

ä¼—æ‰€å‘¨çŸ¥ï¼ŒKubernetes æ˜¯ä¸€ç§å¤§å¤šæ•°å¼€å‘äººå‘˜éƒ½åŒæ¶çš„å·¥å…·ï¼Œå¹¶ä¸”å¾ˆéš¾ç†è§£å’Œåˆ©ç”¨ã€‚ä¸ç®¡å®ƒå€¼ä¸å€¼å¾—ï¼Œå®ƒçœŸçš„ä¼šè®©äººæ„Ÿåˆ°æ— æ³•æŠ—æ‹’â€”â€”æœ€å¤§é™åº¦åœ°å‘æŒ¥ Kubernetes æ½œåŠ›çš„ä½“éªŒã€‚ä¸–ç•Œä¸Šèƒ½å¤ŸçœŸæ­£ç§°å¾—ä¸Šâ€œ*é©¯æœåº“ä¼¯å†…ç‰¹*çš„äººâ€çš„å¼€å‘è€…å¹¶ä¸å¤šã€‚ç„¶è€Œï¼Œäººä»¬ä¸éœ€è¦äº†è§£ Kubernetes æˆ–ä»»ä½•å·¥å…·çš„æ¯ä¸€ä»¶äº‹æƒ…ï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚æŒæ¡ä»»ä½•å·¥å…·éƒ½æ˜¯éœ€è¦æ—¶é—´ï¼Œç»ƒä¹ å’ŒåšæŒçš„ã€‚è¿™ç¯‡æ–‡ç« (*3 éƒ¨åˆ†ç³»åˆ—*çš„ä¸€éƒ¨åˆ†)ä»åœ¨ Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹çš„è§’åº¦å¯¹ Kubernetes çš„ä¸–ç•Œè¿›è¡Œäº†å®é™…ä»‹ç»ã€‚

> **NB** :è™½ç„¶é‡ç‚¹å¯èƒ½æ˜¯ä»æ¨¡å‹éƒ¨ç½²çš„è§’åº¦æ¥çœ‹ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« ä¸­æ¢ç´¢çš„æ¦‚å¿µæ˜¯å¦‚æ­¤çš„é€šç”¨ï¼Œä»¥è‡³äºæ²¡æœ‰ç†ç”±ä¸ºä»€ä¹ˆè¿™ä¸ªé€»è¾‘ä¸èƒ½åº”ç”¨äºä»»ä½•å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€‚æœ¬ç³»åˆ—çš„å…ˆå†³æ¡ä»¶æ˜¯å¯¹é€šè¿‡ Docker å®ç° app å®¹å™¨åŒ–æœ‰ä¸€äº›åŸºæœ¬çš„äº†è§£ã€‚è¿™ç¯‡[å…³äºåº”ç”¨å®¹å™¨åŒ–çš„æ—©æœŸæ–‡ç« ](https://medium.com/python-data/how-to-deploy-tensorflow-2-0-models-as-an-api-service-with-fastapi-docker-128b177e81f3)æ¨èç»™å¾ˆå°‘æˆ–æ²¡æœ‰ Docker ç»éªŒçš„è¯»è€…ã€‚

ä»¥ä¸‹éƒ¨åˆ†çš„æ”»å‡»è®¡åˆ’æ˜¯:

1.  æ¦‚è¿°ä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ Kubernetes
2.  å®‰è£… Minikube ä½œä¸ºæˆ‘ä»¬çš„æœ¬åœ° Kubernetes é›†ç¾¤
3.  éƒ¨ç½²ä¸€ä¸ªåŸºæœ¬åº”ç”¨ç¨‹åºæ¥æµ‹è¯•æ–°é›†ç¾¤

## Kubernetes (K8s)åˆ°åº•æœ‰ä»€ä¹ˆæ¨¡ç³Šä¹‹å¤„ï¼Ÿ

Kubernetes æ˜¯ Google çš„å¼€æºäº§å“ï¼Œç”¨äºå®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæ‰©å±•ã€‚åœ¨å®¹å™¨ä¸­è¿è¾“åº”ç”¨ç¨‹åºæ˜¯ç›®å‰è½¯ä»¶éƒ¨ç½²çš„é»„é‡‘æ ‡å‡†ï¼ŒKubernetes æä¾›äº†ä¸€ç§éå¸¸æœ‰è¶£çš„æ–¹å¼ï¼Œä»¥å¯ä¼¸ç¼©å’Œå¥å£®çš„æ–¹å¼è‡ªåŠ¨åŒ–å®¹å™¨ã€‚

> åå­— **Kubernetes** æºè‡ªå¸Œè…Šè¯­ï¼Œæ„ä¸ºèˆµæ‰‹æˆ–é¢†èˆªå‘˜ã€‚ **K8s** æ˜¯å¯¹â€œ **K** â€å’Œâ€œ **s** â€ä¹‹é—´çš„å…«ä¸ªå­—æ¯è¿›è¡Œè®¡æ•°å¾—åˆ°çš„ç¼©å†™ã€‚

åœ¨å½“å‰çš„å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼ŒæŒç»­ç›‘æ§å®¹å™¨ä»¥ä¾¿é‡‡å–å¿…è¦çš„æªæ–½æ¥é¿å…åœæœºæ˜¯è‡³å…³é‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¹å™¨ä¸€æ—¦æ­»äº¡ï¼Œå°±éœ€è¦ç«‹å³å¯åŠ¨æ–°çš„å®¹å™¨ã€‚æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œä¸€ç§å¹¼ç¨šçš„æ–¹æ³•æ˜¯ç¼–å†™æŸç§å½¢å¼çš„è‡ªåŠ¨åŒ–è„šæœ¬æ¥å®Œæˆè¿™ç±»æ“ä½œã€‚ç„¶è€Œï¼Œè¿™äº›åº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•°éƒ½æœ‰å¦‚æ­¤å¤šçš„ç§»åŠ¨å¾®å‹éƒ¨ä»¶ï¼Œè¿™æ ·çš„æ–¹æ³•åªä¼šå¯¼è‡´å¤§é‡çš„éº»çƒ¦ï¼Œæœ€ç»ˆä¼šå¤±è´¥ã€‚

Kubernetes é€šè¿‡æ¶ˆé™¤å¯¹ç¼–æ’çš„éœ€æ±‚ï¼Œä¸ºè‡ªåŠ¨ç®¡ç†å’Œè¿è¡Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ›´å¥å£®ã€æ›´æœ‰å¼¹æ€§çš„æ¡†æ¶ã€‚Kubernetes æä¾›äº†ä¸€äº›ä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼Œå¦‚ï¼›

*   è‡ªåŠ¨è‡ªæ„ˆ
*   è´Ÿè½½å¹³è¡¡
*   ç§˜å¯†ç®¡ç†
*   è‡ªåŠ¨åŒ–æ¨å‡ºå’Œå›æ»š
*   å­˜å‚¨ç¼–æ’
*   è‡ªåŠ¨è£…ç®±

è®©æˆ‘ä»¬æ·±å…¥ Kubernetes çš„ä¸€äº›é«˜çº§ç»„ä»¶ï¼Œäº†è§£å¯ä¼¸ç¼©æ€§çš„æ¦‚å¿µæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ

## åº“ä¼¯å†…ç‰¹æ–¯çš„åŸºæœ¬æˆåˆ†

æœ€æ ¸å¿ƒçš„æ˜¯ï¼Œä½¿ç”¨ Kubernetes çš„éƒ¨ç½²ä¼šå¯¼è‡´ Kubernetes é›†ç¾¤çš„åˆ›å»ºã€‚ä½†æ˜¯åœ¨è¿™ä¸ªåˆæˆçš„é›†ç¾¤ä¸­æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ

è¿™ä¸ªé›†ç¾¤ç”±è¿è¡Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ ***èŠ‚ç‚¹*** (ä¸€ç»„å·¥ä½œæœº)ç»„æˆã€‚æ¯ä¸ª Kubernetes é›†ç¾¤è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹ä¸»è¦æ‰˜ç®¡***pod***ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„è¿è¡Œçš„å®¹å™¨ã€‚è¿™äº›èŠ‚ç‚¹å’Œå•å…ƒç”± ***æ§åˆ¶å¹³é¢*** ç®¡ç†ï¼Œè¯¥æ§åˆ¶å¹³é¢è´Ÿè´£ä»¥è¿™æ ·çš„æ–¹å¼ç®¡ç†èŠ‚ç‚¹å’Œå•å…ƒï¼Œå³å®ç°å¹¶ä¿æŒç”¨æˆ·å®šä¹‰çš„æœŸæœ›çŠ¶æ€ã€‚å®é™…ä¸Šï¼Œäººä»¬å¯ä»¥å°† Kubernetes è§†ä¸ºä¸€ä¸ªç³»ç»Ÿï¼Œå…¶ä¸­ç”¨æˆ·æä¾›ä¸€äº›æ‰€éœ€çš„é…ç½®ï¼Œæ§åˆ¶å¹³é¢è°ƒåº¦å„ç§èŠ‚ç‚¹ï¼Œå®¹å™¨ pod åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šæ—‹è½¬ä»¥è¿è¡Œå„ç§å·¥ä½œè´Ÿè½½ï¼Œä»è€Œä»¥è‡ªåŠ¨åŒ–çš„æ–¹å¼å®ç°å’Œç»´æŠ¤é¢„æœŸçš„çŠ¶æ€ã€‚è¿™é‡Œçš„å–ç‚¹æ˜¯ï¼Œç”¨æˆ·å¯ä»¥æ‹¥æœ‰æ— é™æ•°é‡çš„è¿è¡Œå„ç§åº”ç”¨ç¨‹åºçš„èŠ‚ç‚¹ï¼Œæ‰€æœ‰è¿™äº›åº”ç”¨ç¨‹åºéƒ½ç”±ç¾¤é›†è‡ªåŠ¨ç®¡ç†ã€‚æŸä¸ªåº”ç”¨ç¨‹åºçš„å®ä¾‹åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šå´©æºƒäº†ï¼Ÿæ²¡é—®é¢˜ï¼å¦ä¸€ä¸ªä¼šè‡ªåŠ¨å¯åŠ¨ä»¥å–ä»£æ­»å»çš„é‚£ä¸ªã€‚è¿™ä¸ªç¥å¥‡çš„å·¥å…·æœ‰è¿™ä¹ˆå¤šï¼Œä½†æˆ‘å¸Œæœ›ä½ ç°åœ¨æ˜ç™½äº†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ï¼Œåœ¨æœ¬åœ°è®¾ç½®ä¸€ä¸ªï¼

## é€šè¿‡ Minikube åœ¨æœ¬åœ°è®¾ç½® Kubernetes

Minikube æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒèƒ½å¤Ÿä»¥ä¸€ç§ç®€å•çš„æ–¹å¼åœ¨æœ¬åœ°åˆ›å»º Kubernetes é›†ç¾¤ã€‚é¡¾åæ€ä¹‰ï¼ŒMinikube åªæ˜¯ä¸€ä¸ªè½»é‡çº§ç‰ˆæœ¬ï¼Œå…¶ä¸­éƒ¨ç½²çš„é›†ç¾¤æ˜¯ä¸€å°ä¸ªäººè®¡ç®—æœºä¸Šçš„å•ä¸ªèŠ‚ç‚¹ã€‚

> æœ¬ç³»åˆ—å‡è®¾è¯»è€…å°†åœ¨ç±»ä¼¼ UNIX çš„ç³»ç»Ÿä¸Šå®‰è£… Minikubeï¼Œå¦‚ Linux å‘è¡Œç‰ˆæˆ– Apple Macsã€‚åªèƒ½è®¿é—® Windows ç³»ç»Ÿçš„è¯»è€…åº”è¯¥ä½¿ç”¨ **WSL 2** æ¥è·Ÿè¿›ã€‚æœ¬ç³»åˆ—æ˜¯åœ¨ä¸€ä¸ª Linux å‘è¡Œç‰ˆä¸Šå®Œæˆçš„ï¼Œä½¿ç”¨ VSCode ä½œä¸º IDEã€‚æ‰€æœ‰çš„åŒ…éƒ½å¾ˆå®¹æ˜“ä»[**ã€AURã€‘**(ARCH ç”¨æˆ·åº“)](https://aur.archlinux.org/packages)å®‰è£…ã€‚

## å®‰è£…å¿…å¤‡å·¥å…·

*   å®‰è£…[*Docker CLI*](https://docs.docker.com/engine/install/#server)*(Mac ç”¨æˆ·å¯ä»¥ä½¿ç”¨ [*è‡ªåˆ¶*](https://formulae.brew.sh/formula/docker) )*
*   *å®‰è£… [*kubectl*](https://kubernetes.io/docs/tasks/tools/)*
*   *å®‰è£… [minikube](https://minikube.sigs.k8s.io/docs/start/) (Mac ç”¨æˆ·å¯ä»¥ä½¿ç”¨ [*è‡ªåˆ¶*](https://formulae.brew.sh/formula/minikube#default) *)**
*   *å®‰è£… [*kubectx*](https://github.com/ahmetb/kubectx)*
*   **åŠ æˆ*:ä¸º Kubernetes å®‰è£…å€¼å¾—æ³¨æ„çš„ VS ä»£ç æ‰©å±•( [*Kubernetes*](https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-kubernetes-tools) ï¼Œ[*Kubernetes*](https://marketplace.visualstudio.com/items?itemName=kubescape.kubescape))ã€‚*

## *é…ç½® Minikube é›†ç¾¤*

*æˆåŠŸå®‰è£… Minikube åï¼Œå°±å¯ä»¥é…ç½®é›†ç¾¤äº†ã€‚è®©æˆ‘ä»¬é¦–å…ˆä¸ºè¿™ä¸ª Minikube é›†ç¾¤å°†è¦é©»ç•™çš„è™šæ‹Ÿæœºå®šä¹‰ä¸€äº›å†…å­˜å’Œ CPU åˆ†é…ã€‚è¿™äº›åˆ†é…æ˜¯ä»»æ„çš„ï¼Œå› æ­¤æ ¹æ®ä¸æ‚¨çš„å¯ç”¨èµ„æºç›¸åŒ¹é…çš„ä»»ä½•æ‰€éœ€é…ç½®è¿›è¡Œåˆ†é…:*

```
***minikube config set cpus** **6** 
**minikube config set memory 12g
minikube delete --all***
```

*ç”±äºæˆ‘ä»¬é€‰æ‹© docker ä½œä¸ºæˆ‘ä»¬é›†ç¾¤çš„é©±åŠ¨ç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬å°†æ„å»ºä¸€äº› docker å®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹å†…å®¹å¯åŠ¨æˆ‘ä»¬çš„ Minikube é›†ç¾¤:*

```
***minikube start --driver=docker***
```

*![](img/71530dbc02ea2c5804e039d696834cd6.png)*

*è®¾ç½® minikube é›†ç¾¤é…ç½®å¹¶å¯åŠ¨å®ƒ(æ¥æº:ä½œè€…)*

*æ—¥å¿—æ˜¾ç¤ºä¸€åˆ‡æ­£å¸¸ï¼ŒMinikube é›†ç¾¤å·²ç»å¯åŠ¨å¹¶è¿è¡Œã€‚ç°åœ¨æ˜¯æ£€æŸ¥å…ˆå‰å®‰è£…çš„`kubectx`å’Œ`kubens`æ˜¯å¦èƒ½ä¸æ–°é›†ç¾¤äº¤äº’çš„å¥½æ—¶æœºã€‚å¯¹äºåç§°ç©ºé—´æ¥è¯´ï¼Œé»˜è®¤é€‰é¡¹ç°åœ¨å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®ä»»ä½•åç§°ç©ºé—´ã€‚æˆ‘ä»¬åªæœ‰ä¸€ä¸ªé›†ç¾¤ï¼Œå› æ­¤åˆ‡æ¢é›†ç¾¤ä¸Šä¸‹æ–‡ä»…é™äºåˆ›å»ºçš„ Minikube é›†ç¾¤ã€‚*

*![](img/c64563c3c18c0d097f87ec23dc4e9a62.png)*

*é€šè¿‡ kubens é€‰æ‹©åç§°ç©ºé—´(æ¥æº:ä½œè€…)*

*Minikube è¿˜éƒ¨ç½²äº†ä¸€ä¸ªä»ªè¡¨æ¿ï¼Œç”¨äºå¯è§†åŒ–åœ°æ¦‚è¿°æ‰€éƒ¨ç½²çš„é›†ç¾¤ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç­¾å‡ºè¯¥ä»ªè¡¨æ¿:*

```
***minikube dashboard***
```

*![](img/96a3ad2875a935fc7462cc507152a1c8.png)*

*Kubernetes ä»ªè¡¨æ¿(æ¥æº:ä½œè€…)*

## *å¯ç”¨ Minikube åŠ è½½é¡¹*

*ä¸€åˆ‡æ­£å¸¸åï¼Œç°åœ¨è®©æˆ‘ä»¬å¯ç”¨ä¸€äº›é™„åŠ ç»„ä»¶æ¥æ”¹å–„æˆ‘ä»¬çš„ç”¨æˆ· Kubernetes çš„æœ¬åœ°å¼€å‘ä½“éªŒã€‚è¯¥å‘½ä»¤æä¾›äº†è®¸å¤šé™„åŠ ç»„ä»¶:*

```
***minikube addons list***
```

*![](img/88527a046a656e99a757d24b1dc59377.png)*

*å¯ç”¨åŠ è½½é¡¹(æ¥æº:ä½œè€…)*

*å¤§å¤šæ•°ç”¨ä¾‹å¹¶ä¸éœ€è¦æ¯ä¸ªæ’ä»¶ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¯ç”¨å¹¶é…ç½®ä¸€äº›æˆ‘è®¤ä¸ºéå¸¸æœ‰ç”¨å’Œå®ç”¨çš„æ’ä»¶ã€‚æˆ‘é¼“åŠ±è¯»è€…æ·±å…¥æ¢ç©¶å®ƒä»¬ï¼Œå¹¶å¯ç”¨ä»–ä»¬å–œæ¬¢çš„å†…å®¹ã€‚å¯ç”¨ Minikube é™„åŠ ç»„ä»¶ä¹Ÿå¾ˆç®€å•ï¼›*

```
***minikube addons enable <NAME OF ADDON>***
```

*   ****æ—¥å¿—æŸ¥çœ‹å™¨*** :æ—¥å¿—å¯¹äºç›‘æ§éƒ¨ç½²è‡³å…³é‡è¦ã€‚æœ‰ä¸€ä¸ªæ¼‚äº®çš„æ’ä»¶ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªç½‘é¡µä¸Šæ˜¾ç¤ºé›†ç¾¤ä¸­çš„æ‰€æœ‰å®æ—¶æ—¥å¿—(éƒ¨ç½²åœ¨`http:**<YOUR_MINIKUBE_IP>**:32000`)å’Œè®¸å¤šå…¶ä»–æ—¥å¿—ç›¸å…³çš„å®ç”¨ç¨‹åºã€‚*

```
*â¯ **minikube addons enable logviewer**â–ª Using image ivans3/minikube-log-viewer:latest*
```

*   ****metrics-server* :** è¿™ä¸ªé™„åŠ ç»„ä»¶æä¾›äº†åº¦é‡ä»ªè¡¨æ¿ï¼Œæœ‰åŠ©äºå¯è§†åŒ–å·²éƒ¨ç½²åº”ç”¨ç¨‹åºçš„èµ„æºæ¶ˆè€—ã€‚å®ƒè¿˜å¯ä»¥å¾ˆå¥½åœ°ä¸ Kubernetes ä»ªè¡¨æ¿é›†æˆã€‚*

```
*â¯ **minikube addons enable metrics-server **                                                                                                
    â–ª Using image k8s.gcr.io/metrics-server/metrics-server:v0.4.2
ğŸŒŸ  The 'metrics-server' addon is enabled*
```

*   ****å…¥å£* :** åœ¨æŸç§å½¢å¼çš„å…¥å£æ§åˆ¶å™¨ä¸Šéƒ¨ç½²åº”ç”¨æ˜¯å¾ˆå¸¸è§çš„ã€‚è¿™ä¸ªæ’ä»¶ä¹Ÿæ”¯æŒå…¥å£æ§åˆ¶å™¨ã€‚å®ƒåªæ˜¯éƒ¨ç½²ä¸€ä¸ª Nginx å…¥å£æ§åˆ¶å™¨ï¼Œé€šè¿‡ä¸€ä¸ª`Nodeport`æœåŠ¡å°†åˆ†é…ç»™é›†ç¾¤çš„ IP æŒ‡å‘è¿™ä¸ªæ§åˆ¶å™¨ã€‚*

```
*â¯ **minikube addons enable ingress**       
    â–ª Using image k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1
    â–ª Using image k8s.gcr.io/ingress-nginx/controller:v1.1.1
    â–ª Using image k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1
ğŸ”  Verifying ingress addon...
ğŸŒŸ  The 'ingress' addon is enabled*
```

*   ****ingress-dns*:**Nginx Ingress æ§åˆ¶å™¨ç°åœ¨å°†æµé‡å®šå‘åˆ°æ–°é›†ç¾¤çš„ IPï¼Œè®©æˆ‘ä»¬å¯ç”¨æ­¤æ’ä»¶ï¼Œå› ä¸º Ingress åœ¨ DNS ä¸Šå·¥ä½œï¼Œå®ƒå°†è§£æä¸ºåˆ†é…ç»™ Minikube çš„ IPï¼Œå¹¶åœ¨ Kubernetes é›†ç¾¤ä¸­å……å½“ DNS æœåŠ¡ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé™„åŠ ç»„ä»¶ï¼Œä»»ä½•é’ˆå¯¹æ¯ä¸ªæœåŠ¡çš„*DNS è°ƒç”¨éƒ½å°†å¤±è´¥ï¼Œé™¤éæ˜¾å¼æ·»åŠ åˆ°ä¸»æœºä¸Šçš„`/etc/hosts`æ–‡ä»¶ä¸­ã€‚å¯¹äºä¸å–œæ¬¢ç¯¡æ”¹ä¸»æœºæ–‡ä»¶çš„è¯»è€…æ¥è¯´ï¼Œé€šè¿‡éµå¾ª[å®˜æ–¹æŒ‡å—](https://minikube.sigs.k8s.io/docs/handbook/addons/ingress-dns/)ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è®¾ç½®ä»»ä½•æƒ³è¦çš„ DNS é…ç½®ã€‚**

```
*â¯ **minikube addons enable ingress-dns **                                                                                                                                            
    â–ª Using image gcr.io/k8s-minikube/minikube-ingress-dns:0.0.2
ğŸŒŸ  The 'ingress-dns' addon is enabled*
```

*   ****registry-creds***:åœ¨ä¸»æµäº‘æä¾›å•†çš„ç§æœ‰å®¹å™¨æ³¨å†Œè¡¨ä¸­æ‰˜ç®¡åº”ç”¨ç¨‹åºæ˜¯ç›¸å½“å¸¸è§çš„ã€‚è¯¥æ’ä»¶å…è®¸ç”¨æˆ·é…ç½®æœ¬åœ° Minikube é›†ç¾¤ï¼Œä»¥è®¿é—®æ¥è‡ªè¿™äº›äº‘æä¾›å•†çš„ç§æœ‰æ³¨å†Œè¡¨ä¸­çš„æ˜ åƒã€‚ç›®å‰ï¼ŒAWSã€GCPã€Dockerã€Azure çš„å®¹å™¨æ³¨å†Œä¸­å¿ƒéƒ½å¾—åˆ°æ”¯æŒï¼Œè¿™å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é…ç½®ä»»ä½•é€‰æ‹©æ³¨å†Œè¡¨(æœ¬ç³»åˆ—å°†ä½¿ç”¨ Docker æ³¨å†Œè¡¨):*

```
*â¯ **minikube addons configure registry-creds**Do you want to enable AWS Elastic Container Registry? [y/n]: nDo you want to enable Google Container Registry? [y/n]: nDo you want to enable Docker Registry? [y/n]: y
-- Enter docker registry server url: [https://hub.docker.com/](https://hub.docker.com/)
-- Enter docker registry username: **<YOUR USERNAME>**
-- Enter docker registry password: **<YOUR PASSWORD>**Do you want to enable Azure Container Registry? [y/n]: n
âœ…  registry-creds was successfully configured*
```

*è®¾ç½®æ­£ç¡®çš„æ³¨å†Œè¡¨åï¼Œå¯ç”¨é™„åŠ ç»„ä»¶æœ¬èº«:*

```
*â¯ **minikube addons enable registry-creds**
    â–ª Using image upmcenterprises/registry-creds:1.10
ğŸŒŸ  The 'registry-creds' addon is enabled*
```

*   ***metallb:** äº‘æä¾›å•†ä¸º*è´Ÿè½½å¹³è¡¡å™¨*æœåŠ¡(æ¥è‡ªå¤–ç•Œçš„ç½‘ç»œè®¿é—®)åˆ†é… IPï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç§æœ‰å’Œæœ¬åœ°é›†ç¾¤å‘¢ï¼Ÿè¿™å°±æ˜¯è¿™ä¸ªæ¼‚äº®çš„é™„åŠ ç»„ä»¶çš„ç”¨æ­¦ä¹‹åœ°ã€‚å®ƒå°†è´Ÿè´£ä¸ºé›†ç¾¤ä¸­å„ç§å®šä¹‰çš„æœåŠ¡åˆ†é… IPã€‚è®©æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå‘½ä»¤æ¥å¯ç”¨å®ƒï¼›*

```
*â¯ **minikube addons enable metallb**       
    â–ª Using image metallb/speaker:v0.9.6
    â–ª Using image metallb/controller:v0.9.6
ğŸŒŸ  The 'metallb' addon is enabled*
```

*å³ä½¿å¯ç”¨äº† metallbï¼Œå®ƒä¹Ÿæ— æ³•æ‰¾åˆ°å¯ä»¥åˆ†é…ç»™æœåŠ¡çš„ IP èŒƒå›´ã€‚æˆ‘ä»¬éœ€è¦ç»™å®ƒè¿™ä¸ªèŒƒå›´çš„ IPã€‚é¦–å…ˆï¼Œæ£€æŸ¥ç¾¤é›†çš„ IPï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼äº†è§£ä¸€ä¸ªåˆé€‚çš„èŒƒå›´:*

```
*â¯ **echo $(minikube ip)**                                                                                                                                                            
XXX.XXX.XX.2*
```

*æœ‰äº†è¿™ä¸ª IP åœ°å€ï¼Œæˆ‘å†³å®šä»`XXX.xxx.xx.5`åˆ°`xxx.xxx.xx.55`ç»™å‡ºä¸€ä¸ª 50 çš„èŒƒå›´ï¼Œä½œä¸ºè´Ÿè½½å¹³è¡¡å™¨æœåŠ¡åº”è¯¥åˆ†é…åˆ°çš„èŒƒå›´*ã€‚è¯¥èŒƒå›´æ˜¯ä»»æ„çš„ï¼Œå› æ­¤æŒ‡å®šä»»ä½•æ‰€éœ€çš„èŒƒå›´ã€‚**

```
*â¯ **minikube addons configure metallb **                                                                                                                                             
-- Enter Load Balancer Start IP: XXX.XXX.XX.5
-- Enter Load Balancer End IP: XXX.XXX.XX.55                                                                                                                             
    â–ª Using image metallb/controller:v0.9.6
    â–ª Using image metallb/speaker:v0.9.6
âœ…  metallb was successfully configured*
```

*ç ï¼æˆ‘çŸ¥é“è®¾ç½®è¿™äº›ä¸œè¥¿å¯èƒ½æ˜¯ä¹å‘³å’Œæœºæ¢°çš„ï¼Œä½†æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†è®¾ç½®æˆ‘ä»¬æ–°çš„é—ªäº® Minikube é›†ç¾¤çš„æ‰€æœ‰èºæ “å’Œèºæ¯ã€‚æœ€åçœ‹ä¸€ä¸‹é™„åŠ ç»„ä»¶åˆ—è¡¨ï¼Œç°åœ¨åº”è¯¥ä¼šæ˜¾ç¤ºå·²ç»æˆåŠŸå¯ç”¨çš„é™„åŠ ç»„ä»¶ã€‚æ˜¯æ—¶å€™å¼€å§‹åœ¨è¿™ä¸ªæ–°é›†ç¾¤ä¸Šè¿›è¡Œä¸€äº›éƒ¨ç½²äº†ï¼*

*![](img/f1a4e0bfa8a928e560d183bf0f10d3b0.png)*

*Minikube æ’ä»¶å¯ç”¨çš„æœ€ç»ˆçŠ¶æ€(æ¥æº:ä½œè€…)*

## *åœ¨æ–°é›†ç¾¤ä¸Šæµ‹è¯•å»¶è¿Ÿ*

*æˆ‘ä»¬ç»å†çš„è¿™äº›éº»çƒ¦æ²¡æœ‰ç™½è´¹ã€‚è®©æˆ‘ä»¬å¯¹ä¸€äº›åŸºæœ¬åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›å¿«é€Ÿéƒ¨ç½²ï¼Œä»¥æ£€æŸ¥æˆ‘ä»¬çš„æ–°ç³»ç»Ÿæ˜¯å¦å¦‚é¢„æœŸé‚£æ ·å·¥ä½œã€‚*

```
***kubectl create deployment balanced --image=k8s.gcr.io/echoserver:1.4**
**kubectl expose deployment balanced --type=LoadBalancer --port=8080***
```

*![](img/9eedbc00f6a4698b57d45e5b5d67e67a.png)*

*ä½¿ç”¨ kubectl åœ¨é»˜è®¤åç§°ç©ºé—´ä¸­åˆ›å»ºåä¸ºâ€œbalancedâ€çš„éƒ¨ç½²(æ¥æº:ä½œè€…)*

*æ ¹æ®æ—¥å¿—ï¼Œechoserver æ¼”ç¤ºåº”ç”¨ç¨‹åºè¢«éƒ¨ç½²(éƒ¨ç½²åä¸º" *balanced"* )å¹¶åœ¨ 8080 ä¸Šä½œä¸º"*è´Ÿè½½å¹³è¡¡å™¨*"ç±»å‹çš„æœåŠ¡å…¬å¼€ã€‚è¦è·å¾—åˆ†é…çš„ IPï¼Œåªéœ€æ£€æŸ¥æ­¤éƒ¨ç½²çš„æœåŠ¡*

```
***kubectl get services balanced***
```

*![](img/9cca9bc12fa727667564ddbd3aef6735.png)*

*æ­£åœ¨æ£€æŸ¥ä¸ºå…¬å¼€çš„å¹³è¡¡è´Ÿè½½å¹³è¡¡å™¨æœåŠ¡åˆ†é…çš„å¤–éƒ¨ IP(æ¥æº:ä½œè€…)*

*ä»ç»™å®šçš„ä¿¡æ¯ä¸­ï¼Œè¯·æ³¨æ„`EXTERNAL-IP`éƒ¨åˆ†æ˜¯ä¸ºæ­¤éƒ¨ç½²åˆ†é…çš„ IPã€‚ä¸å…¬å¼€éƒ¨ç½²çš„ç«¯å£ç›¸ç»“åˆï¼Œç»™å‡ºäº†ä¸éƒ¨ç½²çš„åº”ç”¨ç¨‹åºè¿›è¡Œå¤–éƒ¨äº¤äº’çš„å®Œæ•´ URLã€‚è®©æˆ‘ä»¬é€šè¿‡å‘å‡º get è¯·æ±‚æ¥æŸ¥è¯¢è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚æˆ‘ä½¿ç”¨äº†`curl`ï¼Œä½†æ˜¯ä»»ä½•è¯·æ±‚å·¥å…·ç”šè‡³æµè§ˆå™¨éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œã€‚è®°ä½`**EXTERNAL-IP:PORT**`å‘é€å¤–éƒ¨ URLï¼*

```
*â¯ **curl <YOUR-ASSIGNED-EXTERNAL-IP>:8080**
CLIENT VALUES:
client_address=172.17.0.1
command=GET
real path=/
query=nil
request_version=1.1
request_uri=[http://](http://192.168.49.2:8080/)**<YOUR-ASSIGNED-EXTERNAL-IP>**[:8080/](http://192.168.49.2:8080/)SERVER VALUES:
server_version=nginx: 1.10.0 - lua: 10001HEADERS RECEIVED:
accept=*/*
host=**<YOUR-ASSIGNED-EXTERNAL-IP>**:8080
user-agent=curl/7.83.1
BODY:
-no body in request-%*
```

*éƒ¨ç½²çš„åº”ç”¨ç¨‹åºä¼¼ä¹æ­£åœ¨å®Œæˆå®ƒçš„å·¥ä½œï¼Œå› ä¸ºå®ƒåªæ˜¯å°†å‘é€åˆ°è¯¥æœåŠ¡å™¨çš„æ‰€æœ‰å†…å®¹å›æ˜¾ç»™ç”¨æˆ·ã€‚*

*æ­¤å¤–ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä»æ‰€æœ‰åç§°ç©ºé—´æˆ–æ‰€é€‰åç§°ç©ºé—´çš„å®æ—¶ç½‘é¡µè®¿é—®å…ˆå‰å¯ç”¨çš„æ—¥å¿—é™„åŠ ç»„ä»¶ã€‚*

```
*[http://](http://192.168.49.2:32000/)**<YOUR-****MINIKUBE****-IP>**[:32000/](http://192.168.49.2:32000/)*
```

*![](img/194bb6b05c9f175c39467c6739cdb570.png)*

*ä»æ—¥å¿—æŸ¥çœ‹å™¨æ’ä»¶æ£€æŸ¥æ—¥å¿—(æ¥æº:ä½œè€…)*

*å¦ä¸€ä¸ªä¸ Minikube é…åˆå¾—éå¸¸å¥½çš„å®ç”¨ç¨‹åºæ˜¯`[K9s](https://k9scli.io/)`ã€‚å®ƒåªæ˜¯ç»ˆç«¯ä¸­ç”¨äºç®¡ç†é›†ç¾¤çš„ä¸€ä¸ªäº¤äº’å¼ä»ªè¡¨æ¿ã€‚åªéœ€é€šè¿‡å‘½ä»¤`k9s`å¯åŠ¨å®ƒï¼Œå¹¶å°è¯•åœ¨`default`åç§°ç©ºé—´ä¸­æ€æ­»(`*ctrl+d*`)æˆ‘ä»¬åä¸º`balanced-xxxxxx`çš„éƒ¨ç½²ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚*

*![](img/a2e84c3ac0b13378ca4bb14d3dadb0ff.png)*

*æ¥è‡ª K9s çš„äº¤äº’ UI(æ¥æº:ä½œè€…)*

*è®©æˆ‘ä»¬æ¸…ç†ä¸ºè¿™ä¸ªåˆå§‹æ¼”ç¤ºåˆ›å»ºçš„éƒ¨ç½²å’ŒæœåŠ¡ã€‚*

```
*â¯ **kubectl delete services balanced  **                                         
service "balanced" deleted
â¯ **kubectl delete deployment balanced  **                                       
deployment.apps "balanced" deleted*
```

*æ­£å¦‚æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°çš„é‚£æ ·ï¼Œä»…ä»…ä½¿ç”¨è¿™äº›å•ä¸€çš„`kubectl`å‘½ä»¤ï¼Œå¤æ‚åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å°†ä¼šéå¸¸ç¹çã€‚æ ‡å‡†çš„åšæ³•æ˜¯å°†ä¸œè¥¿æ•´é½åœ°æ‰“åŒ…åˆ°`yaml`æ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯å¥å£®æ€§å’Œç´§å‡‘æ€§ã€‚åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºç±»ä¼¼çœŸå®ä¸–ç•Œä¸­ä½¿ç”¨`yaml`æ–‡ä»¶çš„éƒ¨ç½²ã€‚*

*æœ€åï¼Œé‡æ–°å¯åŠ¨è®¡ç®—æœºä¸ä¼šåˆ é™¤ç¾¤é›†æˆ–å¯ç”¨çš„é™„åŠ ç»„ä»¶åŠå…¶é…ç½®ã€‚æ­¤å¤–ï¼Œç¾¤é›†ä¸Šçš„æ‰€æœ‰éƒ¨ç½²ä¹Ÿå°†é‡æ–°å¯åŠ¨ã€‚*

*![](img/fcaa231b23e96fa143817e95ea917d22.png)*

*é‡å¯ç°æœ‰çš„æ—¥å¿—(æ¥æº:ä½œè€…)*

*æˆ‘ä»¬å°†åœ¨éšåçš„å¸–å­ä¸­è®¨è®ºé€‚å½“çš„éƒ¨ç½²ï¼Œæ‰€ä»¥å¦‚æœç°åœ¨ä¸€åˆ‡éƒ½æœ‰ç‚¹æ¨¡ç³Šï¼Œä¸è¦å¤ªæ‹…å¿ƒã€‚å¾ˆå¤šä¿¡æ¯éƒ½è¢«æ‰”ç»™ä½ äº†ã€‚åªæ˜¯ç©ç©è¿™ä¸ªéƒ¨ç½²ï¼Œå›é¡¾ä¸€ä¸‹æœ€åˆçš„æ¦‚å¿µã€‚Kubernetes çš„ä¸–ç•Œæ˜¯å·¨å¤§çš„ï¼å¹¸è¿çš„æ˜¯ï¼Œä½ ç°åœ¨æœ‰äº† Minikubeï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦æ¢ç´¢å®ƒã€‚åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨æ–°é›†ç¾¤ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹æ¥æ›´æ·±å…¥åœ°æ¢ç´¢ Kubernetes çš„ä¸–ç•Œã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¯·ç»§ç»­é˜…è¯»å…³äºæ‚¨å¯èƒ½åˆšåˆšè¯»åˆ°çš„ä¸€äº›æ¦‚å¿µçš„å¤§é‡æ–‡æ¡£ï¼Œå¹¶å°è¯•ä¸€äº›åŸºæœ¬çš„éƒ¨ç½²ï¼*