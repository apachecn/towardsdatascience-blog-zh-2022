# æœºå™¨å­¦ä¹ ä¸­å¦‚ä½•å‡†å¤‡ K é‡äº¤å‰éªŒè¯çš„æ•°æ®

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-to-prepare-data-for-k-fold-cross-validation-in-machine-learning-924a44ec322c>

![](img/ae7c6f1b051dc15605daadb4190a2ec6.png)

ä½œè€…å›¾ç‰‡

äº¤å‰éªŒè¯æ˜¯ç¬¬ä¸€ä¸ªç”¨æ¥é¿å…è¿‡åº¦æ‹Ÿåˆå’Œæ•°æ®æ³„æ¼çš„æŠ€æœ¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦åœ¨æˆ‘ä»¬çš„æ•°æ®ä¸Šè®­ç»ƒä¸€ä¸ªé¢„æµ‹æ¨¡å‹çš„æ—¶å€™ã€‚

å®ƒçš„åŠŸèƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬**ä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼**å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡ŒåŠŸèƒ½å’Œé€»è¾‘æµ‹è¯•â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œé¿å…è¿™äº›è¿‡ç¨‹æ±¡æŸ“æˆ‘ä»¬çš„éªŒè¯æ•°æ®ã€‚

å¦‚æœæˆ‘ä»¬æƒ³åšé¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹æˆ–å…¶ä»–è½¬æ¢ï¼Œ**æˆ‘ä»¬å¿…é¡»é¦–å…ˆæ­£ç¡®åœ°åˆ’åˆ†æˆ‘ä»¬çš„æ•°æ®ã€‚**

è¿™ç¡®ä¿äº†æˆ‘ä»¬çš„éªŒè¯æ•°æ®å®é™…ä¸Šä»£è¡¨äº†æˆ‘ä»¬çš„è®­ç»ƒé›†ï¼Œå¹¶ä¸”(å¯èƒ½)ä¹Ÿä»£è¡¨äº†æˆ‘ä»¬è¿˜æ²¡æœ‰çš„çœŸå®ä¸–ç•Œçš„æ•°æ®ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿ[åˆ›å»ºä¸€ä¸ªæ•°æ®é›†](/building-your-own-dataset-benefits-approach-and-tools-6ab096e37f2)å¹¶å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œé€‚å½“çš„åˆ’åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›¸å¯¹ç¡®å®šæˆ‘ä»¬ä»è®­ç»ƒä¸­è§‚å¯Ÿåˆ°çš„ç»“æœå®é™…ä¸Šæ˜¯å¯ç”¨çš„å¹¶ä¸”æ˜¯æ— åå·®çš„ã€‚

# å¦‚ä½•ä¸ºäº¤å‰éªŒè¯å‡†å¤‡æ•°æ®

æ­£å¦‚æˆ‘åœ¨å…³äº[äº¤å‰éªŒè¯ä»¥åŠå¦‚ä½•åœ¨ Python](/what-is-cross-validation-in-machine-learning-14d2a509d6a5) ä¸­åº”ç”¨å®ƒçš„æ–‡ç« ä¸­æ‰€å†™çš„ï¼Œå…¶ä¸­ä¸€ä¸ªåŸºæœ¬æ­¥éª¤æ˜¯æ ¹æ®æŠ˜å (æ•°æ®é›†éƒ¨åˆ†)å¯¹**ç›®æ ‡å˜é‡è¿›è¡Œåˆ†å±‚ã€‚**

è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å¯èƒ½çš„ç±»ä¸å¹³è¡¡å¯¹æ¨¡å‹çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚

ä¾‹å¦‚ï¼Œåœ¨äºŒå…ƒåˆ†ç±»çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ 80%çš„ç±»åˆ«æ˜¯è‚¯å®šçš„ï¼Œè€Œåªæœ‰ 20%æ˜¯å¦å®šçš„ã€‚è®­ç»ƒæ¨¡å‹è€Œä¸è€ƒè™‘è¿™ç§ä¸å¹³è¡¡å¯èƒ½ä¼šå¯¼è‡´ä¸å¯é çš„ç»“æœã€‚

æœ‰ä¸€äº›æ•°æ®å¹³è¡¡æŠ€æœ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æ–‡ä¸­æ¶‰åŠå®ƒä»¬ã€‚ç›¸åï¼Œæˆ‘å°†è§£é‡Šå¦‚ä½•ä½¿ç”¨ Pythonã€Pandas å’Œ Sklearn **åˆ›å»ºä¸€ä¸ªå¸¦æœ‰é¢å¤–åˆ—çš„æ•°æ®é›†ï¼Œè¯¥åˆ—å°†æŒ‡ç¤ºæ•°æ®é›†ä¸­çš„ä¸€è¡Œå±äºå“ªä¸ªæ–‡ä»¶å¤¹ã€‚**

> å¯¹äºæ•°æ®é›†çš„æ¯ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å°†æŒ‡å‡ºå®ƒå±äºå“ªä¸ªæŠ˜å ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªæŠ˜å ä¸Šæµ‹è¯•æˆ‘ä»¬çš„ç®—æ³•ï¼Œä½¿æˆ‘ä»¬çš„è¯„ä¼°æ€»ä½“ä¸Šæ›´åŠ ç¨³å¥ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ Python ä¸­åº”ç”¨è¿™ä¸ªè¿‡ç¨‹ã€‚

è®©æˆ‘ä»¬ä»å¯¼å…¥åŸºæœ¬åº“å¼€å§‹

```
import pandas as pd
from sklearn import model_selection
```

å‡è®¾æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®åœ¨è·¯å¾„ä¸º`./data/dataset_train.csv`çš„æ–‡ä»¶ä¸­ï¼Œè®©æˆ‘ä»¬ç”¨ Pandas å¯¼å…¥å®ƒï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸º fold çš„åˆ—ï¼Œæˆ‘ä»¬ç”¨å€¼-1 åˆå§‹åŒ–å®ƒã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„æŠ˜å å€¼å°†ä» 0 å¼€å§‹ã€‚

```
# import our training dataset
df = pd.read_csv("./data/dataset_train.csv")

# define a new column named 'fold'
df["fold"] = -1
```

é€šå¸¸æ•°æ®é›†æ˜¯æ··æ´—çš„â€”â€”æˆ‘ä»¬ä½¿ç”¨`.sample`è¿›è¡Œæ¨ç†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å‚æ•°`frac=1`å‘Šè¯‰ Pandas è·å–æ•´ä¸ªæ•°æ®é›†å¹¶éšæœºé‡‡æ ·ã€‚äº‹å®ä¸Šï¼Œè¿™å°†ä»¥ç®€å•æœ‰æ•ˆçš„æ–¹å¼æ‰“ä¹±æ•°æ®é›†çš„æ¯ä¸€è¡Œã€‚

```
df = df.sample(frac=1).reset_index(drop=True)
```

æ—¢ç„¶æˆ‘ä»¬å·²ç»æ‰“ä¹±äº†æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æˆ‘ä»¬çš„ç›®æ ‡å˜é‡ï¼Œå°†å…¶ä¼ é€’ç»™`sklearn.model_selection.StratifiedKFold`æ¥å¯¹æ•°æ®é›†è¿›è¡Œåˆ†å±‚ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªä»»æ„çš„æ•°å­— 5 ä½œä¸ºæˆ‘ä»¬çš„æŠ˜å ã€‚

ä¸€æ—¦åˆ›å»ºäº†å¯¹è±¡ï¼Œæˆ‘ä»¬å°±éå†æ•°æ®é›†çš„æ¯ä¸€è¡Œï¼Œå¹¶å°† Sklearn ç”Ÿæˆçš„éƒ¨åˆ†åº”ç”¨äºä¹‹å‰å…·æœ‰å¸¸æ•°å€¼-1 çš„åˆ—ã€‚

å®Œæˆåï¼Œæˆ‘ä»¬ä¿å­˜æ•°æ®é›†ã€‚

```
y = df["target"].values

# we initialize the kfold object with 5 slices
kf = model_selection.StratifiedKFold(n_splits=5)

# populate the fold column
for fold, (train_idx, valid_idx) in enumerate(kf.split(X=df, y=y)):
    df.loc[valid_idx, "fold"] = fold

# save the dataset
df.to_csv("./data/dataset_train_folds.csv")
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ•°æ®é›†ï¼Œé™¤äº†å®ƒæœ€åˆæ‹¥æœ‰çš„åˆ—ä¹‹å¤–ï¼Œç°åœ¨è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„åˆ—æ¥æŒ‡ç¤ºè¦åœ¨å…¶ä¸Šæ‰§è¡ŒéªŒè¯çš„æŠ˜å ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹æ•´ä¸ªå‰§æœ¬ã€‚

```
import pandas as pd
from sklearn import model_selection

if __name__ == "__main__":

    # import our training dataset
    df = pd.read_csv("./data/dataset_train.csv")

    # define a new column named 'fold'
    df["fold"] = -1

    # shuffle the dataset
    df = df.sample(frac=1).reset_index(drop=True)

    # initialize the target variable y
    y = df["target"].values

    # we initialize the kfold object with 5 slices
    kf = model_selection.StratifiedKFold(n_splits=5)

    # populate the fold column
    for fold, (train_idx, valid_idx) in enumerate(kf.split(X=df, y=y)):
        df.loc[valid_idx, "fold"] = fold

    # save the dataset
    df.to_csv("./data/dataset_train_folds.csv")
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œåªéœ€ç®€å•åœ°æ›´æ”¹æ•°æ®é›†åœ¨ç£ç›˜ä¸Šçš„è·¯å¾„ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰éªŒè¯æŠ˜å çš„å‰¯æœ¬**ã€‚**

**è¿™ç§æ–¹æ³•æ˜¯å®Œå…¨å¯æ‰©å±•çš„ï¼Œå‡ ä¹å¯ä»¥ç”¨äºä»»ä½•æœºå™¨å­¦ä¹ é—®é¢˜ã€‚**

# ç»“è®º

åœ¨è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ä½ åˆ†äº«äº†ä¸€æ®µä»£ç ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨æ¯ä¸ªæœºå™¨å­¦ä¹ é¡¹ç›®ä¸­ä½¿ç”¨**ã€‚**

äº‹å®ä¸Šï¼Œåœ¨å³å°†åˆ°æ¥çš„é¡¹ç›®ä¸­ä¸ä½¿ç”¨å®ƒå¯¹æˆ‘æ¥è¯´ä¼šå¾ˆå¥‡æ€ªã€‚**å®ƒé€‚ç”¨äºä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ï¼Œä¹Ÿé€‚ç”¨äºæ·±åº¦å­¦ä¹ ã€‚**

ä¸€æ—¦æ•°æ®è¢«åˆ†å‰²æˆå¤šä¸ªæŠ˜å ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå†æ¯ä¸ªæŠ˜å ï¼Œä¸€æ¬¡ä¸€ä¸ªæŠ˜å åœ°æµ‹è¯•æˆ‘ä»¬çš„å‡è®¾ã€‚è¿™æ˜¯å¼ºå¤§çš„ã€‚

**å¦‚æœæ‚¨æƒ³æ”¯æŒæˆ‘çš„å†…å®¹åˆ›ä½œæ´»åŠ¨ï¼Œè¯·éšæ—¶å…³æ³¨æˆ‘ä¸‹é¢çš„æ¨èé“¾æ¥ï¼Œå¹¶åŠ å…¥ Medium çš„ä¼šå‘˜è®¡åˆ’**ã€‚æˆ‘å°†æ”¶åˆ°ä½ æŠ•èµ„çš„ä¸€éƒ¨åˆ†ï¼Œä½ å°†èƒ½å¤Ÿä»¥æ— ç¼çš„æ–¹å¼è®¿é—® Medium çš„å¤§é‡æ•°æ®ç§‘å­¦æ–‡ç« ã€‚

<https://medium.com/@theDrewDag/membership>  

æˆ‘å¸Œæœ›æˆ‘å¯¹ä½ çš„æ•™è‚²æœ‰æ‰€è´¡çŒ®ã€‚ä¸‹æ¬¡è§ï¼ğŸ‘‹