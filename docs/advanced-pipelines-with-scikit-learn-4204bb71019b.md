# ä½¿ç”¨ scikit çš„é«˜çº§ç®¡é“-äº†è§£

> åŸæ–‡ï¼š<https://towardsdatascience.com/advanced-pipelines-with-scikit-learn-4204bb71019b>

## æ•´åˆæ¥è‡ª imblearn çš„æ¨¡å—ã€ç®¡é“ä¸­çš„åŠŸèƒ½å¼•æ“ï¼Œå¹¶æå–åŠŸèƒ½é‡è¦æ€§å›¾

![](img/9efbf07f946d5887e782633d589582e9.png)

ç…§ç‰‡ç”± [Pexels](https://www.pexels.com/de-de/foto/metallrohre-mit-manometer-372796/) æ‹æ‘„ã€‚

åœ¨æ‚¨çš„æœºå™¨å­¦ä¹ é¡¹ç›®ä¸­ä½¿ç”¨ç®¡é“æœ‰åŠ©äºä¸ºæ‚¨çš„å·¥ä½œæµå¸¦æ¥æ›´å¤šçš„ç»“æ„ã€‚å®ƒä»¬ä½¿æ‚¨çš„ä¸åŒè¿‡ç¨‹æ­¥éª¤æ›´å®¹æ˜“ç†è§£ã€é‡ç°ï¼Œå¹¶é˜²æ­¢æ•°æ®æ³„æ¼ã€‚

Scikit-learn pipeline ä¸å…¶å˜å‹å™¨ã€æ¨¡å‹å’Œå…¶ä»–æ¨¡å—é…åˆå¾—éå¸¸å¥½ã€‚**ç„¶è€Œ**ï¼Œå½“ä¸€ä¸ªäººè¯•å›¾**å°†** scikit-learn çš„ç®¡é“ä¸**æ¥è‡ª imblearn ç­‰å…¶ä»–åŒ…**çš„ç®¡é“è§£å†³æ–¹æ¡ˆæˆ–æ¨¡å—è¿›è¡Œåˆå¹¶æˆ–é›†æˆæ—¶(å³ä½¿å®ƒæ˜¯å»ºç«‹åœ¨ scikit-learn ä¹‹ä¸Šçš„)ï¼Œè¿™å¯èƒ½(éå¸¸)å…·æœ‰æŒ‘æˆ˜æ€§ã€‚

å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜:

```
**TypeError**: All intermediate steps should be transformers and implement fit and transform or be the string â€˜passthroughâ€™ â€˜SMOTE()â€™ (type <class â€˜imblearn.over_sampling._smote.base.SMOTEâ€™>) doesnâ€™t
```

å³ä½¿å®Œå…¨åšæŒ scikit-learn åŠŸèƒ½ï¼Œä»ç®¡é“ä¸­æå–æœ€ç»ˆä½¿ç”¨çš„ç‰¹æ€§æ¥åˆ›å»º**ç‰¹æ€§é‡è¦æ€§å›¾**ä¹Ÿå¸¸å¸¸æ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ã€‚

æœ¬æ–‡é€šè¿‡æ„å»ºä¸€ä¸ªç”¨äºå®¢æˆ·æµå¤±é¢„æµ‹çš„é›†æˆæˆ–æŠ•ç¥¨åˆ†ç±»å™¨çš„ä¾‹å­å‘æ‚¨å±•ç¤º**å¦‚ä½•** â€¦

*   ä» **scikit-learn** ã€ **imblearn** å’Œ **feature-engine** åŒ…ä¸­æ„å»ºä¸€ä¸ªåŒ…å«æ¨¡å—çš„ç®¡é“**ã€‚**
*   **åœ¨ç¼–ç æ­¥éª¤ä¹‹åï¼Œä»ä½ çš„ç®¡é“ä¸­æå–ç‰¹å¾**(ä¾‹å¦‚ï¼Œä¸€é”®ç¼–ç )ã€‚
*   åˆ›å»ºä¸€ä¸ª**ç‰¹å¾é‡è¦æ€§**å›¾ã€‚

> **é‡è¦æç¤º**:æˆ‘å»ºè®®å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ scikit-learn(åœ¨æ’°å†™æœ¬æ–‡æ—¶æ˜¯ 1.1.1)ä»¥ä¾¿èƒ½å¤Ÿä»ç®¡é“ä¸­æå–ç‰¹æ€§ã€‚ç”±äºè¿™ä¸ªè¦æ±‚ï¼Œä»£ç å°†ä¸èƒ½åœ¨ Google Colab (1.0.2)ä¸Šè¿è¡Œã€‚

# Outlook æœ€ç»ˆè§£å†³æ–¹æ¡ˆ:åœ¨ä¸€ä¸ªç®¡é“ä¸­ç»„åˆæ¥è‡ªä¸åŒåŒ…çš„å‡ ä¸ªæ¨¡å—

![](img/0067b2b5cc6217b6effc19836aa89e4b.png)

å›¾ä¸€ã€‚æœ€ç»ˆç®¡é“(å›¾ç‰‡ç”±ä½œè€…æä¾›)ã€‚

å›¾ 1 æ˜¾ç¤ºäº†æˆ‘ä»¬å¸Œæœ›åœ¨æœ¬æ–‡æœ«å°¾çœ‹åˆ°çš„å†…å®¹ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å®ç°è¿™äº›æ­¥éª¤ä¸­çš„æ¯ä¸€ä¸ªã€‚ä»ä¸¢å¼ƒä¸ç›¸å…³çš„ç‰¹å¾(æ­¥éª¤ 1)åˆ°åº”ç”¨ä¼°ç®—å™¨å’Œç¼©æ”¾å™¨(æ­¥éª¤ 2)å’Œå¤„ç†ç±»åˆ«ä¸å¹³è¡¡(æ­¥éª¤ 3)åˆ°æˆ‘ä»¬çš„é›†æˆæ¨¡å‹(æ­¥éª¤ 4)ã€‚åœ¨ç¬¬ 5 æ­¥ä¸­ï¼Œæˆ‘ä»¬åº”ç”¨è¶…å‚æ•°ä¼˜åŒ–å¹¶åˆ›å»ºä¸€ä¸ªç‰¹å¾é‡è¦æ€§å›¾ã€‚

> EDAã€ç‰¹å¾æ„å»ºã€æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½ã€åˆ†æå’Œè§£é‡Šç»“æœä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ã€‚ç›®æ ‡æ˜¯å‘æ‚¨å±•ç¤º**å¦‚ä½•ä½¿ç”¨é›†æˆäº†æ¥è‡ªä¸åŒåŒ…çš„æ¨¡å—çš„ç®¡é“**ã€‚

# æ­¥éª¤ 0:å‡†å¤‡å’Œæ•°æ®åŠ è½½

åœ¨è®¾ç½®æˆ‘ä»¬çš„ç®¡é“ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åŠ è½½æˆ‘ä»¬éœ€è¦çš„åŒ…å’Œç¤ºä¾‹æ•°æ®ã€‚

ä¸‹é¢çš„ä»£ç å‘æ‚¨å±•ç¤ºäº†æœ¬æ–‡ä¸­æ‰€éœ€çš„åŒ…å’Œæ¨¡å—ã€‚

ä¸Šé¢çš„ä»£ç å¯¼å…¥äº†å¸¸è§çš„å«Œç–‘äºº(ç†ŠçŒ«ã€numpy ç­‰ã€‚)ï¼Œæåˆ°çš„è½¯ä»¶åŒ… scikit-learn(æˆ– sklearn)ï¼Œimblearn å’Œ feature-engineã€‚å®ƒè¿˜å¯¼å…¥äº† xgboostï¼Œè¿™æ˜¯æˆ‘ä»¬çš„é›†æˆåˆ†ç±»å™¨çš„ä¸€éƒ¨åˆ†ï¼Œä»¥åŠç”¨äºè¶…å‚æ•°è°ƒæ•´çš„ scipy åŒ…ä¸­çš„ loguniform æ¨¡å—ã€‚

> å¦‚æœä½ ä»¥å‰æ²¡æœ‰å¬è¯´è¿‡ imblearn å’Œç‰¹æ€§å¼•æ“åŒ…ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„è§£é‡Šã€‚ [**Imblearn**](https://imbalanced-learn.org/stable/) é€šè¿‡æä¾›ä¸åŒçš„é‡‡æ ·ç­–ç•¥ï¼Œå¸®åŠ©ä½ å¤„ç†**ç±»ä¸å¹³è¡¡**ã€‚ [**ç‰¹å¾å¼•æ“**](https://feature-engine.readthedocs.io/en/latest/) æä¾›æ¨¡å—**ç®¡ç†æ•°æ®é›†ä¸­çš„åˆ—æˆ–ç‰¹å¾**(ä¾‹å¦‚ï¼Œåˆ é™¤ä¸ç›¸å…³çš„)ã€‚

## æ•°æ®é›†:æŠ¥çº¸æµå¤±

æ‰€ä½¿ç”¨çš„æ•°æ®é›†æ¥è‡ªä»¥å‰çš„ [Kaggle ç«èµ›](https://www.kaggle.com/datasets/andieminogue/newspaper-churn)å¹¶è·å¾— *CC0:å…¬å…±é¢†åŸŸ*è®¸å¯ã€‚å®ƒåŒ…å« 15.855 æ¡è®°å½•å’Œ 19 åˆ—ï¼ŒåŒ…æ‹¬ç›®æ ‡å˜é‡*è®¢æˆ·*(æ˜¯/å¦)ã€‚å¤§å¤šæ•°ç‰¹å¾éƒ½æ˜¯å…¸å‹çš„ã€‚

ä¸‹é¢çš„ä»£ç åŠ è½½æ•°æ®å¹¶åº”ç”¨ä¸€äº›é¢„å¤‡æ­¥éª¤ï¼Œæ¯”å¦‚å°†æ‰€æœ‰åˆ—åè½¬æ¢æˆå°å†™å¹¶å°†ç›®æ ‡å˜é‡è½¬æ¢æˆå¸ƒå°”å€¼ã€‚

åœ¨åº”ç”¨è¿™äº›æ¬¡è¦çš„é¢„æ¸…ç†æ­¥éª¤åï¼Œæ•°æ®åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/344341c665e5115fe789410fcc46bdc0.png)

å›¾äºŒã€‚æ‘˜å½•æŠ¥çº¸èµ„æ–™(å›¾ç‰‡ç”±ä½œè€…æä¾›)ã€‚

# æ­¥éª¤ 1:æ’é™¤ç‰¹å¾

ç®¡é“ä¸­çš„ç¬¬ä¸€æ­¥æ˜¯æ’é™¤æˆ–åˆ é™¤å¯¹æˆ‘ä»¬çš„é¢„æµ‹æ²¡æœ‰å¸®åŠ©çš„åˆ—ã€‚ä¾‹å¦‚ï¼Œåˆ— *subscriptionidï¼Œ*æ¯è¡Œæœ‰ä¸åŒçš„å€¼ï¼Œè¿™æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†æ˜¯è¿™ä¸ªç‰¹æ€§å¯¹æˆ‘ä»¬çš„å»ºæ¨¡æ­¥éª¤æ²¡æœ‰å¥½å¤„ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ’é™¤é‡å¤çš„ç‰¹å¾(ä¾‹å¦‚ï¼Œå…·æœ‰ç›¸åŒå€¼çš„ç›¸åŒåˆ—ä¸¤æ¬¡æˆ–æ›´å¤šæ¬¡)å’ŒåŒ…å«å¸¸æ•°å€¼çš„ç‰¹å¾ã€‚

ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª[ç®¡é“](https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html)å¯¹è±¡(`line 1`)ï¼Œå¹¶æ·»åŠ äº†ä¸‰ä¸ªæ­¥éª¤(`lines 3â€“5`)ã€‚æ­¥éª¤è¢«å®šä¹‰ä¸ºå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å®šä¹‰æ­¥éª¤çš„åç§°(ä¾‹å¦‚ï¼Œ*â€˜drop _ columnsâ€™*)ï¼Œç¬¬äºŒä¸ªå…ƒç´ å®šä¹‰è½¬æ¢å™¨(ä¾‹å¦‚ï¼Œ *DropFeatures()* )ã€‚

> è¿™äº›éƒ½æ˜¯éå¸¸ç®€å•çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥åº”ç”¨åˆ°ç®¡é“ä¹‹å¤–(ä¾‹å¦‚ï¼Œç†ŠçŒ«)ã€‚ç„¶è€Œï¼Œæœ¬æ–‡çš„æƒ³æ³•æ˜¯åœ¨ç®¡é“ä¸­é›†æˆå°½å¯èƒ½å¤šçš„åŠŸèƒ½ã€‚æ›´å¤šå…³äºç‰¹æ€§å¼•æ“åŒ…çš„ä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](https://feature-engine.readthedocs.io/en/latest/api_doc/index.html)æ‰¾åˆ°*ğŸ“—*ã€‚
> 
> è“è‰²åœ†åœˆä¸­çš„â€œæ­¥éª¤â€(å›¾ 1)å’Œæ ‡é¢˜æ˜¯æŒ‡å¯¼æ‚¨é˜…è¯»æœ¬æ–‡çš„æ­¥éª¤ã€‚ä¸Šé¢ä»£ç ä¸­çš„æ­¥éª¤æ˜¯â€œçœŸæ­£çš„â€ç®¡é“æ­¥éª¤ã€‚

# æ­¥éª¤ 2:ä¼°ç®—å’Œè½¬æ¢å€¼

åœ¨æˆ‘ä»¬åˆ é™¤äº†ä¸ç›¸å…³çš„åˆ—ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å…³æ³¨äºå¤„ç†ç¼ºå¤±å€¼å’Œç‰¹æ€§ç¼©æ”¾ã€‚æˆ‘ä»¬çš„æ•°æ®é›†åŒ…å«ä¸åŒç±»å‹çš„åˆ—( *integer* å’Œ *categorial* )ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»å®šä¹‰ä¸¤ä¸ªç‹¬ç«‹çš„å·¥ä½œæµã€‚

æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º*æ¸…ç†*çš„æ–°æ­¥éª¤ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª ColumnTransformer å¯¹è±¡(`line 8`)ã€‚åœ¨ ColumnTransformer ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸¤æ¡æ–°ç®¡é“ã€‚ä¸€ä¸ªç”¨äºå¤„ç†æ•°å€¼(`line 10`)ï¼Œä¸€ä¸ªç”¨äºå¤„ç†ç±»åˆ«å€¼(`line 16`)ã€‚ä¸ºäº†ç¡®ä¿ä¸ºæ¯ä¸ªæ­¥éª¤é€‰æ‹©æ­£ç¡®çš„åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† *make_column_selector* æ–¹æ³•(`lines 13,19`)ã€‚

> æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ dtype_include å‚æ•°æ¥é€‰æ‹©ç›¸å…³çš„åˆ—ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æä¾›åˆ—ååˆ—è¡¨æˆ– regex è¯­å¥ã€‚

# ç¬¬ä¸‰æ­¥:å–æ ·

æµå¤±æˆ–æ¬ºè¯ˆåˆ†ç±»çš„ä¸€å¤§æŒ‘æˆ˜æ˜¯å¤„ç†ç±»åˆ«ä¸å¹³è¡¡ã€‚Imblearn æä¾›äº†ä¸€ç³»åˆ—å¯ä¾›æ‚¨åº”ç”¨çš„é‡‡æ ·æ–¹æ³•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ SMOTE é‡‡æ ·æ–¹æ³•(`line 23`)ã€‚

## ä»ç®¡çº¿ä¸­æå–å˜æ¢å’Œç¼©æ”¾çš„ç‰¹å¾

åœ¨ç¬¬ 4 æ­¥å»ºç«‹æˆ‘ä»¬çš„é›†æˆåˆ†ç±»å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¦æ£€æŸ¥å“ªäº›ç‰¹å¾é€šè¿‡äº†ç®¡é“ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒä»€ä¹ˆã€‚

å›¾ 3 æ˜¾ç¤ºäº†æˆ‘ä»¬ç®¡é“çš„å½“å‰çŠ¶æ€ã€‚

![](img/6b2abf6ab1f8961397d863769ac876b4.png)

å›¾ 3ã€‚æ­¥éª¤ 3 åçš„ç®¡é“(å›¾ç‰‡ç”±ä½œè€…æä¾›)ã€‚

pipeline å¯¹è±¡æä¾›äº†ä¸€ä¸ªåä¸º*get _ feature _ names _ out()*çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®é›†ä¸Šå®‰è£…ç®¡é“ã€‚ç”±äºæ­¥éª¤ 3 (SMOTE)åªå…³æ³¨æˆ‘ä»¬çš„ y æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ƒï¼Œåªå…³æ³¨æ­¥éª¤ 1â€“2ã€‚

ä¸Šé¢çš„ä»£ç (`line 1`)æå–äº†ä» *DropFeatures* ( `[0:`)åˆ°*cleaning:column transformer*(`:4]`)æ­¥éª¤çš„æµæ°´çº¿æ­¥éª¤ï¼Œå¹¶æ‹Ÿåˆè®­ç»ƒæ•°æ®(`line 2`)ã€‚ç®¡é“æ‹Ÿåˆå¥½åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨*get _ feature _ names _ out()*æ–¹æ³•ã€‚ç»“æœçœ‹èµ·æ¥åƒè¿™æ ·:

```
0                    num__year_of_residence
1                             num__zip_code
2                       num__reward_program
3        cat__hh_income_$  20,000 - $29,999
4        cat__hh_income_$  30,000 - $39,999
                        ...                
12122               cat__source_channel_TMC
12123            cat__source_channel_TeleIn
12124           cat__source_channel_TeleOut
12125               cat__source_channel_VRU
12126          cat__source_channel_iSrvices
Length: 12127, dtype: object
```

ç”±äºä¸€æ¬¡çƒ­ç¼–ç ï¼Œäº§ç”Ÿäº†è®¸å¤šæ–°åŠŸèƒ½( *cat__XX_XX* )ã€‚å‘½åçº¦å®šå‘æ‚¨æ˜¾ç¤ºè¯¥ç‰¹å¾æ˜¯æ•°å­—ç‰¹å¾è¿˜æ˜¯ç±»åˆ«ç‰¹å¾(å¦‚ *cat__* )ã€å…¶åç§°(å¦‚ *source_channel_* )ä»¥åŠç›¸å…³å€¼( *TMC* )ã€‚

> ä¸ºäº†[åƒæˆ‘ä¸€æ ·æ˜¾ç¤ºæ‚¨çš„ç®¡é“](https://scikit-learn.org/stable/auto_examples/miscellaneous/plot_pipeline_display.html)(ä¾‹å¦‚ï¼Œå›¾ 3)ï¼Œåªéœ€åœ¨è°ƒç”¨æ‚¨çš„ç®¡é“å¯¹è±¡(ä¾‹å¦‚ï¼Œ`ppl`)ä¹‹å‰å°†`set_config(display="diagram")`æ”¾åœ¨æ‚¨çš„ä»£ç ä¸­ã€‚å‚è§æ­¥éª¤ 0â€œå‡†å¤‡å’Œæ•°æ®åŠ è½½â€ä»£ç è¡Œ 33ã€‚

# æ­¥éª¤ 4:æ„å»ºé›†æˆåˆ†ç±»å™¨

ç°åœ¨æ˜¯æ—¶å€™å»ºç«‹æˆ‘ä»¬çš„é›†æˆæˆ–æŠ•ç¥¨åˆ†ç±»å™¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªæ¨¡å‹çš„**å‡å€¼é¢„æµ‹**(`lines 2â€“6`)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å°†*æŠ•ç¥¨å‚æ•°*è®¾ç½®ä¸º*è½¯* ( `line 8`)ã€‚

åœ¨å®šä¹‰é›†åˆæ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å‡†å¤‡å°†å®ƒé›†æˆåˆ°æˆ‘ä»¬çš„ç®¡é“ä¸­ã€‚

å¦‚æœä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œé‚£ä¹ˆä½ å·²ç»çœ‹åˆ°äº†`line 1`çš„å˜åŒ–ã€‚æˆ‘ä»¬ç°åœ¨ç”¨çš„ä¸æ˜¯ sklearn çš„ *Pipeline* å¯¹è±¡ï¼Œè€Œæ˜¯ imblearn çš„*im Pipeline*ã€‚

å¦‚æœæˆ‘ä»¬ä¸è¿™æ ·åšï¼Œé‚£ä¹ˆåœ¨æ‹Ÿåˆ(`ppl.fit(X_train, y_train)`)æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯:

```
**TypeError**: All intermediate steps should be transformers and implement fit and transform or be the string 'passthrough' 'SMOTE()' (type <class 'imblearn.over_sampling._smote.base.SMOTE'>) doesn't
```

å¤ªå¥½äº†ï¼æˆ‘ä»¬ç»ˆäºç»„è£…å¥½äº†ç®¡é“ã€‚ç»“æœå¯ä»¥åœ¨å›¾ 4 ä¸­çœ‹åˆ°ã€‚

![](img/f3bfb4760c7a83dce22daf8966708b1e.png)

å›¾ 4ã€‚æœ€ç»ˆç®¡é“(å›¾ç‰‡ç”±ä½œè€…æä¾›)ã€‚

# æ­¥éª¤ 5:è¶…å‚æ•°è°ƒæ•´å’Œç‰¹æ€§é‡è¦æ€§

## è¶…å‚æ•°è°ƒè°

ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•é€šè¿‡ä½¿ç”¨ *RandomizedSearchCV* æ¥åº”ç”¨è¶…å‚æ•°è°ƒæ•´ã€‚

å®šä¹‰çš„å‚æ•°(`lines 3-17`)éµå¾ªç‰¹å®šçš„å‘½åæƒ¯ä¾‹:

*   ç¬¬ä¸€ä¸ªå‚æ•°( *ensemble__* ):æŠ•ç¥¨åˆ†ç±»å™¨çš„åç§°
*   ç¬¬äºŒä¸ªå‚æ•°( *lr__* ):æˆ‘ä»¬é›†åˆä¸­ä½¿ç”¨çš„æ¨¡å‹çš„åç§°
*   ç¬¬ä¸‰ä¸ªå‚æ•°(*è§£ç®—å™¨*):æ¨¡å‹ç›¸å…³è¶…å‚æ•°çš„åç§°

å› ä¸ºæˆ‘ä»¬å¿…é¡»å¤„ç†ç±»ä¸å¹³è¡¡ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨é‡å¤åˆ†å±‚ k-fold ( `line 20`)ã€‚æ›´å¤šå…³äºå…¶ä¼˜åŠ¿çš„ä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](https://machinelearningmastery.com/cross-validation-for-imbalanced-classification/)æ‰¾åˆ°ã€‚

> å¦‚æœæ‚¨**ä¸æƒ³ä½¿ç”¨è¶…å‚æ•°è°ƒæ•´**è€Œæƒ³ä½¿ç”¨æ‚¨è‡ªå·±çš„è¶…å‚æ•°å€¼ï¼Œæ‚¨å¯ä»¥åœ¨æ¨¡å‹åˆå§‹åŒ–(æ­¥éª¤ 4)æ—¶è®¾ç½®å®ƒä»¬ï¼Œæˆ–è€…åœ¨ä¹‹å‰æ·»åŠ ä¸€ä¸ªæ–°è¡Œ**ç”¨`*ppl.set_params(**dict_with_best_params)*` *æ‹Ÿåˆè¯­å¥(`*ppl.fit()*`)ã€‚***

## ç‰¹å¾é‡è¦æ€§å›¾

ä¸ºäº†ä½¿ç”¨æˆ‘ä»¬çš„ç®¡é“åˆ›å»ºä¸€ä¸ªç‰¹å¾é‡è¦æ€§å›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† [**æ’åˆ—é‡è¦æ€§**](https://scikit-learn.org/stable/auto_examples/inspection/plot_permutation_importance.html) ã€‚

`Lines 3 to 13`æ˜¾ç¤ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ç¨åå°†ç»˜åˆ¶æˆ‘ä»¬çš„ç‰¹å¾é‡è¦æ€§ã€‚`lines 16 to 18`ä¸­çš„ä»£ç æå–äº†æˆ‘ä»¬ç®¡é“ä¸­ä½¿ç”¨çš„ç‰¹æ€§åç§°(ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ç¬¬ 3 æ­¥ç»“æŸæ—¶åšäº†åŒæ ·çš„äº‹æƒ…)ã€‚åœ¨æœ€åä¸¤è¡Œ(`lines 20 to 21`)ä¸­ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒæ•°æ®ä¸Šä½¿ç”¨æ‹Ÿåˆçš„æ¨¡å‹/ç®¡é“æ¥è®¡ç®—æ’åˆ—é‡è¦æ€§ã€‚

æŸ¥çœ‹ç‰¹å¾æˆ–æ’åˆ—é‡è¦æ€§å›¾(å›¾ 5)ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç‰¹å¾ *hh_income* ä¸»å¯¼äº†é¢„æµ‹ã€‚ç”±äºè¯¥ç‰¹æ€§åŒ…å«å¯æ’åºçš„å€¼(30â€“40k å°äº 150â€“175k)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼(ä¾‹å¦‚ï¼Œä½¿ç”¨ LabelEncoding)ã€‚

![](img/f2c60ef62b951f379773312d30295cd2.png)

å›¾ 5ã€‚æ’åˆ—é‡è¦æ€§å›¾(å›¾ç‰‡ç”±ä½œè€…æä¾›)ã€‚

# ç»“è®º

ä½¿ç”¨ç®¡é“å¯èƒ½ä¼šè®©äººç¥ç»ç´§å¼ ã€‚ç‰¹åˆ«æ˜¯å¦‚æœä½ æƒ³æå–ç‰¹æ€§ï¼Œç»„åˆå’Œä½¿ç”¨ä¸åŒåŒ…ä¸­çš„æ¨¡å—ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç‰¹æ€§é‡è¦æ€§å›¾ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå¸¦æœ‰ä¸å¹³è¡¡ç±»çš„åˆ†ç±»é—®é¢˜çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªé«˜çº§ç®¡é“å¹¶åº”ç”¨ä¸Šé¢æåˆ°çš„æ‰€æœ‰æ­¥éª¤ã€‚

# æ¥æº

**æ•°æ®é›†**:[https://www . ka ggle . com/datasets/andieminogue/newspaper-churn](https://www.kaggle.com/datasets/andieminogue/newspaper-churn)(**CC0**:å…¬å…±é¢†åŸŸ)

**Scikit-learn**:[https://Scikit-learn . org/stable/modules/generated/sk learn . pipeline . pipeline . html](https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html)

**ä¸å¹³è¡¡å­¦ä¹ **:[https://ä¸å¹³è¡¡å­¦ä¹ . org/stable/references/generated/imb learn . pipeline . pipeline . html](https://imbalanced-learn.org/stable/references/generated/imblearn.pipeline.Pipeline.html)

**ç‰¹å¾-å¼•æ“**:ã€https://feature-engine.readthedocs.io/en/latest/ 

**åˆ›å»ºç‰¹å¾é‡è¦æ€§å›¾**:[https://inria . github . io/scikit-learn-mooc/python _ scripts/dev _ features _ importance . html](https://inria.github.io/scikit-learn-mooc/python_scripts/dev_features_importance.html)