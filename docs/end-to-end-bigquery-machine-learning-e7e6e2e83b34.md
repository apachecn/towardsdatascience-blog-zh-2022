# ç«¯åˆ°ç«¯ BigQuery æœºå™¨å­¦ä¹ 

> åŸæ–‡ï¼š<https://towardsdatascience.com/end-to-end-bigquery-machine-learning-e7e6e2e83b34>

## ä½¿ç”¨ Google Cloud BigQuery å‚åŠ  Kaggle ç«èµ›

æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä»…ä½¿ç”¨ BigQuery å’Œ Kaggle API æ¥é¢„æµ‹æ³°å¦å°¼å…‹å·ç¾éš¾**çš„å¹¸å­˜è€…ã€‚è‡ªä»æˆ‘é‡åˆ° BigQueryï¼Œæˆ‘å°±æˆäº†å®ƒçš„ç²‰ä¸ã€‚å®ƒå¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œè¶…çº§å¿«ï¼Œè¶…çº§ä¾¿å®œâ€”â€”å¦‚æœä½ ç”¨å¾—å¥½çš„è¯â€¦**

å®ƒä¸ä»…å¯ä»¥è¿›è¡Œ Pb çº§çš„å¤æ‚åˆ†æï¼Œè¿˜å¯ä»¥è¿è¡Œä¸€äº›æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ¥è‡ª SQLã€‚æˆ‘ä¸å»ºè®®ä½ å¯¹æ‰€æœ‰çš„å·¥ä½œéƒ½è¿™æ ·åšï¼Œä½†å¯¹äºæŸäº›ä»»åŠ¡ï¼Œ **BigQuery æ˜¯æœºå™¨å­¦ä¹ çš„ç†æƒ³é€‰æ‹©ï¼Œå› ä¸ºå®ƒçš„è¯­æ³•ç®€å•ï¼Œæˆæœ¬ä½**ï¼Œè€Œä¸”å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª**å®Œå…¨æ‰˜ç®¡çš„æœåŠ¡**ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒå®ƒåœ¨å“ªé‡Œè¿è¡Œæˆ–è€…å¦‚ä½•è¿è¡Œã€‚

æˆ‘ä»¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

1.  ä½¿ç”¨ CLI å·¥å…·ä» Kaggle ä¸‹è½½æ•°æ®é›†
2.  å°†å…¶ä½œä¸º BigQuery è¡¨ä¸Šä¼ 
3.  å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒå’Œæµ‹è¯•
4.  è®­ç»ƒé€»è¾‘å›å½’æ¨¡å‹
5.  å‘ Kaggle æäº¤é¢„æµ‹
6.  åœ¨ç«äº‰ä¸­è·å¾—ç¬¬ä¸€åâ€”â€”å¯èƒ½ä¸ä¼šğŸ˜…

> è¦è·å¾—æ‰€æœ‰åª’ä½“æ–‡ç« çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆ‘çš„æ–‡ç« ï¼Œè¯·è€ƒè™‘åœ¨æ­¤è®¢é˜…ã€‚

# å‡†å¤‡å¥½

![](img/90d902cf95c3ff44895ae95e9815ad64.png)

æ°é‡Œç±³Â·è´èµæ ¼åœ¨ [Unsplash](https://unsplash.com/s/photos/install?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

æ—¢ç„¶æˆ‘ä»¬å°†ä½¿ç”¨ BigQueryï¼Œä¸ºä»€ä¹ˆéœ€è¦å®‰è£…ä»»ä½•ä¸œè¥¿å‘¢ï¼Ÿä½ æ‰€éœ€è¦çš„åªæ˜¯ä¸€ä¸ª**æµè§ˆå™¨å’Œä¸€ä¸ªè°·æ­Œè´¦æˆ·**â€”â€”å“¦ï¼Œè¿˜æœ‰é¼ æ ‡å’Œé”®ç›˜ï¼Œä½ ä»ç„¶éœ€è¦åšä¸€äº›æ‰“å­—å·¥ä½œï¼

ç¬¬ä¸€æ­¥æ˜¯ç™»å½• [Google Colab](https://colab.research.google.com) ã€‚è¿™æ˜¯è°·æ­Œçš„ä¸€é¡¹å…è´¹æœåŠ¡ï¼Œä½ å¯ä»¥åœ¨äº‘ç«¯è¿è¡Œä¸€äº›ç¬”è®°æœ¬ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä» Kaggle è·å–æ•°æ®â€”â€”æ˜¯çš„ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªå¸æˆ·â€”â€”å¹¶è°ƒç”¨ Google Cloud APIs ä¸ BigQuery è¿›è¡Œäº¤äº’ã€‚

æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦ Kaggle API å¯†é’¥ã€‚æŸ¥çœ‹æ–‡æ¡£[çš„`Authentication`éƒ¨åˆ†ï¼Œè¿™é‡Œæ˜¯](https://www.kaggle.com/docs/api)å…³äºå¦‚ä½•è·å¾—å¸¦æœ‰å¯†é’¥çš„ json æ–‡ä»¶ã€‚æˆ‘ä»¬ä¼šå°†è¿™äº›ä¸Šä¼ åˆ° collab:

åœ¨ Colab ä¸­è¿è¡Œè¿™æ®µä»£ç åï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªå¼¹å‡ºæŒ‰é’®ï¼Œè¦æ±‚ä¸Šä¼ æ–‡ä»¶ã€‚ç¡®ä¿é€‰æ‹©ä» Kaggle ä¸‹è½½çš„`kaggle.json`æ–‡ä»¶ã€‚

å˜¿ï¼Œå¾ˆå¿«ï¼Œä½ å¯ä»¥ä½¿ç”¨ Kaggle å‘½ä»¤è¡Œç•Œé¢:

![](img/11af8b74839130080a4659d7feb7e1df.png)

ä½œè€…æˆªå›¾

æˆ‘ä»¬è¿˜éœ€è¦**å‘ Google Cloud** è®¤è¯æˆ‘ä»¬çš„ Google Colab ä¼šè¯ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ BigQueryï¼Œè¿™æ˜¯å¿…è¦çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œå·²ç»é¢„è£…äº†ä¸€ä¸ªè¶…çº§ç®€å•çš„åŠ©æ‰‹åº“:

è¯·æŒ‰ç…§å±å¹•ä¸Šçš„æŒ‡ç¤ºæ“ä½œ

å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨ä¸€äº› BigQuery ç¥å¥‡çš„å‡½æ•°å¹¶å¼•ç”¨æ­£ç¡®çš„é¡¹ç›® idï¼Œé‚£ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„:

> â—ï¸å¦‚æœä½ ä¸ç¡®å®šå¦‚ä½•åœ¨ BigQuery ä¸­åˆ›å»ºæ•°æ®é›†ï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚

å®‰è£…å®Œæˆï¼âœ…

# è·å–ä¸€äº›æ•°æ®

ç°åœ¨æˆ‘ä»¬åœ¨äº‘ç«¯æœ‰äº†ä¸€å°ç”µè„‘ï¼Œæ¥å…¥äº† Google Cloudï¼Œè¿˜æœ‰ Kaggle çš„ APIï¼Œä½†æ˜¯æˆ‘ä»¬**åœ¨ BigQuery é‡Œè¿˜æ˜¯æ²¡æœ‰æ•°æ®ã€‚**æˆ‘ä»¬å¦‚ä½•å°† Kaggle çš„æ•°æ®å¯¼å…¥ BigQueryï¼Ÿå½“ç„¶æ˜¯é€šè¿‡è°ƒç”¨ Kaggle APIã€‚ä¸‹é¢å‡ è¡Œä»£ç å°†ä¸‹è½½`titanic`æ•°æ®é›†ï¼Œå¹¶å°†å…¶ä½œä¸º csv æ–‡ä»¶ä¿å­˜åœ¨æˆ‘ä»¬çš„ Colab æœºå™¨ä¸Šã€‚æœ‰å…³æ•°æ®é›†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Kaggle ä¸Šçš„[ç»†èŠ‚ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Pandas çš„`to_gbq()`å°†æ–‡ä»¶ä½œä¸ºè¡¨æ ¼ä¸Šä¼ åˆ° BigQueryã€‚](https://www.kaggle.com/c/titanic/data)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`%%bigquery` ipython é­”æœ¯ç›´æ¥ä» Colab æŸ¥è¯¢ BigQueryã€‚

![](img/87b2a92bb401aa0af2e0f5d48e48f75c.png)

ä½œè€…æˆªå›¾

ä¸è¦å¿˜è®°**ä¹Ÿä¿å­˜æµ‹è¯•æ•°æ®**ï¼Œè¿™æ˜¯æˆ‘ä»¬å°†è¦åšçš„é¢„æµ‹:

# åˆ†å‰²æ•°æ®é›†

![](img/d7179b405d3f7e4b2fa49a53f52d020a.png)

ç…§ç‰‡ç”±[ä¹”Â·ç§‘æ©æ‹æ‘„â€”â€”å·¥ä½œå®¤åœ¨](https://unsplash.com/@jo_coenen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) [Unsplash](https://unsplash.com/s/photos/split?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šå¹²ç‡¥ 2.6

ä»»ä½•åƒæ ·çš„ ML ä¹¦ç±æˆ–è¯¾ç¨‹éƒ½ä¼šå‘Šè¯‰ä½ åº”è¯¥å°†æ•°æ®åˆ†æˆè®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†(ä½ ä¹Ÿå¯ä»¥ä¸ºè¶…å‚æ•°è°ƒæ•´åšä¸€ä¸ªè¯„ä¼°é›†)ã€‚ç”¨ Python åšåˆ°è¿™ä¸€ç‚¹å¾ˆå®¹æ˜“ã€‚ä½ æŠ“å– sklearnï¼Œç„¶ååšä¸€ä¸ª`train_test_split()`ï¼Œå®ƒç”šè‡³ä¿æŒä¸¤ä¸ªæ•°æ®é›†çš„ç±»æ ‡ç­¾åˆ†å¸ƒç›¸åŒã€‚ä¸ºäº†åœ¨ BigQuery ä¸­åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æŠ€å·§ï¼Œä½†ä¸è¦å¤ªå¤æ‚ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª**å¯é‡å¤çš„éšæœºæ’åº**ã€‚æˆ‘å·²ç»å†™äº†[å…³äºè¿™ä¸ª](/advanced-random-sampling-in-bigquery-sql-7d4483b580bb)ï¼Œä½†æ˜¯ä¸»è¦ç»“è®ºæ˜¯`FARM_FINGERPRINT`æ˜¯ä½ çš„æœ‹å‹ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªä¸åŒçš„ç§å­ï¼Œåœ¨æŠŠå®ƒä»¬ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œå…ˆæŠŠä½ çš„å­—ç¬¦ä¸²åŠ ç›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™ä½ æ•£åˆ—çš„æ¯ä¸ª id æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:

![](img/8a0e2be18b7fbf2b2b83e5d32f5b8f70.png)

ä½œè€…æˆªå›¾

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œæˆ‘ä»¬å¾—åˆ°ç›¸åŒçš„æ•£åˆ—ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸åŒçš„ salt å­—ç¬¦ä¸²æ¥å¾—åˆ°æ–°çš„æ•£åˆ—ã€‚è¿™å¯¹æˆ‘ä»¬çš„ä¹˜å®¢ç‚¹é¤æ¥è¯´å†å¥½ä¸è¿‡äº†ã€‚

â—ï¸å¦‚æœæ‚¨éœ€è¦å¤ä¹  BigQuery ä¸­çš„é‡‡æ ·ï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç« :

[](/advanced-random-sampling-in-bigquery-sql-7d4483b580bb)  

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æŒ‘é€‰ 80%çš„å¹¸å­˜ä¹˜å®¢å’Œ 80%çš„æ­»äº¡ä¹˜å®¢è¿›å…¥æˆ‘ä»¬çš„è®­ç»ƒé›†ã€‚å…¶ä»–äººéƒ½å°†åœ¨æµ‹è¯•é›†ä¸­ç»“æŸã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`PERCENTILE_CONT`åˆ†æåŠŸèƒ½æ¥å®ç°ã€‚è¿™ä¸ª**å°†æˆ‘ä»¬çš„æ•£åˆ—æ•´æ•°è½¬æ¢æˆç™¾åˆ†ä½æ•°**ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªç™¾åˆ†ä½æ•°å°äº 0.80ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ä½ æ˜¯å‰ 80%ä¹˜å®¢ä¸­çš„ä¸€å‘˜ã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤â€”â€”å¦‚æœæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œè¯·åœ¨è¯„è®ºä¸­æé—®:

![](img/505ee5f211a67c9b52ec10eae347006c.png)

ä½œè€…æˆªå›¾

æ„Ÿè§‰æ£€æŸ¥:110 / (110 + 439) â‰ˆ 0.2 âœ…

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ–°æ•°æ®é›†ä¿å­˜åˆ°ä¸¤ä¸ªåˆ†åŒºä¸­ï¼Œä¸€ä¸ªç”¨äºè®­ç»ƒï¼Œä¸€ä¸ªç”¨äºæµ‹è¯•:

> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º [BigQuery magic](https://googleapis.dev/python/bigquery/latest/magics.html#module-google.cloud.bigquery.magics.magics) ä½¿ç”¨`--destination_table`å‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æŒ‡å®šåˆ†åŒºèŒƒå›´ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [BigQuery Python SDK](https://googleapis.dev/python/bigquery/latest/generated/google.cloud.bigquery.job.QueryJob.html#google-cloud-bigquery-job-queryjob) å°†ç»“æœä¿å­˜ä¸ºè¡¨æ ¼ã€‚

`partition by`å­å¥æ˜¯ä¸€ä¸ªå·§å¦™çš„æŠ€å·§ï¼Œå®ƒå°†æˆ‘ä»¬çš„è®­ç»ƒé›†ä»æµ‹è¯•é›†ä¸­åˆ†ç¦»å‡ºæ¥å¹¶èŠ‚çœèµ„é‡‘ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ é€šè¿‡è¿‡æ»¤`isTrain`æ¥æŸ¥è¯¢è¿™ä¸ªè¡¨ï¼Œé‚£ä¹ˆ BigQuery ä¼šçŸ¥é“ä¸åŒåˆ†åŒºçš„ç¡®åˆ‡ä½ç½®ï¼Œå¹¶ä¸”ä½ åªéœ€è¦ä¸ºä½ é€‰æ‹©çš„åˆ†åŒºä»˜è´¹ã€‚æ‚¨å¯ä»¥é€šè¿‡è·³è½¬åˆ° BigQuery UI å¹¶æŸ¥çœ‹æŸ¥è¯¢å¤§å°ä¼°è®¡æ¥ç¡®è®¤è¿™ä¸€ç‚¹:

![](img/6e383e5d06cb9a7a7027e1fd976de93d.png)

æ³¨æ„å³ä¸Šè§’ä¸æ–­å˜åŒ–çš„ KiBs ä½œè€…æˆªå±

> ğŸ’°å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†ï¼Œè¿™ä¸ªæŠ€å·§å¯ä»¥è®©ä½ åœ¨è¾ƒå°çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œè€Œä¸éœ€è¦ä¸¤ä¸ªä¸åŒçš„è¡¨ï¼Œä»è€Œä¸ºä½ èŠ‚çœå¾ˆå¤šé’±ã€‚

# é€»è¾‘å›å½’

![](img/be15bd2655f56f06fb5251a8d39eda26.png)

è®­ç»ƒæ—¶é—´åˆ°äº†ï¼â€”[karst en wine geart](https://unsplash.com/@karsten116?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/training?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

ç°åœ¨æ˜¯æ—¶å€™è®­ç»ƒä¸€äº›æ¨¡å‹äº†ã€‚æˆ‘ä»¬å°†ä»è®­ç»ƒä¸€ä¸ªé€»è¾‘å›å½’æ¨¡å‹å¼€å§‹ï¼Œæˆ‘å°†å°½åŠ›è§£é‡Šæ‰€æœ‰çš„å‚æ•°ã€‚ç”±äºè¿™ä»ç„¶æ˜¯ BQï¼Œæˆ‘ä»¬**éœ€è¦ä¸€äº› SQL æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹å¯¹è±¡**:

ä¸‹é¢æ˜¯ä¸€æ­¥æ­¥å‘ç”Ÿçš„äº‹æƒ…:

*   æˆ‘ä»¬çš„æ¨¡å‹å°†è¢«ç§°ä¸º`ds.titanic_baseline`ã€‚è¯·æ³¨æ„ï¼Œè¿™çœ‹èµ·æ¥ä¸ä»»ä½•å…¶ä»–è¡¨åå®Œå…¨ä¸€æ ·
*   `OPTIONS`ä¼šå‘Šè¯‰ BQ åˆ›å»ºä»€ä¹ˆæ¨¡å‹ï¼Œæ ‡ç­¾æ˜¯ä»€ä¹ˆç­‰ã€‚
*   `SELECT`å°†å‘Šè¯‰ BQ ä»å“ªä¸ªæ•°æ®é›†è®­ç»ƒæ¨¡å‹ã€‚æˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯ä»å‡†å¤‡å¥½çš„è¡¨ä¸­é€‰æ‹©æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå‡å»`passengerid`ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå°†`isTrain`è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨è¯¥åˆ—ä¸Šåˆ†å‰²æˆ‘ä»¬çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

åœ¨`OPTIONS`é‡Œé¢å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…:

*   `MODEL_TYPE`å‘Šè¯‰ BQ ä½¿ç”¨ä»€ä¹ˆå‹å·ç³»åˆ—ã€‚è¿™å¯ä»¥æ˜¯é€»è¾‘å›å½’ã€çº¿æ€§å›å½’ã€k å‡å€¼èšç±»ã€æ—¶é—´åºåˆ—æ¨¡å‹ã€æå‡æ ‘ç”šè‡³ AutoMLã€‚[æ­¤å¤„é˜…è¯»æ›´å¤šå†…å®¹](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-e2e-journey)ã€‚
*   `INPUT_LABEL_COLS`æ˜¯åŒ…å«æˆ‘ä»¬æ ‡ç­¾çš„åˆ—çš„åˆ—è¡¨ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬è°å¹¸å­˜ï¼Œè°æ²¡æœ‰ã€‚
*   `DATA_SPLIT_METHOD`å’Œ`DATA_SPLIT_COLS`é½å¤´å¹¶è¿›ã€‚æˆ‘ä»¬æƒ³è‡ªå·±æ‹†åˆ†æ•°æ®ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨äº†`isTrain`åˆ—ã€‚
*   `EARLY_STOP`å¦‚æœæµ‹è¯•é›†(isTrain = 0)è¯¯å·®æ²¡æœ‰å‡å°‘ï¼Œå‘Šè¯‰ BQ åœæ­¢è®­ç»ƒã€‚
*   `L2_REG`æ˜¯æˆ‘ä»¬æ¨¡å‹çš„ L2 æ­£åˆ™åŒ–å‚æ•°ã€‚è¿™æœ‰åŠ©äºæˆ‘ä»¬ä¸è¿‡åº¦æ‹Ÿåˆæ•°æ®ã€‚éšæ„å°è¯•ä¸åŒçš„å€¼ï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„æ¨¡å‹ã€‚

è®­ç»ƒå®Œæ¨¡å‹åï¼Œæ‚¨å¯ä»¥**è¿›å…¥ BigQuery UI** å¹¶æ£€æŸ¥æ¨¡å‹è®­ç»ƒçš„æƒ…å†µ:

![](img/db7ce3297e7a91d12ef8a0ec0b700dde.png)

BigQuery UI æ¨¡å‹è®­ç»ƒâ€”ä½œè€…æˆªå±

> ä¸€å®šè¦å››å¤„çœ‹çœ‹ï¼Œå› ä¸ºé‚£é‡Œæœ‰ç›¸å½“å¤šçš„ä¿¡æ¯ï¼

# è‡£æœäº Kaggle

æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ¨¡å‹å’Œä¸€å¥—æµ‹è¯•è®¾å¤‡ï¼Œç°åœ¨æ˜¯**æ‰“åˆ†çš„æ—¶å€™äº†ï¼Œäº«å—æˆ‘ä»¬ Kaggle æäº¤çš„è£è€€**ã€‚

ä¸ºäº†ç»™æˆ‘ä»¬çš„æµ‹è¯•é›†æ‰“åˆ†ï¼Œæˆ‘ä»¬éœ€è¦`ML.PREDICT`æ–¹æ³•ã€‚è¿™å°†ä¸ºæ•°æ®é›†çš„æ¯ä¸€è¡Œæä¾›ä¸€ä¸ªç»“æ„æ•°ç»„ã€‚æ˜¯çš„ï¼Œæˆ‘çŸ¥é“**ç»“æ„æ•°ç»„**ï¼Œé‚£æ˜¯ä»€ä¹ˆé¬¼ä¸œè¥¿ï¼Œå¯¹å§ï¼Ÿ

è¿™æ˜¯ä¸ºå¤šç±»æ¨¡å‹è®¾è®¡çš„ï¼Œæ‰€ä»¥æ•°ç»„ä¸­æ¯ä¸ªæ ‡ç­¾æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæ ‡ç­¾ä½œä¸ºç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œé¢„æµ‹æ¦‚ç‡ä½œä¸ºç¬¬äºŒéƒ¨åˆ†ã€‚ä¸ºäº†è§£å¼€æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°ç»„åˆ—ä¸Šä½¿ç”¨`CROSS JOIN`å’Œ`UNNEST`:

è¯·åŠ¡å¿…é˜…è¯»ä¸Šé¢çš„è¯„è®ºï¼Œå› ä¸ºå®ƒä»¬è§£é‡Šäº†æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…

![](img/a479c97bd09a7054d983a214a2adf19c.png)

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šåœ¨æœ€åå¾—åˆ°ä¸€å †é¢„æµ‹çš„â€œé—®é¢˜â€â€”â€”ä½œè€…æˆªå›¾

Kaggle å¸Œæœ›æˆ‘ä»¬**æäº¤ä¸€ä¸ªåŒ…å«ä¸¤åˆ—çš„ csv æ–‡ä»¶**â€”â€”ä¸€åˆ—ç”¨äºä¹˜å®¢ idï¼Œä¸€åˆ—ç”¨äºé¢„æµ‹ç±»åˆ«(1 æˆ– 0)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é€‰æ‹©ä¸€ä¸ªé˜ˆå€¼ï¼Œæˆ‘ä½¿ç”¨ 0.4ï¼Œå¹¶å°† 1 åˆ†é…ç»™æ‰€æœ‰ä¹˜å®¢ï¼Œåˆ†é…ç»™é«˜äºè¯¥é˜ˆå€¼çš„æ‰€æœ‰ä¹˜å®¢ï¼Œå°† 0 åˆ†é…ç»™å…¶ä»–æ‰€æœ‰äººã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Python çš„ BigQuery å®¢æˆ·ç«¯ SDK æ¥å®Œæˆè¿™é¡¹å·¥ä½œ:

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ [%%bigquery é­”æ³•æ¥ä¿å­˜ç»“æœ](https://googleapis.dev/python/bigquery/2.0.0/magics.html)

å‰©ä¸‹çš„å°±æ˜¯æŠŠè¿™ä¸ªæ•°æ®å¸§ä¿å­˜ä¸º csv æ ¼å¼ï¼Œç„¶åä¸Šä¼ åˆ° Kaggle:

![](img/a96298b98a05d072f311566b362611e1.png)

ä½œè€…æˆªå›¾

ä»¥ä¸Šç»™äº†æˆ‘ä¸€ä¸ªæ‰å®çš„ 0.75 ä½œä¸ºæ¯”èµ›ä¸­çš„åˆ†æ•°ã€‚è¿™ä¸æ˜¯å¾ˆå¥½ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹ï¼

# è¶Šæ¥è¶ŠèŠ±å“¨

![](img/6fc13ab0fe5bc932f3fe57c51239b474.png)

åŠ å¸ƒé‡ŒåŸƒæ‹‰Â·å…‹è±å°”Â·é©¬é‡Œè¯ºåœ¨ [Unsplash](https://unsplash.com/s/photos/fancy?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

æœ¬æ•™ç¨‹åˆ°æ­¤ç»“æŸï¼Œä½†æ˜¯**æˆ‘é‚€è¯·æ‚¨å°è¯•**Google Cloud big query çš„æ›´å¤šç‰¹æ€§ã€‚ä¾‹å¦‚:

*   å¦‚æœæˆ‘ä»¬æŠŠ L2 æ­£åˆ™åŒ–å‚æ•°æ”¹æˆåˆ«çš„ä»€ä¹ˆå‘¢ï¼Ÿ
*   æˆ‘ä»¬èƒ½ä¸èƒ½ç”¨`TRANSFORM`ä»è¿™äº›æ ç›®ä¸­åˆ›é€ å‡ºæ›´å¤šçš„ç‰¹è‰²ï¼Œä¹Ÿè®¸å¹´é¾„åº”è¯¥åˆ†æ—¶æ®µï¼Œæˆ–è€…ç¥¨ä»·åº”è¯¥æœ‰æ‰€ä¸åŒï¼Ÿ([æ–‡æ¡£æ­¤å¤„](https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-preprocessing-functions))
*   å¦‚æœæˆ‘ä»¬ç”¨**åŠ©æ¨æ ‘** : `MODEL_TYPE='BOOSTED_TREE_CLASSIFIERâ€™`ä¼šæ€ä¹ˆæ ·ï¼Ÿ

å¯¹äºå…¶ä¸­çš„ä¸€äº›ä»£ç ï¼Œè¯·æŸ¥çœ‹ç”¨äºæœ¬æ–‡çš„[ç¬”è®°æœ¬ã€‚](https://github.com/niczky12/medium/blob/master/tech/bigquery/ML_with_Google_BigQuery_Kaggle_Titanic_end_to_end.ipynb)

> æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æœ¬æ–‡ï¼æˆ‘ä¸»è¦å†™çš„æ˜¯æ•°æ®ç§‘å­¦å·¥å…·å’Œ Juliaï¼Œæ‰€ä»¥å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·éšæ„è®¢é˜…ï¼

[](/loops-in-bigquery-db137e128d2d)  [](/load-files-faster-into-bigquery-94355c4c086a)  [](/advanced-random-sampling-in-bigquery-sql-7d4483b580bb) 