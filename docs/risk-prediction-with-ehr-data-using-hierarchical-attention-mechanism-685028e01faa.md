# åŸºäºŽåˆ†å±‚æ³¨æ„æœºåˆ¶çš„ EHR æ•°æ®é£Žé™©é¢„æµ‹

> åŽŸæ–‡ï¼š<https://towardsdatascience.com/risk-prediction-with-ehr-data-using-hierarchical-attention-mechanism-685028e01faa>

## LSAN åŸºæœ¬æŒ‡å—:ç”¨åˆ†çº§æ³¨æ„å»ºæ¨¡é•¿æœŸä¾èµ–å’ŒçŸ­æœŸå…³è”

![](img/1e6908a176bdec207ed5550692187c0d.png)

å›¾ç‰‡ç”± [Jukka Niittymaa](https://pixabay.com/users/jniittymaa0-701650/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1185076) æ¥è‡ª [Pixabay](https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1185076)

ç”µå­å¥åº·è®°å½•(EHR)æ˜¯å…¨é¢çš„åŽ†å²å¥åº·è®°å½•ï¼ŒåŒ…å«æ‚£è€…å°±åŒ»æ—¶çš„ç—‡çŠ¶ã€‚EHR æ•°æ®å…·æœ‰ä¸¤çº§å±‚æ¬¡ç»“æž„ï¼Œç”±ä¸€ç»„æŒ‰æ—¶é—´é¡ºåºæŽ’åˆ—çš„å°±è¯Šç»„æˆï¼Œåœ¨æ¯æ¬¡å°±è¯Šä¸­ï¼Œæœ‰ä¸€ç»„æ— åºçš„è¯Šæ–­ä»£ç ã€‚è¯Šæ–­ä»£ç å¯ä»¥å±žäºŽ ICD-9 æˆ– ICD-10 æ ¼å¼ï¼Œè¡¨ç¤ºæŸç§ç–¾ç—…çš„ç—‡çŠ¶ã€‚

é£Žé™©é¢„æµ‹æ˜¯åŒ»ç–—ä¿å¥è¡Œä¸šä¸­æœ€æµè¡Œçš„é—®é¢˜é™ˆè¿°ä¹‹ä¸€ã€‚é£Žé™©é¢„æµ‹æ˜¯æŒ‡å¯¹æœªæ¥æŸä¸€ç–¾ç—…é«˜é£Žé™©æˆå‘˜çš„é¢„æµ‹ã€‚çŽ°æœ‰æ–¹æ³•ä¾§é‡äºŽå¯¹æ—¶é—´è®¿é—®è¿›è¡Œå»ºæ¨¡ï¼Œè€Œå¿½ç•¥äº†å¯¹è®¿é—®ä¸­çš„è¯Šæ–­ä»£ç è¿›è¡Œå»ºæ¨¡çš„é‡è¦æ€§ï¼Œå¹¶ä¸”è®¿é—®ä¸­å¤§é‡ä¸Žä»»åŠ¡æ— å…³çš„ä¿¡æ¯é€šå¸¸å¯¼è‡´çŽ°æœ‰æ–¹æ³•çš„æ€§èƒ½ä¸ä»¤äººæ»¡æ„ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•é€šè¿‡ä¿æŒé•¿æœŸä¾èµ–æ€§å’ŒçŸ­æœŸç›¸å…³æ€§æ¥æ‰§è¡Œé£Žé™©é¢„æµ‹ã€‚

# LSAN ç®€ä»‹:

> **å‚è€ƒè®ºæ–‡:**[LSANâ€”â€”å¯¹é£Žé™©é¢„æµ‹çš„é•¿æœŸä¾èµ–å’ŒçŸ­æœŸç›¸å…³æ€§è¿›è¡Œåˆ†å±‚å…³æ³¨å»ºæ¨¡](https://dl.acm.org/doi/abs/10.1145/3340531.3411864)

EHR æ•°æ®ç”±ä¸¤çº§å±‚æ¬¡ç»“æž„ç»„æˆ:å°±è¯Šå±‚æ¬¡ç»“æž„å’Œæ¯æ¬¡å°±è¯Šçš„è¯Šæ–­ä»£ç å±‚æ¬¡ç»“æž„ã€‚

![](img/199f4cc2d073b04be124017ab3b84b83.png)

(æ¥æº)ï¼ŒEHR çš„ç­‰çº§è¡¨ç¤ºå›¾

æœ¬æ–‡æå‡ºäº†ä¸€ä¸ª LSAN æ·±åº¦ç¥žç»ç½‘ç»œæ¨¡åž‹æ¥æ¨¡æ‹Ÿ EHR æ•°æ®çš„å±‚æ¬¡ç»“æž„ã€‚

# ä»»åŠ¡:

ä»»åŠ¡æ˜¯ä½¿ç”¨çºµå‘ EHR æ•°æ®ð‘¯ âˆˆ Rð‘šÃ—n.è®¡ç®—èƒ½å¤Ÿé¢„æµ‹æ‚£è€…â€˜pâ€™åœ¨æœªæ¥å¯èƒ½å‘ç”Ÿçš„æŸäº›ç–¾ç—…çš„å‡½æ•° fã€‚è¯¥å‡½æ•°çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä»Žæ‚£è€…æ•°æ® h ä¸­æå–éšè—çš„ç–¾ç—…è¿›å±•ä¿¡æ¯ï¼Œå¹¶å¤„ç†å™ªå£°ä¿¡æ¯çš„é—®é¢˜ã€‚

## è¾“å…¥ç¬¦å·:

å¯¹äºŽæ¯ä¸ªç—…äºº`â€˜pâ€™`ï¼Œå®ƒæœŸæœ›åŽ†å²è¯Šæ–­ç»“æžœä½œä¸ºä¸€ä¸ªé¡ºåºåˆ—è¡¨ð‘¯=ã€ð’‰1ï¼Œð’‰2,â€¦ï¼Œð’‰ð‘›ã€‘ï¼Œå…¶ä¸­ð’‰ð‘–æ˜¯ð‘–-the å°±è¯Šçš„è¯Šæ–­ç»“æžœï¼Œn æ˜¯å°±è¯Šæ¬¡æ•°ã€‚

æ¯ä¸ªå°±è¯Šè¯Šæ–­ç»“æžœç”± ICD-9 ä»£ç çš„å­é›†`**ð‘ª = {ð’„1,ð’„2,â€¦,ð’„ð‘š}**`ç»„æˆï¼Œå…¶ä¸­ð‘šæ˜¯æ•°æ®é›†ä¸­å”¯ä¸€è¯Šæ–­ä»£ç çš„æ•°é‡ã€‚

![](img/08ca385af272ae46d3eeefe2184acef3.png)

æ­¤å¤„`**hiCj=1**`å¦‚æžœå°±è¯Šçš„è¯Šæ–­ç»“æžœåŒ…å« cj è¯Šæ–­ä»£ç ï¼Œå¦åˆ™`**hiCj=0**`

# **åˆ›æ„:**

LSAN æ˜¯ä¸€ç§ç«¯åˆ°ç«¯æ¨¡åž‹ï¼Œ

1.  **HAM** (åœ¨è¯Šæ–­ä»£ç å±‚æ¬¡ä¸­):å®ƒç”¨è®¾è®¡çš„è¯Šæ–­ä»£ç çº§æ³¨æ„åŠ›å­¦ä¹ è®¿é—®åµŒå…¥ã€‚
2.  TAM (æ—¶é—´èšåˆæ¨¡å—):å®ƒæ•èŽ·è®¿é—®ä¹‹é—´çš„é•¿æœŸä¾èµ–æ€§å’ŒçŸ­æœŸç›¸å…³æ€§ã€‚
3.  **HAM** (åœ¨å°±è¯Šå±‚çº§ä¸­):TAM çš„è¾“å‡ºç”¨äºŽé€šè¿‡ HAM ä¸­çš„å°±è¯Šçº§æ³¨æ„åŠ›æ¥å­¦ä¹ æœ€ç»ˆçš„ç»¼åˆæ‚£è€…è¡¨çŽ°ã€‚
4.  **åˆ†ç±»å™¨**:ç»¼åˆè¡¨ç¤ºç”¨äºŽé¢„æµ‹

![](img/4b46c75148209c62d1d5f08741b06f18.png)

([æ¥æº](https://dl.acm.org/doi/10.1145/3340531.3411864))ï¼ŒLSAN æž¶æž„

HAM çš„åŠŸèƒ½æ˜¯åˆ©ç”¨ HER çš„åˆ†å±‚è¡¨ç¤ºï¼Œå¹¶ä¸”å®ƒå…·æœ‰æ³¨æ„æœºåˆ¶æ¥åŽ»é™¤ EHR æ•°æ®ä¸­çš„å™ªå£°ã€‚

## **HAM(åœ¨è¯Šæ–­ä»£ç å±‚çº§ä¸­):**

## **ç”¨é€”:**

åœ¨è¯Šæ–­ä»£ç çš„å±‚æ¬¡ç»“æž„ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å‡å°‘å™ªå£°ä¿¡æ¯ï¼Œä»¥ä¾¿ä¸ºæ¯æ¬¡è®¿é—®å­¦ä¹ æ›´å¥½çš„åµŒå…¥ã€‚åœ¨æ¯æ¬¡å°±è¯Šä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸Žç›®æ ‡ç±»åˆ«æ— å…³çš„è¯Šæ–­ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†æ¯æ¬¡å°±è¯Šä¸­è¯Šæ–­ä»£ç çš„é‡è¦æ€§ã€‚

HAM åˆ©ç”¨åˆ†çº§æ³¨æ„æœºåˆ¶æ¥æ›´åŠ æ³¨æ„ä¸Žæˆ‘ä»¬çš„ç›®æ ‡ç–¾ç—…ç›¸å…³çš„è¯Šæ–­ä»£ç ï¼Œè€Œè¾ƒå°‘æ³¨æ„å…¶ä»–ä»£ç ã€‚

**å®žæ–½:**

1.  ç”±äºŽð‘¯ âˆˆ R^(m*n)æ˜¯ä¸€ä¸ªç¨€ç–çŸ©é˜µï¼Œä¸é€‚åˆè¡¨ç¤ºå­¦ä¹ ï¼Œæ‰€ä»¥æƒ³æ³•æ˜¯å­¦ä¹ æ¯ä¸ªä»£ç çš„å¯†é›†åµŒå…¥
2.  HAM é¦–å…ˆé€šè¿‡ä¸€å±‚å‰é¦ˆç½‘ç»œ FFN1 å°†æ¯ä¸ªè¯Šæ–­ç ð’„ð‘–ç¼–ç æˆå¯†é›†åµŒå…¥çš„ð’†ð‘– âˆˆ Rð‘‘
3.  HAM é¦–å…ˆé€šè¿‡ 1 å±‚å‰é¦ˆç½‘ç»œ FFN1 `ð’†ð‘– = FFN1 (ð’„ð‘–) = ReLU(ð‘¾1ð’„ð‘– + ð’ƒ1), where ð‘¾1 âˆˆ Rð‘‘Ã—ð‘š, ð’ƒ1 âˆˆ R^d`å°†æ¯ä¸ªè¯Šæ–­ç ð’„ð‘–ç¼–ç æˆå¯†é›†åµŒå…¥çš„ð’†ð‘– âˆˆ Rð‘‘
4.  ð‘¬ = [ð’†1,â€¦ï¼Œð’†ð‘š] âˆˆ R^(ð‘‘Ã—m)ï¼Œm ä¸ªå”¯ä¸€è¯Šæ–­ç çš„ d ç»´ç¨ å¯†è¡¨ç¤º
5.  å¯¹äºŽð‘–-th è®¿é—®ï¼Œæˆ‘ä»¬èŽ·å¾—ä¸€ä¸ªå¯†é›†åµŒå…¥é›†ð‘ºð‘– = [ð’”1,â€¦,ð’”ð‘š]å…¶ä¸­ð’”ð‘— = ð’†ð‘—å¦‚æžœð’‰ð‘–ð‘— = 1 ä»¥åæ˜ æŸç§ç—‡çŠ¶æˆ–ç–¾ç—…çš„å­˜åœ¨ï¼Œå¦åˆ™ð’”ð‘— = 0
6.  å°½ç®¡å¦‚æ­¤ï¼Œð‘ºð‘– âˆˆ Rð‘‘Ã—m å¯¹äºŽå­¦ä¹ è¿‡ç¨‹æ¥è¯´æ˜¯å¤šä½™çš„ã€‚çŽ°åœ¨å“ˆå§†æå–æ¯æ¬¡è®¿é—®çš„æ½œåœ¨ä¿¡æ¯ï¼Œå¹¶å°†å…¶è¡¨ç¤ºä¸º`**ð’‰Â¯ð‘– âˆˆ Rð‘‘**`
7.  ä¸ºäº†æå–æ½œåœ¨çš„è®¿é—®ä¿¡æ¯ï¼ŒHAM ä½¿ç”¨äº†ä¸€ä¸ªä¸‰å±‚å‰é¦ˆç½‘ç»œ(FFN_2)ã€‚FFN_2 å­¦ä¹ æ¯ä¸ªå¯†é›†åµŒå…¥ð‘ºð‘–çš„æ³¨æ„åŠ›æƒé‡å¹¶ä¸€èµ·å‡ºå¸­å®ƒä»¬ã€‚
8.  æˆ‘ä»¬å¾—åˆ°æ¯ä¸ªè¯Šæ–­ä»£ç çš„æ³¨æ„åŠ›å¾—åˆ†ð›¼ð‘–âˆˆr(ð›¼ð‘–= ff N2(ð’”ð‘–))ï¼Œå¦‚æžœð’”ð‘– = 0ï¼Œæˆ‘ä»¬è®¾ç½®ð›¼ð‘–=âˆžã€‚ç”¨ softmax: `**ð‘Žð‘– = exp(ð›¼ð‘–)/( Î£ð‘—=1tom exp(ð›¼ð‘—) )**`å½’ä¸€åŒ–å…³æ³¨åº¦ï¼Œè¿™é‡Œð‘Žð‘–æ˜¯å½’ä¸€åŒ–æƒé‡
9.  çŽ°åœ¨ï¼Œæˆ‘ä»¬ä¸ºð‘–-th å°±è¯Š`**(ð’‰Â¯ð‘– = Î£ð‘–=(1 to m) ð‘Žð‘– Â· ð’”ð‘–).**`èŽ·å¾—äº†å•ä¸ªåµŒå…¥ð’‰ ð‘–ã€‚ç»“æžœï¼Œåœ¨è¯Šæ–­ä»£ç çš„å±‚çº§ä¸­ï¼Œæˆ‘ä»¬èŽ·å¾—äº†æ‚£è€…â€˜pâ€™çš„ä¸€ç»„å…³æ³¨ç‰¹å¾`**ð‘¯Â¯ = [ð’‰Â¯1,â€¦, ð’‰Â¯ð‘›] âˆˆ Rð‘‘Ã—ð‘›**`ã€‚

## **TAM(åœ¨è¯Šæ–­ä»£ç å±‚çº§ä¸­):**

## **ç”¨é€”:**

TAM å°†è®¿é—®åµŒå…¥ä¸Žæ¥è‡ªå…¨å±€å’Œæ—¶æ€ç»“æž„çš„ä¸¤ç§æ—¶æ€ä¿¡æ¯èšåˆåœ¨ä¸€èµ·ã€‚å½“æ‰€æœ‰è®¿é—®çš„ç‰¹å¾è¢«æ”¾å…¥ TAM æ—¶ï¼Œ

1.  å®ƒé€šè¿‡ **Transformer** å¯¹å…¨çƒç»“æž„ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Œä¾‹å¦‚åœ¨æ‚£è€…çš„æ•´ä¸ªåŒ»ç–—æ—…ç¨‹ä¸­ï¼Œæ¯æ¬¡å°±è¯Šå¦‚ä½•ä¸Žå…¶ä»–å°±è¯Šç›¸å…³è”ã€‚
2.  é€šè¿‡**å·ç§¯å±‚**åœ¨æœ¬åœ°ç»“æž„ä¸­è¿›è¡ŒçŸ­æœŸå…³è”ï¼Œä¾‹å¦‚æ¯ä¸ªè®¿é—®å¦‚ä½•åœ¨çŸ­æ—¶é—´å†…ä¸Žå…¶ä»–è®¿é—®ç›¸å…³è”ã€‚

**å®žæ–½:**

1.  **TAM é€šè¿‡å·ç§¯è¿›è¡ŒçŸ­æœŸç›¸å…³æ€§å»ºæ¨¡:**å®ƒè¿‡æ»¤æŽ‰æ¥è‡ªæ— å…³è¯Šæ–­ä»£ç çš„å™ªå£°ï¼Œæå–æ¯ä¸ªé˜¶æ®µä¸­ç›¸å…³çš„ç–¾ç—…è¿›å±•ä¿¡æ¯ï¼Œç”¨äºŽæ—¶é—´èšåˆ

**2ã€‚TAM åœ¨å˜åŽ‹å™¨é•¿æœŸä¾èµ–å…³ç³»å»ºæ¨¡ä¸­:**

a.Transformer å¹¶è¡Œå¤„ç†æ‰€æœ‰çš„è®¿é—®åŠŸèƒ½ï¼Œä¸ä¼šæ¨¡ç³Šæ¯ä¸ªåŠŸèƒ½çš„ç»†èŠ‚

b.æˆ‘ä»¬åœ¨ Transformer ä¸­ä½¿ç”¨å¤šå¤´è‡ªå…³æ³¨æœºåˆ¶è¿›è¡Œç‰¹å¾å…³æ³¨ï¼ŒTAM ä¸­çš„ Transformer ç¼–ç å™¨å…·æœ‰ð‘™å±‚ï¼Œå…¶ä¸­æ¯å±‚ä¸­çš„è®¡ç®—æ˜¯ç›¸åŒçš„

c.å°†ä½ç½®ç¼–ç æ·»åŠ åˆ°ð‘–-th è¾“å…¥è®¿é—®ä¸­ï¼Œð’‰ ð‘¡ ð‘– = ð’‰ ð‘– + ð’•Iï¼Œå…¶ä¸­ð’•ð‘–æ˜¯ä½ç½®ç¼–ç 

d.æ¯å±‚å˜åŽ‹å™¨éƒ½æœ‰'â„Ž'å¤´ã€

è¿™ä¸¤ä¸ªæ—¶é—´ä¿¡æ¯éƒ½æœ‰åˆ©äºŽå­¦ä¹ ç‰¹å¾çš„é²æ£’æ€§ï¼Œå› æ­¤æˆ‘ä»¬è¿žæŽ¥ð’‰ ð‘” ð‘–å’Œð’‰ ð‘™ ð‘–ä»¥èŽ·å¾—ç”¨äºŽé£Žé™©é¢„æµ‹çš„ç‰¹å¾ð’‰ð‘– âˆˆ R2ð‘‘ï¼Œ

> ð’‰ð‘–=ð’‰ð‘™ð‘–concate(ð’‰ð‘”ð‘–)

æœ€åŽï¼ŒTAM è¾“å‡ºä¸€ä¸ªçŸ©é˜µð‘¯ = [ð’‰~1,â€¦ï¼Œð’‰~ð‘›] âˆˆ R2ð‘‘Ã—n

## **ç«è…¿(æŒ‰æ‹œè®¿å±‚æ¬¡):**

## **ç”¨é€”:**

åœ¨è®¿é—®å±‚æ¬¡ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ³¨æ„è®¿é—®ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å®ƒæ•æ‰äº†ç–¾ç—…çš„æ—¶é—´æ¨¡å¼ã€‚é€šè¿‡æå–ç›¸é‚»è®¿é—®ä¹‹é—´çš„å±€éƒ¨æ—¶é—´ç›¸å…³æ€§å¹¶åˆ©ç”¨é•¿æœŸç›¸å…³æ€§ä¿¡æ¯æ¥æ»¤é™¤å™ªå£°ã€‚

å®ƒä¾§é‡äºŽä»Žæ‰€æœ‰è®¿é—®ä¸­æå–æ•´ä½“è¯­ä¹‰ã€‚

**å®žæ–½:**

1.  ç±»ä¼¼äºŽè¯Šæ–­ä»£ç å±‚æ¬¡ä¸­çš„ HAMï¼Œå®ƒé¦–å…ˆé‡‡ç”¨ 3 å±‚å‰é¦ˆç½‘ç»œ FFN4 æ¥å­¦ä¹ æ³¨æ„åŠ›åˆ†æ•°ð›½ð‘– âˆˆ Rï¼Œ`**ð›½ð‘– = FFN4 ( ð’‰ð‘–).**`
2.  ç„¶åŽï¼Œæˆ‘ä»¬ç”¨ softmax å‡½æ•°`**bð‘– = exp(ð›½ð‘–)/( Î£ð‘— =1m exp(ð›½ð‘—)**`å¾—åˆ°å½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡ð‘ð‘– âˆˆ R
3.  é£Žé™©é¢„æµ‹çš„ç»¼åˆç‰¹å¾ð’™ âˆˆ R2ð‘‘é€šè¿‡æ³¨æ„æœºåˆ¶å­¦ä¹ ï¼Œå…¶ä¸­ `**ð’™ = Î£ð‘–=1n (ð‘ð‘– Â· ð’‰~ð‘–)**`

## **åˆ†ç±»å™¨:**

1.  æœ€åŽï¼Œæˆ‘ä»¬åˆ©ç”¨ð’™è¿›è¡Œé£Žé™©é¢„æµ‹ï¼Œð‘¦Ë† = ðœŽ(ð’˜Tð’™ + ð‘)ï¼Œå…¶ä¸­ð’˜ âˆˆ R2d å’Œ b âˆˆ R
2.  å¯¹äºŽè®­ç»ƒé›† tï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒå…ƒäº¤å‰ç†µæŸå¤± l æ¥è®­ç»ƒæ¨¡åž‹ï¼Œå¹¶èŽ·å¾—å­¦ä¹ å‚æ•°ðœ½

# ç»“è®º:

LSAN æž¶æž„æ•èŽ·è®¿é—®ä¹‹é—´çš„é•¿æœŸä¾èµ–æ€§å’ŒçŸ­æœŸç›¸å…³æ€§ã€‚æ ¹æ®è®ºæ–‡ä½œè€…è¿›è¡Œçš„å®žéªŒï¼ŒLSAN æ–¹æ³•çš„æ€§èƒ½ç›¸å¯¹ä¼˜äºŽæµ…å±‚æ–¹æ³•(SVMã€çº¿æ€§å›žå½’ç­‰)æˆ– RNN/RNN+æ³¨æ„åŠ›æ¨¡åž‹ã€‚

![](img/de43fea0c835ac47e036b07472d67f75.png)

([æ¥æº](https://dl.acm.org/doi/10.1145/3340531.3411864))ï¼Œä¸åŒ EHR æ•°æ®é›†ä¸Šçš„é£Žé™©é¢„æµ‹æ€§èƒ½æ¯”è¾ƒ

# å‚è€ƒèµ„æ–™:

[1] LSAN è®ºæ–‡(2020 å¹´ 10 æœˆ 19 æ—¥):[https://dl.acm.org/doi/10.1145/3340531.3411864](https://dl.acm.org/doi/10.1145/3340531.3411864)

> æ„Ÿè°¢æ‚¨çš„é˜…è¯»