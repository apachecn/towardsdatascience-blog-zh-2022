# ä½ åº”è¯¥çŸ¥é“çš„ 3 ä¸ªä¸å¸¸è§çš„ç†ŠçŒ«æŠŠæˆ

> åŸæ–‡ï¼š<https://towardsdatascience.com/3-not-so-common-pandas-tricks-you-should-know-b26cc7536291>

## å……åˆ†åˆ©ç”¨ç†ŠçŒ«

![](img/5e7998c570b99b6b22ec64048c4c29c9.png)

[çº¦ä¹¦äºšÂ·é’Ÿ](https://unsplash.com/@joshuachun?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/s/photos/style?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

å¦‚æœä½ æ­£åœ¨è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¸€å®šå¬è¯´è¿‡æˆ–ç”¨è¿‡ç†ŠçŒ«ã€‚å› æ­¤ï¼Œæˆ‘è·³è¿‡äº†è°ˆè®ºå¤§ç†ŠçŒ«æœ‰å¤šæ£’çš„éƒ¨åˆ†ã€‚ğŸ˜Š

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¾‹å­å±•ç¤ºä¸€äº›ä¸å¸¸ç”¨çš„ç†ŠçŒ«åŠŸèƒ½ã€‚åœ¨æˆ‘ä¸‰å¹´çš„ç†ŠçŒ«ä¹‹æ—…ä¸­ï¼Œæˆ‘å¹¶æ²¡æœ‰ç»å¸¸é‡åˆ°å®ƒä»¬ã€‚

å­¦ä¹ ç†ŠçŒ«æˆ–è€…å…¶ä»–è½¯ä»¶å·¥å…·çš„æœ€å¥½æ–¹æ³•æ˜¯ç»ƒä¹ ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ ·æœ¬æ•°æ®æ¡†æ¶ã€‚

```
import numpy as np
import pandas as pddf = pd.DataFrame({

   "date": pd.date_range(start="2021-11-20", periods=100, freq="D"),
   "class": ["A","B","C","D"] * 25,
   "amount": np.random.randint(10, 100, size=100)})df.head()
```

![](img/9df150c0ddc2786c1c8903bb28bc03f1.png)

df çš„å‰ 5 è¡Œ(å›¾ç‰‡ç”±ä½œè€…æä¾›)

æˆ‘ä»¬æœ‰ä¸€ä¸ª 3 åˆ— 100 è¡Œçš„æ•°æ®å¸§ã€‚date åˆ—åŒ…å« 100 ä¸ªè¿ç»­çš„æ—¥æœŸï¼Œclass åˆ—åŒ…å« 4 ä¸ªä¸ object æ•°æ®ç±»å‹ä¸€èµ·å­˜å‚¨çš„ä¸åŒå€¼ï¼Œamount åˆ—åŒ…å« 10 åˆ° 100 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚

## 1.è‡³ _ æœŸé—´

æˆ‘ä»¬ä½¿ç”¨å…·æœ‰è®¸å¤šä¸åŒé—´éš”æˆ–å‘¨æœŸçš„æ—¥æœŸï¼Œä¾‹å¦‚æ—¥ã€å‘¨ã€æœˆã€å­£åº¦ç­‰ç­‰ã€‚ä½¿ç”¨å“ªä¸€ç§å–å†³äºæ‰‹å¤´çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨æ”¶å…¥ä»ªè¡¨æ¿ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æ˜¾ç¤ºæœˆæ”¶å…¥æˆ–å­£åº¦æ”¶å…¥ã€‚

åœ¨ Pandas ä¸­ï¼Œæ“ä½œæ—¥æœŸçš„å‡½æ•°åœ¨ dt è®¿é—®å™¨ä¸‹å¯ç”¨ã€‚to_period å‡½æ•°å…è®¸å°†æ—¥æœŸè½¬æ¢ä¸ºç‰¹å®šçš„æ—¶é—´é—´éš”ã€‚æˆ‘ç»å¸¸ä½¿ç”¨çš„å‘¨æœŸæ˜¯æœˆå’Œå­£åº¦ã€‚

month æ–¹æ³•ä»…è¿”å›æœˆä»½ï¼Œè¿™åœ¨è®¸å¤šæƒ…å†µä¸‹æ²¡æœ‰ç”¨ï¼Œä¾‹å¦‚æŠ¥å‘Šå†å²æ”¶å…¥ã€‚æˆ‘ä»¬éœ€è¦èƒ½å¤ŸåŒºåˆ† 2020 å¹´ 12 æœˆå’Œ 2021 å¹´ 12 æœˆã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ to_period å‡½æ•°ä¸­ä½¿ç”¨â€œMâ€å¥ç‚¹æ¥å®ç°ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€œQâ€æå–å­£åº¦ä¿¡æ¯ã€‚

è®©æˆ‘ä»¬ä¸ºå¹´-æœˆå’Œå­£åº¦åˆ›å»ºæ–°çš„åˆ—ã€‚

```
df["month"] = df["date"].dt.to_period("M")
df["quarter"] = df["date"].dt.to_period("Q")df.head()
```

![](img/27ea62bf6f52175ed4a28cf9405a5fbc.png)

df çš„å‰ 5 è¡Œ(å›¾ç‰‡ç”±ä½œè€…æä¾›)

è®©æˆ‘ä»¬ä¹Ÿæ£€æŸ¥ä¸€ä¸‹æ•°æ®æ¡†æ¶ä¸­ä¸åŒçš„å¹´-æœˆå’Œå­£åº¦å€¼ã€‚

```
df["month"].value_counts()**# output**
2021-12    31
2022-01    31
2022-02    27
2021-11    11
Freq: M, Name: month, dtype: int64--------------------------
df["quarter"].value_counts()**# output**
2022Q1    58
2021Q4    42
Freq: Q-DEC, Name: quarter, dtype: int64
```

## 2.ç´¯è®¡å’Œåˆ†ç»„

ç´¯ç§¯æ˜¯ç†ŠçŒ«éå¸¸æœ‰ç”¨çš„åŠŸèƒ½ã€‚å®ƒè®¡ç®—åˆ—ä¸­å€¼çš„ç´¯ç§¯å’Œã€‚æˆ‘ä»¬é€šå¸¸æ˜¯è¿™æ ·ä½¿ç”¨å®ƒçš„:

```
df["cumulative_sum"] = df["amount"].cumsum()df.head()
```

![](img/aa95a3eb78745373c24a1d0f6dc2be35.png)

df çš„å‰ 5 è¡Œ(å›¾ç‰‡ç”±ä½œè€…æä¾›)

ç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°äº†â€œé‡‘é¢â€åˆ—ä¸­å€¼çš„ç´¯ç§¯å’Œã€‚ä½†æ˜¯ï¼Œå®ƒä¸è€ƒè™‘ç±»ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ†åˆ«è®¡ç®—ä¸åŒç±»åˆ«çš„ç´¯è®¡å’Œã€‚

è°¢å¤©è°¢åœ°ï¼Œç†ŠçŒ«è®©è¿™ä¸ªä»»åŠ¡å˜å¾—éå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦æŒ‰ç±»åˆ—å¯¹è¡Œè¿›è¡Œåˆ†ç»„ï¼Œç„¶ååº”ç”¨ cumsum å‡½æ•°ã€‚

```
df["class_cum_sum"] = df.groupby("class")["amount"].cumsum()
```

è®©æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹ a ç­çš„æˆç»©ã€‚

```
df[df["class"]=="A"].head()
```

![](img/12508061cf8e2133d3280db0ef38f059.png)

(å›¾ç‰‡ç”±ä½œè€…æä¾›)

â€œç±»ç´¯ç§¯å’Œâ€åˆ—åŒ…å«ä¸ºæ¯ä¸ªç±»å•ç‹¬è®¡ç®—çš„ç´¯ç§¯å’Œå€¼ã€‚

## 3.ç±»åˆ«æ•°æ®ç±»å‹

æˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†åˆ†ç±»æ•°æ®ï¼Œè¿™äº›æ•°æ®å…·æœ‰æœ‰é™çš„ã€é€šå¸¸æ˜¯å›ºå®šæ•°é‡çš„å¯èƒ½å€¼ã€‚åœ¨æˆ‘ä»¬çš„æ•°æ®æ¡†æ¶ä¸­ï¼Œclass åˆ—æ˜¯ä¸€ä¸ªå…·æœ‰ 4 ä¸ªä¸åŒå€¼çš„åˆ†ç±»å˜é‡:Aã€Bã€Cã€dã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åˆ—çš„æ•°æ®ç±»å‹å˜ä¸ºâ€œobjectâ€ã€‚

```
df.dtypes**# output**
date              datetime64[ns]
class                     object
amount                     int64
month                  period[M]
quarter            period[Q-DEC]
cumulative_sum             int64
class_cum_sum              int64
```

Pandas è¿˜æœ‰ä¸€ä¸ªâ€œcategoryâ€æ•°æ®ç±»å‹ï¼Œå®ƒæ¶ˆè€—çš„å†…å­˜æ¯” object æ•°æ®ç±»å‹å°‘å¾—å¤šã€‚å› æ­¤ï¼Œæœ€å¥½å°½å¯èƒ½ä½¿ç”¨ category æ•°æ®ç±»å‹ã€‚

è®©æˆ‘ä»¬å¤åˆ¶ class åˆ—ï¼Œä½†æ˜¯ä½¿ç”¨â€œcategoryâ€æ•°æ®ç±»å‹ã€‚

```
df["class_category"] = df["class"].astype("category")df.dtypes**# output**
date              datetime64[ns]
class                     object
amount                     int64
month                  period[M]
quarter            period[Q-DEC]
cumulative_sum             int64
class_cum_sum              int64
class_category          category
dtype: object
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥æ¯”è¾ƒ class å’Œ class_category åˆ—çš„å†…å­˜æ¶ˆè€—ã€‚

```
df.memory_usage()**# output**
Index             128
date              800
class             800
amount            800
month             800
quarter           800
cumulative_sum    800
class_cum_sum     800
class_category    304
dtype: int64
```

class_category åˆ—æ¶ˆè€—çš„å†…å­˜ä¸åˆ° class åˆ—çš„ä¸€åŠã€‚ç›¸å·® 496 å­—èŠ‚ï¼Œä¸ç®—å¤šã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å¤„ç†å¤§å‹æ•°æ®é›†æ—¶ï¼Œè¿™ç§å·®å¼‚è‚¯å®šä¼šå¾ˆé‡è¦ã€‚

*ä½ å¯ä»¥æˆä¸º* [*åª’ä»‹ä¼šå‘˜*](https://sonery.medium.com/membership) *è§£é”æˆ‘çš„å…¨éƒ¨å†™ä½œæƒé™ï¼Œå¤–åŠ å…¶ä½™åª’ä»‹ã€‚å¦‚æœä½ å·²ç»æ˜¯äº†ï¼Œåˆ«å¿˜äº†è®¢é˜…*[](https://sonery.medium.com/subscribe)**å¦‚æœä½ æƒ³åœ¨æˆ‘å‘è¡¨æ–°æ–‡ç« æ—¶æ”¶åˆ°ç”µå­é‚®ä»¶ã€‚**

*æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•åé¦ˆï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚*