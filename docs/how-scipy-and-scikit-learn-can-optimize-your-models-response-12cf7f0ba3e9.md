# SciPy å’Œ Scikit-learn å¦‚ä½•ä¼˜åŒ–æ¨¡å‹çš„å“åº”

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-scipy-and-scikit-learn-can-optimize-your-models-response-12cf7f0ba3e9>

## çœ‹çœ‹ä¸€äº›æ–¹ä¾¿çš„ä¼˜åŒ–åŠŸèƒ½ï¼Œä»é¢„æµ‹åˆ‡æ¢åˆ°å¤„æ–¹ï¼

æ‹¥æœ‰ä¸€ä¸ªå¤åˆ¶åŸºæœ¬äº‹å®çš„å¥å£®æ¨¡å‹æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯èƒ½å¤Ÿæ‰¾åˆ°å°†æœ€å°åŒ–æˆ–æœ€å¤§åŒ–å…¶å“åº”çš„ç‰¹æ€§å€¼å¯èƒ½ä¼šæ›´å¥½ã€‚ç†è§£ä¸ºä»€ä¹ˆç”¨å·§å…‹åŠ›é¥¼å¹²ğŸªï¼

![](img/63edd239d484dfc49ac6c9cf949da270.png)

[æœ¬Â·æ–¯å¦](https://unsplash.com/@benostein?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹ç…§

# è¯­å¢ƒ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åˆšåˆšè¢«ä¸€å®¶å·§å…‹åŠ›é¥¼å¹²å‚é›‡ä½£äº†ï¼
å¾ˆæ£’çš„å·¥ä½œï¼Œä¸æ˜¯å—ï¼Ÿ

ä½œä¸ºä¸€åæ•°æ®ç§‘å­¦å®¶ï¼Œä½ çš„è€æ¿è¦æ±‚ä½ åœ¨æµç¨‹çš„ç¬¬ä¸€æ­¥å·¥ä½œï¼Œè¿™æ—¶æ‰€æœ‰çš„é…æ–™(é¢ç²‰ã€é»„æ²¹ã€ç³–ç­‰)éƒ½å·²ç»å‡†å¤‡å¥½äº†ã€‚)æ··åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºæ“ä½œäººå‘˜é¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œä»–ä»¬æœ‰æ—¶ä¼šåœ¨é¢å›¢ä¸­ç»“å—â€¦â€¦è¿™ä¼šå±åŠé¥¼å¹²çš„è´¨é‡ï¼ğŸ˜±

å¥½æ¶ˆæ¯æ˜¯ä»–ä»¬å·²ç»èƒ½å¤Ÿæµ‹é‡:

*   **é…æ–™çš„ä¸»è¦ç‰¹æ€§**(å¦‚é¢ç²‰çš„å«æ°´é‡ï¼Œé»„æ²¹çš„æŸ”è½¯åº¦)ï¼Œ
*   **æ··åˆå™¨çš„è®¾ç½®**(å…¶é€Ÿåº¦ã€æ¸©åº¦ç­‰ã€‚),
*   å’Œ**é¢å›¢ä¸­çš„ç»“å—ç‡**ï¼Œä» 0 åˆ° 10% (5%æ˜¯ä¸´ç•Œé˜ˆå€¼)

æ•°æ®æ˜¯å¹²å‡€çš„ï¼Œç»“æ„è‰¯å¥½(ä¸ç”¨æé†’ä½ ï¼Œè¿™æ˜¯è™šæ„çš„ğŸ˜‚)è€Œä¸”ä¸ç”¨èŠ±å¤ªå¤šæ—¶é—´ï¼Œä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥æ»¡æ€€ä¿¡å¿ƒåœ°é¢„æµ‹é¢å›¢ä¸­å—çŠ¶ç‰©çš„ç™¾åˆ†æ¯”ã€‚

ä¸ºäº†å±•ç¤ºæ‚¨çš„æ¨¡å‹æœ‰å¤šå¥å£®ï¼Œæ‚¨å°†æ‰€æœ‰äººèšé›†åœ¨æ…æ‹Œæœºå‘¨å›´ï¼Œå‘æ¨¡å‹è¾“å…¥å½“å‰æ‰¹æ¬¡çš„å±æ€§ï¼Œå¹¶å®£å¸ƒé¢å›¢å°†å…·æœ‰(ç¾éš¾æ€§çš„ï¼)7%çš„åŒ…å¹²ç‡ã€‚

å½“æ··åˆæ“ä½œç»“æŸæ—¶ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥çœ‹åˆ°ä½ çš„æ¨¡å‹æ˜¯æ­£ç¡®çš„â€¦ä½†æ˜¯ï¼Œæœ€ç»ˆï¼Œé¢å›¢å¿…é¡»è¢«æ‰”æ‰â€¦

ä½ çš„è€æ¿çœ‹ç€ä½ è¯´:

> "**æœ‰äº›å‚æ•°æˆ‘ä»¬å¯ä»¥æ§åˆ¶(æ…æ‹Œå™¨çš„é€Ÿåº¦ã€æˆ‘åŠ çš„æ°´é‡)ï¼Œæœ‰äº›å‚æ•°æˆ‘ä»¬æ— æ³•æ§åˆ¶(é¢ç²‰çš„æ¹¿åº¦ã€æˆ¿é—´çš„ç¡®åˆ‡æ¸©åº¦ç­‰)ã€‚).**
> 
> **è¯·ä½¿ç”¨æ‚¨çš„æ¨¡å‹å‘Šè¯‰æˆ‘ä»¬ï¼Œå¯¹äºæ¯ä¸€æ‰¹ï¼Œå¦‚ä½•å¾®è°ƒç”Ÿäº§å‚æ•°ä»¥æœ€å¤§é™åº¦åœ°é™ä½åºŸå“ç‡ã€‚**

è¿™æ˜¯ä¸€ä¸ªä¸¥å³»çš„äº‹å®:ä½ çš„éšæœºæ£®æ—æ¨¡å‹è¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯ï¼Œä½œä¸º 100 ä¸ªå†³ç­–æ ‘çš„ç»„åˆï¼Œå®ƒæ˜¯å®Œå…¨éçº¿æ€§çš„â€¦è¿™ä½¿å¾—ä½ ä¸å¯èƒ½æ‰¾åˆ°ä¸€ä¸ªæœ€ä½³å€¼ï¼Œå› ä¸ºä½ å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„çº¿æ€§æ–¹ç¨‹è§£å†³â€¦

å¥½æ¶ˆæ¯æ˜¯ SciPy ç¡®å®æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„ä¼˜åŒ–åŠŸèƒ½æ¥å¸®åŠ©æ‚¨ï¼›è®©æˆ‘ä»¬æ¥å‘ç°å¦‚ä½•ï¼

# å»ºæ¨¡

ä¸ºäº†ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªâ€œè¿‡äºç®€å•â€çš„æ¨¡å‹ï¼Œä½†æ˜¯å¯¹äºæ›´å¤æ‚çš„é—®é¢˜ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ã€‚

å‡è®¾é¢å›¢å—ç‡(Y)å—ä¸¤ä¸ªä¸»è¦å‚æ•°çš„å½±å“ï¼Œå­˜å‚¨åœ¨â€œXâ€NumPy æ•°ç»„ä¸­:

```
nb_samples = 15np.random.seed(22)
X = np.random.randint(1, high=10, size=(nb_samples, 2))print(X)y = X[:, 0] / X[:, 1]
print(y)
```

è¾“å‡º:

```
[[6 5]
 [1 5]
 [7 7]
 [5 9]
 [5 3]
 [9 8]
 [3 9]
 [9 6]
 [5 3]
 [3 2]
 [7 4]
 [4 3]
 [8 8]
 [8 8]
 [5 5]][1.2        0.2        1\.         0.55555556 1.66666667 1.125  0.33333333 1.5        1.66666667 1.5        1.75       1.33333333  1\.         1\.         1\.        ]
```

*æ³¨æ„:å®Œæ•´ç¬”è®°æœ¬çš„é“¾æ¥åœ¨æ–‡ç« çš„æœ€åæä¾›*ğŸ“‘

å› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªâ€œé€‚å½“çš„â€(ä½†å¾ˆç®€å•çš„)æ•°æ®é›†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ Scikit-Learn[decision tree regressor](https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeRegressor.html)åˆ›å»ºä¸€ä¸ªéçº¿æ€§æ¨¡å‹:

```
model = DecisionTreeRegressor(max_depth=4)
model.fit(X, y)
model.score(X, y)#0.9343996768065437
```

ç”»å‡ºå®ƒçš„æ ·å­:

```
plt.figure(figsize=(15, 15))
tree.plot_tree(model)
plt.show()
```

![](img/a460871fe8eccde73d2a1f3fd7ccb11a.png)

å†³ç­–æ ‘è¡¨ç¤ºæ³•â€”ä½œè€…å›¾ç‰‡

*æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ ¹æ® X[0]å’Œ X[1]çš„å€¼ï¼Œè¯¥å†³ç­–æ ‘æœ‰ 8 ç§å¯èƒ½çš„è¾“å‡ºã€‚*

# SciPy ä¼˜åŒ–åº“

[**SciPy Optimize**](https://docs.scipy.org/doc/scipy/reference/optimize.html) åº“æä¾›äº†ä¸€ç»„å‡½æ•°æ¥æœ€å°åŒ–(æˆ–æœ€å¤§åŒ–)ç›®æ ‡å‡½æ•°ã€‚å”¯ä¸€çš„é¢„é˜²æªæ–½æ˜¯æ‚¨åº”è¯¥é€‰æ‹©ä¸æ‚¨çš„ç”¨ä¾‹ç›¸å¯¹åº”çš„ä¸€ä¸ª:

*   **ä½¿ç”¨â€œæœ€å°åŒ–â€** = >çš„å±€éƒ¨(å¤šå˜é‡)ä¼˜åŒ–åœ¨æ‚¨æœ‰æ ‡é‡/çº¿æ€§å‡½æ•°è¦æ±‚è§£æ—¶éå¸¸æœ‰ç”¨ï¼Œè¯¥å‡½æ•°å‡å®šæœ‰ä¸€ä¸ªæœ€ä¼˜å€¼ï¼Œå¦‚ä¸‹é¢çš„å‡¸å‡½æ•°(x +y):

![](img/3e60e4af41d8b9eef27ff0c5b50e4cbc.png)

f(xï¼Œy)= x+y-ä½œè€…å›¾ç‰‡

*   **â€œåŒé‡é€€ç«â€å…¨å±€ä¼˜åŒ–** = >å½“ä½ æœ‰ä¸€ä¸ªéçº¿æ€§å‡½æ•°ï¼Œæ„å‘³ç€éšæœºæœç´¢æœ€ä¼˜è§£æ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨é›†åˆæ ‘(Random Forestï¼ŒXGBoost ç­‰)ç­‰æ¨¡å‹æ—¶é‡åˆ°çš„å…¸å‹æƒ…å†µã€‚).

![](img/380b443fd332a9ee2fd250a4fe5a64a0.png)

å†³ç­–æ ‘ç¤ºä¾‹-ä½œè€…å›¾ç‰‡

åœ¨å¼€å§‹æœ€ä¼˜æœç´¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œè¿”å›æˆ‘ä»¬çš„éçº¿æ€§æ¨¡å‹çš„ç»“æœ:

```
def objective(v):
    return model.predict(np.array([v]))[0]
```

ç„¶åï¼Œåªéœ€è®¾ç½®æ¯ä¸ªç‰¹å¾çš„è¾¹ç•Œ(X[0]å’Œ X[1])å¹¶å¯åŠ¨ä¼˜åŒ–è¿‡ç¨‹:

```
bounds = [[1, 10], [1, 10]]result = dual_annealing(objective, bounds, maxiter=100)print(f"Status: {result['message']}")
print(f"Total Evaluations: {result['nfev']}")
print(f"Minimum reached: {result['fun']}")
print(f"Solution vector: {result['x']}")
```

è¾“å‡º:

```
Status: ['Maximum number of iteration reached']
Total Evaluations: 410
Minimum reached: 0.2
Solution vector: [1.78224412 9.35220569]
```

é€šè¿‡å°†è¾¹ç•Œè®¾ç½®ä¸ºç­‰äºåŸå§‹è¦ç´ çš„ç©ºé—´ï¼Œè¯¥å‡½æ•°å¯ä»¥æå‡ºä¸€å¯¹å€¼æ¥æœ‰æ•ˆåœ°æœ€å°åŒ–ç›®æ ‡å‡½æ•°:

![](img/2a3a33f794e6c871d9d21ac6e8bdd95e.png)

1 å·ä¼˜åŒ–ç»“æœâ€”ä½œè€…æä¾›çš„å›¾ç‰‡

ç°åœ¨è®©æˆ‘ä»¬ç”¨ X[1]ä¸Šçš„çº¦æŸæ¥é‡ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¬¡äº 4:

```
bounds = [[1, 10], [1, 4]]result = dual_annealing(objective, bounds, maxiter=100)print(f"Status: {result['message']}")
print(f"Total Evaluations: {result['nfev']}")
print(f"Minimum reached: {result['fun']}")
print(f"Solution vector: {result['x']}")
```

è¾“å‡º:

```
Status: ['Maximum number of iteration reached']
Total Evaluations: 404
Minimum reached: 1.3333333333333333
Solution vector: [4.32296802 1.87272909]
```

![](img/480f08c438f4e5283cb76e835ad091aa.png)

ä¼˜åŒ–ç»“æœ n 2 â€”ä½œè€…æä¾›çš„å›¾ç‰‡

è¯¥ç®—æ³•å†æ¬¡èƒ½å¤Ÿæ‰¾åˆ°ç»™å®šè¾¹ç•Œå†…çš„æœ€å°å¯èƒ½å€¼(1.333)ã€‚

# æœ€å¤§åŒ–æˆ–ç›®æ ‡åŒ–

ä¸å…¶æœ€å°åŒ–å‡½æ•°ï¼Œè¿˜ä¸å¦‚å°½é‡æœ€å¤§åŒ–æˆ–è€…è¾¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä¿®æ”¹ç›®æ ‡å‡½æ•°ã€‚

*   **é€šè¿‡åœ¨ç»“æœå‰æ·»åŠ â€œ-â€æ¥æœ€å¤§åŒ–** = >
*   **ç„å‡†** = >é€šè¿‡åœ¨ç»“æœè®¡ç®—ä¸­åŒ…å«ç›®æ ‡

æœ€å¤§åŒ–ç¤ºä¾‹:

```
def objective_max(v):
    return -model.predict(np.array([v]))[0]bounds = [[1, 10], [1, 10]]result = dual_annealing(objective_max, bounds, maxiter=100)print(f"Status: {result['message']}")
print(f"Total Evaluations: {result['nfev']}")
print(f"Maximum reached: {-result['fun']}")
print(f"Solution vector: {result['x']}")# Output
Status: ['Maximum number of iteration reached']
Total Evaluations: 410
Maximum reached: 1.75
Solution vector: [8.0829203 4.2638071]
```

![](img/4dd361a5c57f4f66be82acf5bb355a43.png)

ä¼˜åŒ–ç»“æœ 3 â€”ä½œè€…æä¾›çš„å›¾ç‰‡

ä»ç°åœ¨å¼€å§‹ï¼Œå†ä¹Ÿæ²¡æœ‰ç†ç”±è®©é¢å›¢ç»“å—äº†ï¼Œå·§å…‹åŠ›æ›²å¥‡çš„è´¨é‡æ˜¯å®‰å…¨çš„ğŸªğŸªğŸª

ç›¸åº”çš„ä»£ç å­˜å‚¨åœ¨è¿™é‡Œ:

<https://github.com/pierrelouisbescond/medium_articles/blob/main/medium_optimize.ipynb>  

è¯·ä¸è¦çŠ¹è±«ï¼Œæµè§ˆæˆ‘åœ¨ Medium ä¸Šçš„å…¶ä»–æ–‡ç« :

<https://pl-bescond.medium.com/pierre-louis-besconds-articles-on-medium-f6632a6895ad> 