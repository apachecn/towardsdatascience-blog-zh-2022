# ä½¿ç”¨ IVFPQ è¿›è¡Œç›¸ä¼¼æ€§æœç´¢

> åŸæ–‡ï¼š<https://towardsdatascience.com/similarity-search-with-ivfpq-9c6348fd4db3>

## äº†è§£å¦‚ä½•å®ç°å€’æ’æ–‡ä»¶ç´¢å¼•(IVF)å’Œä¹˜ç§¯é‡åŒ–(PQ ),ä»¥å®ç°å¿«é€Ÿæœ‰æ•ˆçš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢

![](img/cd3f000b48a8bba6801dcd744e7ee2cd.png)

Voronoi ç»†èƒã€‚é™¤éå¦æœ‰è¯´æ˜ï¼Œæ‰€æœ‰å›¾ç‰‡å‡ä¸ºä½œè€…æ‰€æœ‰

åœ¨ä¸Šä¸€ç¯‡å…³äº [**ç›¸ä¼¼æ€§æœç´¢çš„äº§å“é‡åŒ–**](/product-quantization-for-similarity-search-2f1f67c5fddd) çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†ä»€ä¹ˆæ˜¯äº§å“é‡åŒ–ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº†äº§å“é‡åŒ–å¦‚ä½•ç”¨äºç›¸ä¼¼æ€§æœç´¢ã€‚

ä¹˜ç§¯é‡åŒ–å°†æ•°æ®åº“ä¸­çš„æ¯ä¸ªå‘é‡è½¬æ¢ä¸ºçŸ­ç (PQ ç )ï¼Œè¿™ç§è¡¨ç¤ºå½¢å¼å¯¹äºè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢æ¥è¯´éå¸¸èŠ‚çœå†…å­˜ã€‚

</product-quantization-for-similarity-search-2f1f67c5fddd>  

æ­£å¦‚æ–‡ç« ä¸­æåˆ°çš„ï¼Œäº§å“é‡åŒ–æ˜¯é«˜åº¦å¯æ‰©å±•çš„ï¼Œä½†æ˜¯å•ç‹¬å®ç°äº§å“é‡åŒ–å¯¹äºå¤§è§„æ¨¡æœç´¢æ¥è¯´å¹¶ä¸æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚

åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å’Œå­¦ä¹ å¦‚ä½•å°†äº§å“é‡åŒ–ä¸å€’æ’æ–‡ä»¶ç´¢å¼•ç›¸ç»“åˆï¼Œä»¥å½¢æˆä¸€ç§é«˜æ•ˆå¿«é€Ÿä¸”è®°å¿†çµæ•çš„æœç´¢æ–¹æ³•ã€‚

> åœ¨ç ”ç©¶è®ºæ–‡ä¸­ï¼ŒIVFPQ é€šå¸¸ä¹Ÿç§°ä¸º IVFADCã€‚

# å€’æ’æ–‡ä»¶ç´¢å¼•

ä¸€ä¸ª[å€’æ’æ–‡ä»¶](https://en.wikipedia.org/wiki/Inverted_index)æ˜¯ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œç”¨äºå°†*å†…å®¹*æ˜ å°„åˆ°å®ƒä»¬çš„*ä½ç½®*ã€‚

ä½ å¯èƒ½ä¼šé—®ï¼Œ*å†…å®¹*å’Œ*ä½ç½®*æ˜¯ä»€ä¹ˆï¼Œå€’æ’æ–‡ä»¶ç´¢å¼•å¦‚ä½•åº”ç”¨äºå¸¦æœ‰äº§å“é‡åŒ–çš„ç›¸ä¼¼æ€§æœç´¢ï¼Ÿ

åœ¨æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ*å†…å®¹*æŒ‡çš„æ˜¯æ•°æ®åº“å‘é‡ï¼Œ*ä½ç½®*æŒ‡çš„æ˜¯è¿™äº›å‘é‡æ‰€åœ¨çš„åˆ†åŒºã€‚

æ˜¯çš„ï¼Œä½ æ²¡å¬é”™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“å‘é‡è¿›è¡Œåˆ†åŒºã€‚å¯¹æ•°æ®åº“å‘é‡è¿›è¡Œåˆ†åŒºçš„åŸå› æ˜¯ä¸ºäº†åªå¯¹ç‰¹å®šåˆ†åŒºçš„å‘é‡è€Œä¸æ˜¯æ‰€æœ‰å‘é‡è¿›è¡Œæœç´¢ã€‚

## ç²—ç•¥é‡åŒ–å™¨

é¦–å…ˆï¼Œæ•°æ®åº“å‘é‡è¢«åˆ†æˆ`k'`ä¸ªåˆ†åŒºã€‚åˆ†å‰²æ˜¯é€šè¿‡ [k å‡å€¼èšç±»](https://en.wikipedia.org/wiki/K-means_clustering)å®Œæˆçš„ï¼Œäº§ç”Ÿäº†æˆ‘ä»¬æ‰€è¯´çš„ç²—é‡åŒ–å™¨ã€‚

è¿™é‡Œï¼Œæ„å»ºäº†ä¸€ä¸ªå€’æ’æ–‡ä»¶ç´¢å¼•ï¼Œå®ƒå°†ç”¨äºå°†å‘é‡åˆ—è¡¨(å³å€’æ’åˆ—è¡¨)æ˜ å°„åˆ°ç›¸åº”çš„åˆ†åŒºã€‚

![](img/f7ddbc07368f8e543a950111d680b293.png)

æ¯ä¸ªåˆ†åŒºç”±ä¸€ä¸ª*åˆ†åŒºè´¨å¿ƒ*æ¥è¡¨ç¤ºå’Œå®šä¹‰ï¼Œæ¯ä¸ªå‘é‡åªèƒ½å±äºä¸€ä¸ªåˆ†åŒºã€‚è¿™ç§ç»“æ„æœ‰æ—¶è¢«ç§°ä¸º [Voronoi](https://en.wikipedia.org/wiki/Voronoi_diagram) å•å…ƒï¼Œå› æ­¤åŸºäºåˆ†åŒºçš„æœç´¢ç­–ç•¥ä¹Ÿè¢«ç§°ä¸º*å•å…ƒæ¢æµ‹*æ–¹æ³•*ã€‚*

![](img/d6cd9b1302caaa9cea647f3e0eda6056.png)

Voronoi å•å…ƒçš„ä¾‹å­

# å‰©ä½™å‘é‡çš„ä¹˜ç§¯é‡åŒ–

æ¥ä¸‹æ¥ï¼Œå¯¹äºè®­ç»ƒå’Œç¼–ç ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸ [**ç›¸ä¼¼æ€§æœç´¢çš„äº§å“é‡åŒ–**](/product-quantization-for-similarity-search-2f1f67c5fddd) ä¸­æè¿°çš„ç›¸åŒçš„è¿‡ç¨‹ï¼Œé™¤äº†è¿™æ¬¡è®­ç»ƒå’Œç¼–ç æ˜¯åœ¨å‰©ä½™å‘é‡è€Œä¸æ˜¯åŸå§‹å‘é‡ä¸Šå®Œæˆçš„ã€‚

## ä»€ä¹ˆæ˜¯å‰©ä½™å‘é‡

å‰©ä½™å‘é‡åªä¸è¿‡æ˜¯å‘é‡ä»å…¶*åˆ†åŒºè´¨å¿ƒ*çš„åç§»ï¼Œå³åŸå§‹å‘é‡ä¸å…¶å…³è”çš„*åˆ†åŒºè´¨å¿ƒ*ä¹‹é—´çš„å·®ã€‚

ä¸ºäº†è®¡ç®—æ®‹å·®ï¼Œæˆ‘ä»¬åªéœ€ä»åŸå§‹å‘é‡ä¸­å‡å»è´¨å¿ƒã€‚

![](img/237d2cce4d18278a6c512e9049bbe1e7.png)

è®¡ç®—æ®‹å·®ï¼Œå‘é‡ä»å…¶*åˆ†åŒºè´¨å¿ƒ*çš„åç§»é‡

## ä¸ºä»€ä¹ˆæ˜¯å‰©ä½™å‘é‡

ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨æ®‹å·®å‘é‡ï¼Œè¿˜è¦ç»å†é¢å¤–çš„è®¡ç®—æ®‹å·®çš„æ­¥éª¤ï¼Ÿ

ç¼–ç æ®‹å·®å‘é‡èƒŒåçš„ç›´è§‰æ˜¯æé«˜å‡†ç¡®æ€§ï¼Œå› ä¸ºç¼–ç æ®‹å·®æ¯”ç¼–ç åŸå§‹å‘é‡æ›´ç²¾ç¡®ã€‚

ä¸ºäº†ç†è§£è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œæˆ‘ä»¬ç”¨ä¸€ç»„ä¸‰ç»´å‘é‡æ¥è¯´æ˜ã€‚æ³¨æ„ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¯¹è¿™ç§ä½ç»´å‘é‡åº”ç”¨ä¹˜ç§¯é‡åŒ–æ˜¯ä¸å®é™…çš„ã€‚ä¸‰ç»´å‘é‡åœ¨æ­¤ä»…ç”¨äºåœ¨è®¡ç®—æ®‹å·®ä¹‹å‰å’Œä¹‹åè§£é‡Šå’Œå¯è§†åŒ–å®ƒä»¬ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‘é‡å¯ä»¥æ¸…æ¥šåœ°åˆ†æˆä¸¤ä¸ªåˆ†åŒºï¼Œåˆ†åŒºè´¨å¿ƒ*ç”¨çº¢åœˆè¡¨ç¤ºã€‚è¿˜æœ‰ä¸€ä¸ªç”¨æ©™è‰²åå­—ç¬¦å·è¡¨ç¤ºçš„æŸ¥è¯¢å‘é‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªæŸ¥è¯¢å‘é‡éå¸¸æ¥è¿‘`Partition B`ã€‚*

![](img/20368faba18dff03a4bc4e922a0259c0.png)

ç¬¬ä¸€ä¸ªå›¾-å…·æœ‰ä¸¤ä¸ªåˆ†åŒºçš„åŸå§‹å‘é‡

è®¡ç®—å®Œå‰©ä½™å‘é‡åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬åœ¨ä¸‹å›¾ä¸­çš„æ ·å­ã€‚

![](img/e190f1d3894be22a8f4f66fc7edbf19c.png)

ç¬¬äºŒå¹…å›¾â€”â€”å‰©ä½™å‘é‡

## **ç¬¬ä¸€æ¬¡è§‚å¯Ÿ**

é€šè¿‡è·å–æ®‹å·®ï¼Œæ¥è‡ªä¸¤ä¸ªåˆ†åŒºçš„æ•°æ®ç‚¹å®é™…ä¸Šå·²ç»é‡æ–°å®šä½åˆ°ä»¥åŸç‚¹ä¸ºä¸­å¿ƒçš„ç›¸åŒç©ºé—´ï¼Œå¹¶ä¸”å½¼æ­¤é‡å ã€‚è¿™ä¸ç¬¬ä¸€ä¸ªå›¾éå¸¸ä¸åŒï¼Œåœ¨ç¬¬ä¸€ä¸ªå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªåˆ†åŒºå½¼æ­¤éš”ç¦»ã€‚

> å–æ®‹å·®ç±»ä¼¼äºå°†è´¨å¿ƒç§»åŠ¨åˆ°åŸç‚¹ï¼Œè¿™æ ·æ‰€æœ‰çš„æ•°æ®ç‚¹ç°åœ¨éƒ½èšç„¦åœ¨åŸç‚¹ä¸Šã€‚

## **ç¬¬äºŒæ¬¡è§‚å¯Ÿ**

è®©æˆ‘ä»¬æ³¨æ„ç¬¬ä¸€ä¸ªå›¾ä¸­çš„æŸ¥è¯¢å‘é‡å’Œç¬¬äºŒä¸ªå›¾ä¸­çš„æŸ¥è¯¢å‘é‡çš„æ®‹å·®ã€‚

åœ¨ç¬¬äºŒä¸ªå›¾ä¸­ï¼Œ`Query Residual A`æ˜¯æŸ¥è¯¢å‘é‡ä»åˆ†åŒº A çš„è´¨å¿ƒçš„åç§»ï¼Œè€Œ`Query Residual B`æ˜¯æŸ¥è¯¢å‘é‡ä»åˆ†åŒº b çš„è´¨å¿ƒçš„åç§»ã€‚

> åœ¨æ®‹å·®è®¡ç®—ä¹‹å‰å’Œä¹‹åï¼ŒæŸ¥è¯¢è®°å½•åˆ°ç›¸åº”åˆ†åŒºå’Œæ•°æ®ç‚¹çš„è·ç¦»ä¿æŒä¸å˜ã€‚

ä»æ‰€æœ‰è¿™äº›è§‚å¯Ÿä¸­æˆ‘ä»¬èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Ÿ

ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œé€šè¿‡è·å–æ®‹å·®ï¼Œæˆ‘ä»¬è®¾æ³•å‡å°‘äº†æ¥è‡ªæ‰€æœ‰åˆ†åŒºçš„æ•°æ®ç‚¹çš„åˆ†å¸ƒï¼Œå¹¶å°†å®ƒä»¬å‹ç¼©åˆ°ç›¸åŒçš„åŒºåŸŸï¼ŒåŒæ—¶ä¿æŒäº†åˆ°æŸ¥è¯¢è®°å½•çš„ç›¸åŒè·ç¦»ã€‚

ç”±äºæ•°æ®é›†ä¸­çš„æ–¹å·®è¾ƒä½ï¼Œå½“ä½¿ç”¨ä¹˜ç§¯é‡åŒ–è¿›è¡Œè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢æ—¶ï¼Œè¿™å°†è½¬åŒ–ä¸ºè¾ƒå°çš„è¯¯å·®ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´æ›´å¥½çš„æœç´¢è´¨é‡ã€‚

ç°åœ¨ï¼Œåœ¨ç†è§£äº†å‰©ä½™å‘é‡ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ä¹‹åï¼Œè®©æˆ‘ä»¬å›åˆ°[ä¹˜ç§¯é‡åŒ–è¿‡ç¨‹](/product-quantization-for-similarity-search-2f1f67c5fddd)ã€‚

æ¦‚æ‹¬åœ°è¯´ï¼Œä»ä¹˜ç§¯é‡åŒ–è®­ç»ƒä¸­å­¦ä¹ ç æœ¬ï¼Œå¹¶ä¸”ä»ç¼–ç è¿‡ç¨‹ä¸­ç”Ÿæˆ PQ ç ã€‚

![](img/6dc2c10d84cc6dfd01eda8ebe2c1fb5f.png)

äº§å“é‡åŒ–åŸ¹è®­å’Œç¼–ç æµç¨‹

éšç€å€’æ’æ–‡ä»¶ç´¢å¼•çš„å‡ºç°ï¼ŒPQ ä»£ç ç°åœ¨ä½œä¸ºå€’æ’åˆ—è¡¨æ¡ç›®çš„ä¸€éƒ¨åˆ†è¢«åŒ…æ‹¬åœ¨å†…ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå€’æ’è¡¨çš„æ¡ç›®å°†ç”±å‘é‡æ ‡è¯†ç¬¦(å‘é‡ Id)å’Œç¼–ç æ®‹å·®(PQ ç )ç»„æˆã€‚

![](img/b8d9f616fb49d70aa0c0467c22187d45.png)

ç”±å‘é‡ Id å’Œ PQ ä»£ç ç»„æˆçš„åå‘åˆ—è¡¨æ¡ç›®

ç„¶åï¼Œè¿™äº›æ¡ç›®è¢«æ·»åŠ åˆ°æ ‡è®°ä¸ºç›¸å…³åˆ†åŒºçš„ç›¸åº”å€’æ’è¡¨ä¸­ã€‚

# ä½¿ç”¨ IVFPQ æœç´¢

ç²—ç•¥é‡åŒ–å™¨ä¿å­˜å…³äºåˆ†åŒºåˆ—è¡¨å’Œ*åˆ†åŒºè´¨å¿ƒ*çš„ä¿¡æ¯ã€‚ç»™å®šä¸€ä¸ªæŸ¥è¯¢å‘é‡`q`ï¼Œä½¿ç”¨ç²—é‡åŒ–å™¨æ¥å¯»æ‰¾æœ€æ¥è¿‘`q`çš„*åˆ†åŒºè´¨å¿ƒ*ã€‚

åœ¨è·å¾—ç¦»`q`æœ€è¿‘çš„*åˆ†åŒºè´¨å¿ƒ*åï¼Œè®¡ç®—æŸ¥è¯¢å‘é‡çš„æ®‹å·®ã€‚

ç±»ä¼¼äºåœ¨ [**ç›¸ä¼¼æ€§æœç´¢çš„ä¹˜ç§¯é‡åŒ–**](/product-quantization-for-similarity-search-2f1f67c5fddd) ä¸­æè¿°çš„æœç´¢è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ç æœ¬å’ŒæŸ¥è¯¢å‘é‡çš„æ®‹å·®æ¥é¢„å…ˆè®¡ç®—éƒ¨åˆ†[å¹³æ–¹æ¬§å‡ é‡Œå¾·è·ç¦»](https://en.wikipedia.org/wiki/Euclidean_distance#Squared_Euclidean_distance)ã€‚

è¿™äº›éƒ¨åˆ†å¹³æ–¹æ¬§å‡ é‡Œå¾·è·ç¦»è¢«è®°å½•åœ¨å…·æœ‰`k`è¡Œå’Œ`M`åˆ—çš„è·ç¦»è¡¨ä¸­ï¼Œå…¶ä¸­`M`è¡¨ç¤ºå‘é‡æ®µçš„æ•°é‡ï¼Œè€Œ`k`è¡¨ç¤ºåœ¨è®­ç»ƒæœŸé—´è¢«é€‰æ‹©æ¥æ‰§è¡Œ k å‡å€¼èšç±»çš„å€¼ã€‚

ç°åœ¨ï¼Œæœ‰äº†å€’æ’æ–‡ä»¶ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ€§åœ°æŸ¥æ‰¾éƒ¨åˆ†è·ç¦»å¹¶è¿›è¡Œæ±‚å’Œï¼Œåªé’ˆå¯¹å€’æ’åˆ—è¡¨ä¸­é‚£äº›è¢«æ ‡è®°ä¸ºåˆ†åŒºè´¨å¿ƒæœ€æ¥è¿‘`q`çš„åˆ†åŒºçš„æ¡ç›®ã€‚

> å€’æ’æ–‡ä»¶ç´¢å¼•æ˜¯éç©·ä¸¾æœç´¢æ–¹æ³•çš„å…³é”®ç»„ä»¶ã€‚

> ä¸ºäº†æ‰¾åˆ°å¹¶è¿”å›`*K*`æœ€è¿‘çš„é‚»å±…ï¼Œä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨å›ºå®šå®¹é‡çš„ [Max-Heap](https://en.wikipedia.org/wiki/Max-heap) ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºæ ‘çš„ç»“æ„ï¼Œå…¶ä¸­æ ¹èŠ‚ç‚¹æ€»æ˜¯åŒ…å«æœ€å¤§å€¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½ç­‰äºæˆ–å°äºçˆ¶èŠ‚ç‚¹çš„å€¼ã€‚
> 
> åœ¨æ¯æ¬¡è·ç¦»è®¡ç®—ä¹‹åï¼Œåªæœ‰å½“å‘é‡æ ‡è¯†ç¬¦çš„è·ç¦»å°äºæœ€å¤§å †ä¸­çš„æœ€å¤§è·ç¦»æ—¶ï¼Œå‘é‡æ ‡è¯†ç¬¦æ‰è¢«æ·»åŠ åˆ°æœ€å¤§å †ç»“æ„ä¸­ã€‚

# æ”¹å–„æœç´¢ç»“æœ

æ—©äº›æ—¶å€™ï¼Œå¯¹äºå€’æ’æ–‡ä»¶ç´¢å¼•ï¼Œæˆ‘ä»¬è®¨è®ºäº†ç¼–ç æ®‹å·®è€Œä¸æ˜¯åŸå§‹å‘é‡æ¥æ”¹å–„æœç´¢ç»“æœã€‚

ç„¶è€Œï¼Œå¦‚æœåªä»ä¸€ä¸ªåˆ†åŒºè¿›è¡Œæœç´¢ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°æ¯”æ²¡æœ‰å€’æ’æ–‡ä»¶ç´¢å¼•çš„åŸºæœ¬ä¹˜ç§¯é‡åŒ–æ›´å·®çš„ç»“æœã€‚

è™½ç„¶æœç´¢é€Ÿåº¦å¿«å¾—ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼Œåªéœ€æ¢æµ‹ä¸€ä¸ªåˆ†åŒºï¼Œä½†ç»“æœä¼šå—åˆ°å½±å“ï¼Œå› ä¸ºæœç´¢èŒƒå›´ç°åœ¨ç¡®å®å±€é™äºå¾ˆå°çš„è®°å½•å­é›†ã€‚

æ ¹æ®ä½œè€…çš„ [**ä¸ºæœ€è¿‘é‚»æœç´¢**](https://ieeexplore.ieee.org/document/5432202)ã€1ã€‘ã€

> æŸ¥è¯¢å‘é‡åŠå…¶æœ€è¿‘çš„é‚»å±…é€šå¸¸ä¸è¢«é‡åŒ–åˆ°ç›¸åŒçš„åˆ†åŒºè´¨å¿ƒï¼Œè€Œæ˜¯è¢«é‡åŒ–åˆ°é™„è¿‘çš„åˆ†åŒºè´¨å¿ƒ

å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œå°½ç®¡æŸ¥è¯¢å‘é‡æœ€æ¥è¿‘é¡¶éƒ¨åˆ†åŒºçš„è´¨å¿ƒï¼Œä½†é™„è¿‘åˆ†åŒºä¸­è¿˜æœ‰å…¶ä»–å‘é‡ä¹Ÿæ˜¯æŸ¥è¯¢å‘é‡çš„æ½œåœ¨æœ€è¿‘é‚»å±…ã€‚

![](img/f78e4c203de472057b77b7a1a92d2de3.png)

å¦‚æœæœç´¢ä»…é™äºæŸ¥è¯¢å‘é‡æœ€æ¥è¿‘åˆ†åŒºè´¨å¿ƒçš„åˆ†åŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šé”™è¿‡ä½äºé™„è¿‘åˆ†åŒºçš„è®¸å¤šæ½œåœ¨çš„æœ€è¿‘é‚»å±…ã€‚

å½“æŸ¥è¯¢å‘é‡éå¸¸é è¿‘å•å…ƒæˆ–åˆ†åŒºçš„è¾¹ç•Œæ—¶ï¼Œè¿™ç§å½±å“ä¼šæ›´åŠ æ˜æ˜¾ã€‚

> ä¸ºäº†é¿å…é”™è¿‡é‚£äº›æ½œåœ¨çš„æœ€è¿‘é‚»å±…ï¼Œå¯ä»¥åœ¨æ›´å¤šåˆ†åŒºä¸Šæ‰§è¡Œå‘é‡æœç´¢ã€‚

ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬å°†åœ¨`W`åˆ†åŒºä¸Šæ‰§è¡Œæœç´¢ï¼Œå…¶ä¸­æ¥è‡ªè¿™äº›`W`åˆ†åŒºçš„è´¨å¿ƒæœ€æ¥è¿‘æŸ¥è¯¢å‘é‡ã€‚`W`é€šå¸¸æ˜¯ä¸€ä¸ªå¯é…ç½®çš„å‚æ•°ã€‚

æ‹¥æœ‰`w > 1`æœ‰ä»€ä¹ˆå¯“æ„ï¼Ÿ

å—¯ï¼Œéšç€æ›´å¤šåˆ†åŒºçš„åŠ å…¥ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨æ¯ä¸ª*åˆ†åŒºè´¨å¿ƒ*åˆ†åˆ«è®¡ç®—æŸ¥è¯¢å‘é‡çš„æ®‹å·®ã€‚å¹¶ä¸”å¯¹äºæŸ¥è¯¢å‘é‡çš„æ¯ä¸ªæ®‹å·®ï¼Œéœ€è¦è®¡ç®—å•ç‹¬çš„è·ç¦»è¡¨ã€‚

æœ€ç»ˆï¼Œåœ¨`W`åˆ†åŒºä¸Šæ‰§è¡Œæœç´¢çš„æ„å›¾å°†å¯¼è‡´è®¡ç®—`W`å‰©ä½™æŸ¥è¯¢å‘é‡å’Œ`W`è·ç¦»è¡¨ã€‚

å°½ç®¡æ„å»ºå€’æ’æ–‡ä»¶ç´¢å¼•ä¼šå¸¦æ¥å¼€é”€ï¼Œä½†å¯¹äºå¤§å‹æ•°æ®é›†ï¼Œæ‹¥æœ‰æ›´å¤šåˆ†åŒºå¹¶ä»æ›´å¤šåˆ†åŒºè¿›è¡Œæœç´¢é€šå¸¸ä¼šæé«˜æ•ˆç‡ã€‚è¿™æ˜¯ä¸€æ¡å¯è¡Œä¹‹è·¯ï¼Œå¹¶ä¸”åœ¨ç°å®ä¸­è¢«è¯æ˜éå¸¸æœ‰æ•ˆã€‚

ç„¶è€Œï¼Œå¯¹äºå°æ•°æ®é›†ï¼Œå¦‚æœåˆ†åŒºçš„æ•°é‡å¤ªå¤§ï¼Œç²—é‡åŒ–å™¨çš„å¤æ‚æ€§å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚

# æ‘˜è¦

ä¸‹å›¾æ€»ç»“äº†ä½¿ç”¨åå‘æ–‡ä»¶ç´¢å¼•å’Œäº§å“é‡åŒ–(IVFPQ)è¿›è¡Œç›¸ä¼¼æ€§æœç´¢çš„è¿‡ç¨‹å’Œæ­¥éª¤ã€‚

![](img/85489bcfab72c8bbc097e30a4c7fce9a.png)

å…·æœ‰å€’æ’æ–‡ä»¶ç´¢å¼•å’Œäº§å“é‡åŒ–çš„ç›¸ä¼¼æ€§æœç´¢(IVFPQ)

ä½¿ç”¨**å€’æ’æ–‡ä»¶ç´¢å¼•(IVF)** ï¼Œå¯ä»¥åœ¨ç›¸å…³åˆ†åŒºä¸Šæ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œå°†æœç´¢èŒƒå›´é™åˆ¶åœ¨é«˜åº¦ç›¸å…³çš„ä¸€ä¸ªå°å­é›†ä¸­ã€‚

å¦ä¸€æ–¹é¢ï¼Œ**ä¹˜ç§¯é‡åŒ–(PQ)** èƒ½å¤Ÿç”¨æå…¶èŠ‚çœå­˜å‚¨ç©ºé—´çš„å‹ç¼©è¡¨ç¤ºå¯¹çŸ¢é‡è¿›è¡Œç¼–ç ã€‚

> åˆ©ç”¨ä¹˜ç§¯é‡åŒ–(PQ)å®ç°å€’æ’æ–‡ä»¶ç´¢å¼•(IVF)æå‡ºäº†ä¸€ç§æ–°æ–¹æ³•(IVFPQ ),è¯¥æ–¹æ³•å¯¹äºå¤§è§„æ¨¡ç›¸ä¼¼æ€§æœç´¢éå¸¸æœ‰æ•ˆã€‚

å°†ä¸¤è€…ç»“åˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªä¸–ç•Œä¸­è·ç›Šã€‚ç»“æœå‘¢ï¼Ÿå¯¹äºå¤§è§„æ¨¡è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ï¼Œæœç´¢æ—¶é—´å¿«ï¼Œç²¾åº¦å¥½ã€‚

![](img/96fc8c20dc0682322ec3dc06e72c9771.png)

è©¹å§†æ–¯Â·å·´å°”èŒ¨åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

> å¤„ç†åäº¿çº§å‘é‡æ•°æ®é›†ï¼Ÿç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ï¼Œäº†è§£ **HNSW** ä»¥åŠå®ƒå¦‚ä½•ä¸ **IVFPQ** ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å½¢æˆåäº¿çº§ç›¸ä¼¼æ€§æœç´¢çš„æœ€ä½³ç´¢å¼•æ–¹æ³•ã€‚

</ivfpq-hnsw-for-billion-scale-similarity-search-89ff2f89d90e>  

# å‚è€ƒ

[1] H. JÃ©gouï¼ŒM. Douzeï¼ŒC. Schmidï¼Œ[æœ€è¿‘é‚»æœç´¢çš„ä¹˜ç§¯é‡åŒ–](https://ieeexplore.ieee.org/document/5432202) (2010)

[2] C. McCormickï¼Œ[ç”¨äº k-NN æ•™ç¨‹çš„äº§å“é‡åŒ–å™¨ç¬¬ 2 éƒ¨åˆ†](http://mccormickml.com/2017/10/22/product-quantizer-tutorial-part-2/) (2017)

[3] J. Briggsï¼Œ[äº§å“é‡åŒ–:å°†é«˜ç»´å‘é‡å‹ç¼© 97%](https://www.pinecone.io/learn/product-quantization/)

```
***Before You Go...****Thank you for reading this post, and I hope youâ€™ve enjoyed learning about similarity search with IVFPQ.**If you like my post, donâ€™t forget to hit* [***Follow***](https://peggy1502.medium.com/) *and* [***Subscribe***](https://peggy1502.medium.com/subscribe) *to get notified via email when I publish.**Optionally, you may also* [*sign up*](https://peggy1502.medium.com/membership) *for a Medium membership to get full access to every story on Medium.*ğŸ“‘ *Visit this* [*GitHub repo*](https://github.com/peggy1502/Data-Science-Articles/blob/main/README.md) *for all codes and notebooks that I shared in my posts.*Â© 2022 All rights reserved.
```

æœ‰å…´è¶£é˜…è¯»æˆ‘çš„å…¶ä»–æ•°æ®ç§‘å­¦æ–‡ç« å—ï¼ŸæŸ¥çœ‹ä»¥ä¸‹å†…å®¹:

</transformers-can-you-rate-the-complexity-of-reading-passages-17c76da3403>  </advanced-techniques-for-fine-tuning-transformers-82e4e61e16e>  <https://pub.towardsai.net/building-a-product-recommendation-engine-with-aws-sagemaker-321a0e7c7f7b>  </aws-certified-machine-learning-specialty-97eacbd1a0fe>  ![Peggy Chang](img/9e4c26496eb3cca6b350330838259487.png)

[å¼ ä½©ç¦](https://peggy1502.medium.com/?source=post_page-----9c6348fd4db3--------------------------------)

## æŒæ¡åŠ¨æ€ç¼–ç¨‹ç³»åˆ—

[View list](https://peggy1502.medium.com/list/series-on-mastering-dynamic-programming-ce9124edda06?source=post_page-----9c6348fd4db3--------------------------------)2 stories![Article cover for â€œMastering Dynamic Programmingâ€Šâ€”â€ŠUnderstanding the fundamentals and knowing when and how to apply this optimization techniqueâ€. Author: Peggy Chang](img/4189e936345f7dd6622ff2fc4cc61733.png)![Article cover for â€œMastering Dynamic Programming IIâ€Šâ€”â€ŠManual tabulation and workout is a great way to start grokking, analyzing, and spotting patterns, as well as strengthening our understanding and intuitionsâ€. Author: Peggy Chang](img/2cfd9c02af79a8bee7a11d30e4d2abb9.png)